{% comment %}
  Section: Featured Rolex collection
  - Section class: m-featured-rolex-section
  - Featured product with Retail/Markdown pricing
  - Right-side carousel of additional items from a collection
{% endcomment %}

<div class="m-featured-watch">
  <div class="m-fw-left">
    <h2 class="m-fw-eyebrow">{{ section.settings.left_heading }}</h2>
    {% assign fprod = section.settings.product %}
    {% if fprod != blank %}
      <div class="m-fw-hero">
        <a href="{{ fprod.url }}" class="m-fw-hero-img">
          <img
            alt="{{ fprod.featured_image.alt | escape }}"
            src="{{ fprod.featured_image | img_url: '800x' }}"
            srcset="
              {{ fprod.featured_image | img_url: '400x' }} 400w,
              {{ fprod.featured_image | img_url: '600x' }} 600w,
              {{ fprod.featured_image | img_url: '800x' }} 800w,
              {{ fprod.featured_image | img_url: '1200x' }} 1200w
            "
            sizes="(max-width: 990px) 100vw, 34vw"
            loading="lazy">
        </a>

        <div class="m-fw-info">
          {% if section.settings.show_vendor and fprod.vendor != blank %}
            <div class="m-fw-vendor">{{ fprod.vendor }}</div>
          {% endif %}

          <h3 class="m-fw-title">
            <a href="{{ fprod.url }}">{{ fprod.title }}</a>
          </h3>

          {% if section.settings.preowned_badge %}
            <div class="m-fw-badge">Pre-Owned</div>
          {% endif %}

          {% liquid
            assign price        = fprod.price
            assign price_varies = fprod.price_varies
            assign retail       = fprod.compare_at_price_max

            assign show_retail = false
            if retail > price
                assign show_retail = true
            endif

            assign savings = retail | minus: price
            assign savings_pct = 0
            if show_retail and retail > 0
                assign savings_pct = savings | times: 100.0 | divided_by: retail | round: 0
            endif
          %}

          <div class="m-fw-price-wrap">
            {% if show_retail %}
              <div class="m-fw-price-row">
                <span class="m-fw-price-label">Retail</span>
                <span class="m-fw-price-retail">{{ retail | money }}</span>
              </div>
              <div class="m-fw-price-row m-fw-price-row--our">
                <span class="m-fw-price-label">Our Price</span>
                <span class="m-fw-price-now">
                  {% if price_varies %}From {% endif %}{{ price | money }}
                </span>
              </div>
              <div class="m-fw-savings">
                You save {{ savings | money }}{% if savings_pct > 0 %} ({{ savings_pct }}%){% endif %}
              </div>
            {% else %}
              <div class="m-fw-price-row m-fw-price-row--our">
                <span class="m-fw-price-label">Price</span>
                <span class="m-fw-price-now">
                  {% if price_varies %}From {% endif %}{{ price | money }}
                </span>
              </div>
            {% endif %}
          </div>

          {% if section.settings.show_buy and fprod.available %}
            <form method="post" action="/cart/add" class="m-fw-atc">
              <input type="hidden" name="id" value="{{ fprod.selected_or_first_available_variant.id }}">
              <button type="submit" class="m-fw-btn">Buy Now</button>
            </form>
          {% endif %}
        </div>
      </div>
    {% else %}
      <div class="m-fw-hero m-fw-hero--placeholder">
        <div class="m-fw-placeholder">Select a product in the section settings.</div>
      </div>
    {% endif %}
  </div>

  <div class="m-fw-right">
    <div class="m-fw-right-top">
      <h3 class="m-fw-right-heading">{{ section.settings.right_heading }}</h3>
      {% if section.settings.collection != blank and section.settings.collection_link_text != blank %}
        <a class="m-fw-viewall" href="{{ section.settings.collection.url }}">{{ section.settings.collection_link_text }}</a>
      {% endif %}
    </div>

    <div class="m-fw-slider-wrap">
      <button class="m-fw-arrow m-fw-arrow--prev" aria-label="Previous">{% render 'icon-left-arrow' %}</button>
      <div class="m-fw-slider">
        {% assign shown = 0 %}
        {% if section.settings.collection != blank %}
          {% for p in section.settings.collection.products limit: 40 %}
            {% if p.available and fprod and p.id != fprod.id %}
              <div class="m-fw-card">
                <a class="m-fw-card-img" href="{{ p.url }}">
                  <img src="{{ p.featured_image | img_url: 'master' }}" alt="{{ p.featured_image.alt | escape }}">
                </a>
                <a class="m-fw-card-title" href="{{ p.url }}">{{ p.title | truncate: 64 }}</a>
                {% assign cp = p.compare_at_price_max %}
                {% if cp > p.price %}
                  <div class="m-fw-card-price">
                    <span class="m-fw-card-retail">{{ cp | money }}</span>
                    <span class="m-fw-card-now">{{ p.price | money }}</span>
                  </div>
                {% else %}
                  <div class="m-fw-card-price">
                    <span class="m-fw-card-now">{{ p.price | money }}</span>
                  </div>
                {% endif %}
              </div>
              {% assign shown = shown | plus: 1 %}
              {% if shown >= section.settings.max_cards %}{% break %}{% endif %}
            {% endif %}
          {% endfor %}
        {% endif %}

        {% if shown == 0 %}
          <div class="m-fw-empty">No other items in stock.</div>
        {% endif %}
      </div>
      <button class="m-fw-arrow m-fw-arrow--next" aria-label="Next">{% render 'icon-right-arrow' %}</button>
    </div>
  </div>
</div>

<style>
#shopify-section-{{ section.id }}.m-featured-rolex-section {
  background: {{ section.settings.bg }};
  padding: 60px 24px;
}

#shopify-section-{{ section.id }} .m-featured-watch {
  max-width: 1400px;
  margin: 0 auto;
  display: grid;
  grid-template-columns: 1.1fr 1fr;
  gap: 40px;
  align-items: start;
}

#shopify-section-{{ section.id }} .m-fw-eyebrow {
  font-family: Legitima, serif;
  font-size: 44px;
  line-height: 1;
  margin: 0 0 22px;
  color: #fff;
}

#shopify-section-{{ section.id }} .m-fw-left {
  color: #fff;
}

#shopify-section-{{ section.id }} .m-fw-hero {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 28px;
  align-items: start;
}

#shopify-section-{{ section.id }} .m-fw-hero-img img {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 6px;
}

#shopify-section-{{ section.id }} .m-fw-info {
  padding-top: 6px;
}

#shopify-section-{{ section.id }} .m-fw-vendor {
  opacity: .9;
  margin-bottom: 6px;
  font: 600 13px/1.2 Montserrat, sans-serif;
  letter-spacing: .06em;
  text-transform: uppercase;
}

#shopify-section-{{ section.id }} .m-fw-title {
  margin: 0 0 8px;
  font: 500 22px/1.25 Montserrat, sans-serif;
}

#shopify-section-{{ section.id }} .m-fw-title a {
  color: #fff;
  text-decoration: none;
}

#shopify-section-{{ section.id }} .m-fw-badge {
  display: inline-block;
  margin: 8px 0 16px;
  padding: 6px 10px;
  border: 1px solid rgba(255,255,255,.6);
  border-radius: 16px;
  font: 500 12px/1 Montserrat, sans-serif;
}

#shopify-section-{{ section.id }} .m-fw-price-wrap {
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.18);
  border-radius: 8px;
  padding: 14px 16px;
}

#shopify-section-{{ section.id }} .m-fw-price-row {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  margin-bottom: 6px;
  font: 500 14px/1.2 Montserrat, sans-serif;
}

#shopify-section-{{ section.id }} .m-fw-price-row--our .m-fw-price-now {
  font: 600 20px/1.2 Montserrat, sans-serif;
}

#shopify-section-{{ section.id }} .m-fw-price-retail {
  text-decoration: line-through;
  opacity: .75;
}

#shopify-section-{{ section.id }} .m-fw-savings {
  margin-top: 4px;
  font: 500 13px/1.2 Montserrat, sans-serif;
  opacity: .9;
}

#shopify-section-{{ section.id }} .m-fw-atc {
  margin-top: 16px;
}

#shopify-section-{{ section.id }} .m-fw-btn {
  width: 100%;
  padding: 12px 16px;
  border-radius: 8px;
  border: 1px solid #fff;
  background: #fff;
  color: #111;
  font: 600 14px/1.2 Montserrat, sans-serif;
  cursor: pointer;
}

#shopify-section-{{ section.id }} .m-fw-right-top {
  display: flex;
  justify-content: space-between;
  align-items: end;
  margin-bottom: 14px;
}

#shopify-section-{{ section.id }} .m-fw-right-heading {
  margin: 0;
  font-family: Legitima, serif;
  font-style: italic;
  font-weight: 500;
  font-size: 24px;
  color: #fff;
}

#shopify-section-{{ section.id }} .m-fw-viewall {
  color: #fff;
  opacity: .9;
  text-decoration: underline;
  font: 500 14px/1.2 Montserrat, sans-serif;
}

#shopify-section-{{ section.id }} .m-fw-slider-wrap {
  position: relative;
}

#shopify-section-{{ section.id }} .m-fw-arrow {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 2;
  border: none;
  background: none;
  padding: 0;
  cursor: pointer;
}

#shopify-section-{{ section.id }} .m-fw-arrow--prev {
  left: -10px;
}

#shopify-section-{{ section.id }} .m-fw-arrow--next {
  right: -10px;
}

#shopify-section-{{ section.id }} .m-fw-slider .slick-track {
  display: flex !important;
}

#shopify-section-{{ section.id }} .m-fw-card {
  width: 280px;
  margin: 0 10px;
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.18);
  border-radius: 10px;
  padding: 14px;
}

#shopify-section-{{ section.id }} .m-fw-card-img img {
  width: 100%;
  border-radius: 6px;
  display: block;
}

#shopify-section-{{ section.id }} .m-fw-card-title {
  display: block;
  margin: 10px 0 6px;
  color: #fff;
  text-decoration: none;
  font: 500 14px/1.3 Montserrat, sans-serif;
}

#shopify-section-{{ section.id }} .m-fw-card-price {
  display: flex;
  gap: 8px;
  align-items: baseline;
  font: 600 14px/1.2 Montserrat, sans-serif;
  color: #fff;
}

#shopify-section-{{ section.id }} .m-fw-card-retail {
  text-decoration: line-through;
  opacity: .7;
}

#shopify-section-{{ section.id }} .m-fw-empty {
  padding: 20px;
  color: #fff;
  opacity: .8;
}

@media (max-width: 1090px) {
  #shopify-section-{{ section.id }} .m-featured-watch {
    grid-template-columns: 1fr;
  }

  #shopify-section-{{ section.id }} .m-fw-eyebrow {
    font-size: 36px;
  }

  #shopify-section-{{ section.id }} .m-fw-hero {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function () {
  var $wrap = $('#shopify-section-{{ section.id }} .m-fw-slider');
  if ($wrap.length && typeof $wrap.slick === 'function') {
    $wrap.slick({
      slidesToShow: 2,
      slidesToScroll: 1,
      variableWidth: true,
      infinite: true,
      arrows: true,
      dots: false,
      autoplay: true,
      autoplaySpeed: 3500,
      prevArrow: '#shopify-section-{{ section.id }} .m-fw-arrow--prev',
      nextArrow: '#shopify-section-{{ section.id }} .m-fw-arrow--next'
    });
  }
});
</script>

{% schema %}
{
  "name": "Featured Rolex collection",
  "tag": "section",
  "class": "m-featured-rolex-section",
  "settings": [
    {
      "type": "color",
      "id": "bg",
      "label": "Section background",
      "default": "#1f1f21"
    },
    {
      "type": "text",
      "id": "left_heading",
      "label": "Left heading",
      "default": "Featured Rolex"
    },
    {
      "type": "product",
      "id": "product",
      "label": "Featured product"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Show vendor",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "preowned_badge",
      "label": "Show “Pre-Owned” badge",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_buy",
      "label": "Show Buy Now button",
      "default": true
    },
    {
      "type": "text",
      "id": "right_heading",
      "label": "Right heading",
      "default": "Other Pre-Owned Rolex in Stock"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Right-side collection"
    },
    {
      "type": "text",
      "id": "collection_link_text",
      "label": "View all link text",
      "default": "Shop all Pre-Owned Rolex"
    },
    {
      "type": "range",
      "id": "max_cards",
      "label": "Max items in slider",
      "min": 4,
      "max": 20,
      "step": 1,
      "default": 10
    }
  ],
  "presets": [
    {
      "name": "Featured Rolex collection"
    }
  ]
}
{% endschema %}
