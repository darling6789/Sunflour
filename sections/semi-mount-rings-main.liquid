<product-info
  id="MainProduct-{{ section.id }}"
  class="section-{{ section.id }}-padding s-m-section-{{ section.id }}-padding gradient s-m-gradient color-{{ section.settings.color_scheme }} s-m-color-{{ section.settings.color_scheme }}"
  data-section="{{ section.id }}"
  data-product-id="{{ product.id }}"
  data-update-url="true"
  data-url="{{ product.url }}"
  {% if section.settings.image_zoom == 'hover' %}
    data-zoom-on-hover
  {% endif %}
>
  {{ 'section-main-product.css' | asset_url | stylesheet_tag }}
  {{ 'component-accordion.css' | asset_url | stylesheet_tag }}
  {{ 'component-price.css' | asset_url | stylesheet_tag }}
  {{ 'component-slider.css' | asset_url | stylesheet_tag }}
  {{ 'component-rating.css' | asset_url | stylesheet_tag }}
  {{ 'component-deferred-media.css' | asset_url | stylesheet_tag }}

  {% unless product.has_only_default_variant %}
    {{ 'component-product-variant-picker.css' | asset_url | stylesheet_tag }}
    {{ 'component-swatch-input.css' | asset_url | stylesheet_tag }}
    {{ 'component-swatch.css' | asset_url | stylesheet_tag }}
  {% endunless %}
  {%- if product.quantity_price_breaks_configured? -%}
    {{ 'component-volume-pricing.css' | asset_url | stylesheet_tag }}
  {%- endif -%}

  {%- style -%}
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
      padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
    }

    @media screen and (min-width: 750px) {
      .section-{{ section.id }}-padding {
        padding-top: {{ section.settings.padding_top }}px;
        padding-bottom: {{ section.settings.padding_bottom }}px;
      }
    }

    /* Breadcrumbs Styles */
    .breadcrumbs {
      margin-bottom: 1rem;
    }

    .breadcrumbs__list {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      list-style: none;
      margin: 0;
      padding: 0;
      font-size: 0.875rem;
      color: rgba(var(--color-foreground), 0.7);
    }

    .breadcrumbs__item {
      display: flex;
      align-items: center;
    }

    .breadcrumbs__item:not(:last-child)::after {
      content: '/';
      margin: 0 0.5rem;
      color: rgba(var(--color-foreground), 0.5);
    }

    .breadcrumbs__link {
      color: rgba(var(--color-foreground), 0.7);
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .breadcrumbs__link:hover {
      color: rgba(var(--color-foreground), 1);
      text-decoration: underline;
    }

    .breadcrumbs__item--current {
      color: rgba(var(--color-foreground), 1);
      font-weight: 500;
    }

    @media screen and (max-width: 749px) {
      
      .breadcrumbs__list {
        font-size: 0.8rem;
      }
      
      .breadcrumbs__item:not(:last-child)::after {
        margin: 0 0.25rem;
      }
    }
  {%- endstyle -%}

  <script src="{{ 'product-info.js' | asset_url }}" defer="defer"></script>
  <script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>
  {%- if product.quantity_price_breaks_configured? -%}
    <script src="{{ 'show-more.js' | asset_url }}" defer="defer"></script>
    <script src="{{ 'price-per-item.js' | asset_url }}" defer="defer"></script>
  {%- endif -%}

  {% if section.settings.image_zoom == 'hover' %}
    <script id="EnableZoomOnHover-main" src="{{ 'magnify.js' | asset_url }}" defer="defer"></script>
  {% endif %}
  {%- if request.design_mode -%}
    <script src="{{ 'theme-editor.js' | asset_url }}" defer="defer"></script>
  {%- endif -%}

  {%- assign first_3d_model = product.media | where: 'media_type', 'model' | first -%}
  {%- if first_3d_model -%}
    {{ 'component-product-model.css' | asset_url | stylesheet_tag }}
    <link
      id="ModelViewerStyle"
      rel="stylesheet"
      href="https://cdn.shopify.com/shopifycloud/model-viewer-ui/assets/v1.0/model-viewer-ui.css"
      media="print"
      onload="this.media='all'"
    >
    <link
      id="ModelViewerOverride"
      rel="stylesheet"
      href="{{ 'component-model-viewer-ui.css' | asset_url }}"
      media="print"
      onload="this.media='all'"
    >
  {%- endif -%}

  {% assign variant_images = product.images | where: 'attached_to_variant?', true | map: 'src' %}
  <div class="page-width s-m-page-width">
    {%- comment -%} Breadcrumbs positioned at top-left of main product section {%- endcomment -%}
    {%- if section.settings.show_breadcrumbs -%}
      {%- comment -%} Get collection from referrer or URL parameters {%- endcomment -%}
      {%- assign breadcrumb_collection = collection -%}
      {%- unless breadcrumb_collection -%}
        {%- comment -%} Check for collection in URL parameters {%- endcomment -%}
        {%- if request.page_type == 'product' and request.query_string contains 'collection=' -%}
          {%- assign collection_handle = request.query_string | split: 'collection=' | last | split: '&' | first -%}
          {%- assign breadcrumb_collection = collections[collection_handle] -%}
        {%- endif -%}
      {%- endunless -%}
      
      {%- comment -%} Fallback to first non-"All products" collection {%- endcomment -%}
      {%- unless breadcrumb_collection -%}
        {%- for product_collection in product.collections -%}
          {%- unless product_collection.handle == 'all' -%}
            {%- assign breadcrumb_collection = product_collection -%}
            {%- break -%}
          {%- endunless -%}
        {%- endfor -%}
      {%- endunless -%}
      
      <nav class="breadcrumbs s-m-breadcrumbs breadcrumbs--product s-m-breadcrumbs--product" aria-label="Breadcrumb">
        <ol class="breadcrumbs__list s-m-breadcrumbs__list">
          <li class="breadcrumbs__item s-m-breadcrumbs__item">
            <a href="{{ routes.root_url }}" class="breadcrumbs__link s-m-breadcrumbs__link">
              Home
            </a>
          </li>
          {%- if breadcrumb_collection -%}
            <li class="breadcrumbs__item s-m-breadcrumbs__item">
              <a href="{{ breadcrumb_collection.url }}" class="breadcrumbs__link s-m-breadcrumbs__link">
                {{ breadcrumb_collection.title | escape }}
              </a>
            </li>
          {%- endif -%}
          {%- if product.metafields.custom.brand != blank -%}
            <li class="breadcrumbs__item breadcrumbs__item--current" aria-current="page">
              {{ product.metafields.custom.brand | escape }}
            </li>
          {%- else -%}
            <li class="breadcrumbs__item breadcrumbs__item--current" aria-current="page">
              {{ product.title | escape }}
            </li>
          {%- endif -%}
        </ol>
      </nav>
      
      {%- comment -%} JavaScript to track collection referrer {%- endcomment -%}
      <script>
        (function() {
          // Check if we came from a collection page
          const referrer = document.referrer;
          if (referrer && referrer.includes('/collections/')) {
            const collectionMatch = referrer.match(/\/collections\/([^\/\?]+)/);
            if (collectionMatch) {
              const collectionHandle = collectionMatch[1];
              // Update breadcrumb link if it exists
              const breadcrumbLink = document.querySelector('.breadcrumbs--product .breadcrumbs__link[href*="/collections/"]');
              if (breadcrumbLink) {
                breadcrumbLink.href = '/collections/' + collectionHandle;
                breadcrumbLink.textContent = collectionHandle.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
              }
            }
          }
        })();
      </script>
    {%- endif -%}
    
    <div class="s-m-product s-m-product--{{ section.settings.media_size }} s-m-product--{{ section.settings.media_position }} s-m-product--{{ section.settings.gallery_layout }} s-m-product--mobile-{{ section.settings.mobile_thumbnails }}{% unless product.media.size > 0 %} s-m-product--no-media{% endunless %}">
      <div class="s-m-product__media-wrapper">
        {% render 'product-media-gallery', variant_images: variant_images %}
      </div>
      <div class="s-m-product__info-wrapper{% if settings.page_width > 1400 and section.settings.media_size == "small" %} s-m-product__info-wrapper--extra-padding{% endif %}{% if settings.animations_reveal_on_scroll %} s-m-scroll-trigger s-m-animate--slide-in{% endif %}">
        <section
          id="ProductInfo-{{ section.id }}"
          class="s-m-product__info-container{% if section.settings.enable_sticky_info %} s-m-product__column-sticky{% endif %}"
        >
          {%- assign product_form_id = 'product-form-' | append: section.id -%}

          {%- for block in section.blocks -%}
            {%- case block.type -%}
              {%- when '@app' -%}
                {% render block %}
              {%- when 'guarantee' -%}
                <div class="guarantees-wrap s-m-guarantees-wrap">
                  <div
                    id="guarantee-{{ section.id }}"
                    role="status"
                    {{ block.shopify_attributes }}
                    class="guarantee-badges s-m-guarantee-badges"
                  >
                    <div class="guarantee-badge s-m-guarantee-badge">
                      <svg xmlns="http://www.w3.org/2000/svg" width="79" height="89" viewBox="0 0 79 89" fill="none">
                        <path d="M71.3427 0.520996H14.8002C10.8952 0.520996 7.73237 3.68381 7.73237 7.58882C3.82736 7.58882 0.664551 10.7516 0.664551 14.6566V72.9661C0.664551 73.4431 0.858898 73.8849 1.17693 74.2206L15.3126 88.3562C15.6483 88.6744 16.09 88.8687 16.5671 88.8687H64.2749C68.1799 88.8687 71.3427 85.7058 71.3427 81.8009C75.2477 81.8009 78.4106 78.638 78.4106 74.7331V7.58882C78.4106 3.68381 75.2477 0.520996 71.3427 0.520996ZM4.19846 14.6566C4.19846 12.7129 5.78875 11.1227 7.73237 11.1227V71.1992H4.19846V14.6566ZM14.8002 82.8434L6.68981 74.7331H14.8002V82.8434ZM64.2749 85.3348H18.3341V81.8009H67.8088C67.8088 83.7445 66.2185 85.3348 64.2749 85.3348ZM74.8767 74.7331C74.8767 76.6767 73.2864 78.267 71.3427 78.267H18.3341V72.9661C18.3341 71.9943 17.539 71.1992 16.5671 71.1992H11.2663V7.58882C11.2663 5.64509 12.8566 4.05491 14.8002 4.05491H71.3427C73.2864 4.05491 74.8767 5.64509 74.8767 7.58882V74.7331Z" fill="#78686F"/>
                        <path d="M59.4109 21.5242L56.3884 13.7517C56.1768 13.2335 55.6025 12.8708 54.9527 12.8708H30.7723C30.1225 12.8708 29.5482 13.2335 29.3366 13.7517L26.314 21.5242C26.1629 21.9258 26.2385 22.3533 26.5256 22.69L41.6384 40.8259C41.9104 41.1628 42.3789 41.3701 42.8625 41.3701C43.3461 41.3701 43.8146 41.1628 44.0866 40.8259L59.1994 22.69C59.4865 22.3533 59.562 21.9258 59.4109 21.5242ZM52.1266 15.4616L48.9076 19.607L45.6886 15.4616H52.1266ZM46.0815 20.6433H39.6435L42.8625 16.498L46.0815 20.6433ZM40.0364 15.4616L36.8174 19.607L33.5984 15.4616H40.0364ZM31.2257 17.0939L33.9913 20.6433H29.8505L31.2257 17.0939ZM30.6816 23.2342H35.6839L39.0088 33.2218L30.6816 23.2342ZM42.8625 35.3593L38.8274 23.2342H46.8976L42.8625 35.3593ZM46.7162 33.2218L50.041 23.2342H55.0434L46.7162 33.2218ZM51.7337 20.6433L54.4993 17.0939L55.8745 20.6433H51.7337Z" fill="#78686F"/>
                        <path d="M69.5758 49.9959H16.5671C15.5905 49.9959 14.8002 50.7862 14.8002 51.7629C14.8002 52.7395 15.5905 53.5298 16.5671 53.5298H69.5758C70.5524 53.5298 71.3427 52.7395 71.3427 51.7629C71.3427 50.7862 70.5524 49.9959 69.5758 49.9959Z" fill="#78686F"/>
                        <path d="M69.5758 58.8304H16.5671C15.5905 58.8304 14.8002 59.6207 14.8002 60.5973C14.8002 61.574 15.5905 62.3643 16.5671 62.3643H69.5758C70.5524 62.3643 71.3427 61.574 71.3427 60.5973C71.3427 59.6207 70.5524 58.8304 69.5758 58.8304Z" fill="#78686F"/>
                        <path d="M69.5757 67.665H23.6349C22.6582 67.665 21.8679 68.4553 21.8679 69.4319C21.8679 70.4086 22.6582 71.1989 23.6349 71.1989H69.5757C70.5523 71.1989 71.3427 70.4086 71.3427 69.4319C71.3427 68.4553 70.5523 67.665 69.5757 67.665Z" fill="#78686F"/>
                      </svg>
                      <h3>{{ block.settings.certified_title }}</h3>
                      <p>{{ block.settings.certified_text }}</p>
                    </div>
                    <div class="guarantee-badge s-m-guarantee-badge">
                      <svg xmlns="http://www.w3.org/2000/svg" width="68" height="93" viewBox="0 0 68 93" fill="none">
                        <path d="M58.0436 35.4757C58.0436 22.2816 47.3102 11.5482 34.1161 11.5482C20.922 11.5482 10.1886 22.2816 10.1886 35.4757C10.1886 48.6698 20.922 59.4032 34.1161 59.4032C47.3102 59.4032 58.0436 48.6698 58.0436 35.4757ZM34.1161 55.722C22.9522 55.722 13.8698 46.6396 13.8698 35.4757C13.8698 24.3118 22.9522 15.2293 34.1161 15.2293C45.28 15.2293 54.3625 24.3118 54.3625 35.4757C54.3625 46.6396 45.28 55.722 34.1161 55.722Z" fill="#78686F"/>
                        <path d="M47.3822 24.9716C45.2953 22.8847 41.6582 22.8847 39.5732 24.9716L29.5147 35.0291L28.6591 34.1736C26.5741 32.0885 22.9361 32.0876 20.8511 34.1745C19.8085 35.217 19.2343 36.6037 19.2343 38.0785C19.2343 39.5533 19.8085 40.94 20.8511 41.9825L24.3084 45.4408C25.6987 46.832 27.5483 47.5977 29.5147 47.5977C31.4811 47.5977 33.3307 46.832 34.721 45.4408L47.3813 32.7796C49.5346 30.6272 49.5346 27.124 47.3822 24.9716ZM44.7786 30.1769L32.1183 42.8381C30.6822 44.2742 28.3473 44.2742 26.9111 42.8381L23.4537 39.3798C22.7366 38.6617 22.7366 37.4952 23.4537 36.7771C24.1727 36.0609 25.3392 36.0582 26.0564 36.7762L26.912 37.6318C28.3464 39.0679 30.683 39.0679 32.1174 37.6318L42.1767 27.5742C42.8705 26.8786 44.0829 26.8786 44.7785 27.5742C45.4957 28.2923 45.4957 29.4589 44.7786 30.1769Z" fill="#78686F"/>
                        <path d="M67.5559 82.3982L58.2294 57.1675L58.3386 56.6085C58.6882 54.8174 59.782 53.2797 61.3376 52.3909L62.2741 51.8561C66.6652 49.3469 68.4582 43.7389 66.3561 39.0871L65.9067 38.094C65.1554 36.4305 65.1554 34.5216 65.9067 32.859L66.3561 31.8641C68.4582 27.2123 66.6652 21.6034 62.2741 19.096L61.3376 18.5612C59.782 17.6724 58.6882 16.1347 58.3386 14.3444L58.1292 13.2714C57.146 8.23044 52.4394 4.747 47.4156 5.36083L46.3506 5.48934C44.5963 5.70233 42.8384 5.11817 41.5362 3.89142L40.7471 3.14727C37.03 -0.35413 31.2036 -0.355031 27.4847 3.14818L26.6965 3.89142C25.3943 5.11817 23.6328 5.69964 21.8821 5.48934L20.8171 5.36083C15.7762 4.756 11.0867 8.23134 10.1035 13.2714L9.89406 14.3435C9.54446 16.1347 8.45071 17.6724 6.89504 18.5612L5.95857 19.096C1.56743 21.6034 -0.225512 27.2123 1.87659 31.865L2.32595 32.858C3.07728 34.5216 3.07728 36.4305 2.32595 38.0931L1.87659 39.088C-0.225512 43.7389 1.56743 49.3469 5.95857 51.8561L6.89504 52.3908C8.45071 53.2797 9.54446 54.8174 9.89406 56.6076L10.0031 57.1665L0.676795 82.3982C0.455705 82.9968 0.559954 83.6663 0.952697 84.1687C1.34454 84.6711 1.96106 84.9362 2.60364 84.8661L13.9662 83.6223L21.7859 91.9534C22.1373 92.3272 22.6244 92.534 23.1277 92.534C23.249 92.534 23.3712 92.5223 23.4926 92.4971C24.1181 92.3704 24.6331 91.93 24.8541 91.3315L32.6341 70.2942C33.1257 70.37 33.62 70.4309 34.1164 70.4309C34.6127 70.4309 35.107 70.37 35.5986 70.2942L43.3786 91.3315C43.5997 91.93 44.1146 92.3704 44.7401 92.4971C44.8615 92.5223 44.9837 92.534 45.105 92.534C45.6083 92.534 46.0954 92.3273 46.4468 91.9534L54.2666 83.6223L65.6291 84.8661C66.2654 84.9371 66.8882 84.6711 67.28 84.1687C67.6728 83.6663 67.777 82.9967 67.5559 82.3982ZM12.1499 61.9767C13.7656 63.9729 16.0955 65.3019 18.6751 65.5809L13.3481 79.9867L5.16136 80.883L12.1499 61.9767ZM22.4339 87.2639L16.8009 81.2631L22.6461 65.4558C24.1372 65.4704 25.585 66.0129 26.6965 67.0607L27.4856 67.8048C28.0066 68.2956 28.5759 68.7 29.1682 69.0532L22.4339 87.2639ZM30.0101 65.1257L29.2219 64.3825C27.4065 62.6713 25.0419 61.7393 22.5956 61.7393C22.2128 61.7393 21.8272 61.7618 21.4417 61.8085L20.3767 61.937C17.2581 62.3064 14.3328 60.1315 13.7163 56.9761L13.5069 55.9021C12.9515 53.0595 11.2071 50.615 8.72121 49.195L7.78474 48.6603C5.02387 47.083 3.90226 43.5438 5.23057 40.6041L5.67993 39.6093C6.86713 36.9823 6.86713 33.9698 5.67993 31.3419L5.23057 30.3488C3.90226 27.4082 5.02387 23.8691 7.78474 22.2918L8.72121 21.7571C11.2071 20.3371 12.9515 17.8926 13.5069 15.049L13.7163 13.976C14.3328 10.8179 17.2671 8.64746 20.3767 9.01504L21.4417 9.14355C24.2888 9.48775 27.1225 8.5468 29.2219 6.56961L30.0092 5.82727C32.3503 3.62001 35.8814 3.62272 38.2226 5.82637L39.0107 6.56961C41.1101 8.5486 43.9402 9.48956 46.7909 9.14355L47.8559 9.01504C50.988 8.64118 53.8998 10.8197 54.5163 13.976L54.7257 15.0499C55.2811 17.8926 57.0256 20.3371 59.5114 21.7571L60.4479 22.2918C63.2088 23.8691 64.3304 27.4082 63.0021 30.3479L62.5527 31.3428C61.3655 33.9698 61.3655 36.9823 62.5527 39.6093L63.0021 40.6032C64.3304 43.5439 63.2088 47.083 60.4479 48.6603L59.5114 49.195C57.0256 50.615 55.2811 53.0595 54.7257 55.903L54.5163 56.9761C53.8998 60.1342 50.9655 62.3037 47.8559 61.937L46.7909 61.8085C43.9438 61.4616 41.111 62.4044 39.0107 64.3825L38.2235 65.1248C35.8805 67.3294 32.3494 67.3285 30.0101 65.1257ZM45.7988 87.2639L39.0643 69.0531C39.6568 68.6997 40.2266 68.295 40.748 67.8039L41.5361 67.0607C42.6485 66.0127 44.0941 65.4686 45.5862 65.4551L51.4317 81.2631L45.7988 87.2639ZM54.8845 79.9867L49.5594 65.5856C52.1459 65.3112 54.4726 63.9812 56.0852 61.9836L63.0713 80.883L54.8845 79.9867Z" fill="#78686F"/>
                      </svg>
                      <h3>{{ block.settings.warranty_title }}</h3>
                      <p>{{ block.settings.warranty_text }}</p>
                    </div>
                    <div class="guarantee-badge s-m-guarantee-badge">
                      <svg xmlns="http://www.w3.org/2000/svg" width="83" height="89" viewBox="0 0 83 89" fill="none">
                        <path d="M50.4201 47.405C50.4201 48.2457 49.7378 48.928 48.8971 48.928H43.4631C42.6224 48.928 41.9401 48.2457 41.9401 47.405C41.9401 46.5643 42.6224 45.882 43.4631 45.882H48.8971C49.7378 45.882 50.4201 46.5643 50.4201 47.405ZM48.8971 52.0456H43.4631C42.6224 52.0456 41.9401 52.7279 41.9401 53.5686C41.9401 54.4093 42.6224 55.0916 43.4631 55.0916H48.8971C49.7378 55.0916 50.4201 54.4093 50.4201 53.5686C50.4201 52.7279 49.7378 52.0456 48.8971 52.0456ZM82.9926 70.8562C82.9926 80.7877 74.913 88.8687 64.98 88.8687C59.2977 88.8687 54.2307 86.2187 50.9258 82.0959C46.934 84.7231 43.2864 86.7106 40.842 87.9504C39.7317 88.5124 38.5149 88.7941 37.298 88.7941C36.0811 88.7941 34.8642 88.5139 33.754 87.9519C23.8575 82.9382 0.838867 69.2586 0.838867 50.5866V15.5332C0.84039 14.0133 1.43893 12.5923 2.52331 11.5323C3.61073 10.4708 5.03626 9.90116 6.56992 9.94075C6.95371 9.94989 7.35731 9.95446 7.77918 9.95446C7.98174 9.96208 23.5361 10.3246 33.7113 1.82773C35.7993 0.0854179 38.8469 0.0854179 40.9577 1.82773C49.5307 8.90054 60.8405 9.95598 66.8183 9.95598C67.2417 9.95598 67.6438 9.95141 68.026 9.94228C69.5429 9.90572 70.9883 10.4738 72.0742 11.5338C73.1585 12.5938 73.7571 14.0148 73.7571 15.5347V50.5866C73.7556 52.0091 73.6078 53.4605 73.3261 54.9119C79.0632 57.9275 82.988 63.9387 82.988 70.8577L82.9926 70.8562ZM49.2246 79.5708C47.7884 76.9863 46.9645 74.0164 46.9645 70.8577C46.9645 67.5757 47.8615 64.5038 49.4028 61.8507H18.8087C17.9681 61.8507 17.2857 61.1684 17.2857 60.3277V23.3477C17.2857 22.507 17.9681 21.8247 18.8087 21.8247H55.7887C56.6294 21.8247 57.3117 22.507 57.3117 23.3477V54.5829C59.6419 53.4803 62.2356 52.8452 64.98 52.8452C66.8792 52.8452 68.7083 53.1452 70.4278 53.692C70.5969 52.6472 70.7126 51.607 70.7126 50.5866V15.5332C70.7141 14.8402 70.443 14.193 69.9496 13.7102C69.4531 13.2274 68.7875 12.9868 68.1022 12.9837C67.7001 12.9944 67.2721 12.9989 66.8229 12.9989C60.4354 12.9989 48.3306 11.8521 39.0235 4.17467C38.0412 3.36444 36.6294 3.35987 35.6668 4.16401C24.5901 13.4132 8.42189 13.0203 7.73501 12.9989C7.33751 13.0005 6.90498 12.9944 6.49986 12.9837C5.781 12.9654 5.14896 13.2259 4.65398 13.7102C4.16053 14.193 3.88944 14.8402 3.88944 15.5332V50.5851C3.88791 68.0447 27.8036 81.5203 35.1338 85.2333C36.4908 85.9202 38.1097 85.9217 39.4683 85.2333C41.8365 84.0347 45.3653 82.1112 49.2276 79.5708H49.2246ZM54.2657 56.4105V24.8707H44.9846V38.5275C44.9846 39.0864 44.6784 39.5997 44.188 39.8662C43.9611 39.9896 43.7113 40.0505 43.4616 40.0505C43.1722 40.0505 42.8828 39.9682 42.6315 39.8037L37.2995 36.3328L31.9675 39.8037C31.4999 40.1099 30.9029 40.1342 30.411 39.8662C29.919 39.5997 29.6144 39.0864 29.6144 38.5275V24.8707H20.3333V58.8047H51.6325C52.4305 57.9229 53.3093 57.1218 54.2657 56.4105ZM32.6589 35.7175L36.4679 33.2381C36.9721 32.9091 37.6254 32.9091 38.1295 33.2381L41.9386 35.7175V24.8692H32.6574V35.7175H32.6589ZM79.9466 70.8562C79.9466 62.6046 73.2332 55.8897 64.98 55.8897C56.7269 55.8897 50.0105 62.6031 50.0105 70.8562C50.0105 79.1093 56.7254 85.8227 64.98 85.8227C73.2347 85.8227 79.9466 79.1093 79.9466 70.8562ZM76.6264 68.1651L63.9018 80.8897C63.6154 81.1761 63.2286 81.336 62.825 81.336C62.4214 81.336 62.033 81.1761 61.7482 80.8897L53.3306 72.4721C53.0443 72.1858 52.8844 71.7989 52.8844 71.3953C52.8844 70.9918 53.0443 70.6034 53.3306 70.3186L57.6011 66.0496C58.1966 65.4541 59.1591 65.4541 59.7546 66.0496L62.825 69.12L70.2039 61.7411C70.7994 61.1456 71.762 61.1456 72.3574 61.7411L76.6264 66.01C77.2219 66.6055 77.2219 67.5696 76.6264 68.1651ZM73.3946 67.0883L71.2792 64.9729L63.9002 72.3518C63.3047 72.9473 62.3422 72.9473 61.7467 72.3518L58.6763 69.2814L56.5594 71.3969L62.8235 77.661L73.3946 67.0883Z" fill="#78686F"/>
                      </svg>
                      <h3>{{ block.settings.shipping_title }}</h3>
                      <p>{{ block.settings.shipping_text }}</p>
                    </div>
                  </div>
                </div>
              {%- when 'text' -%}
                <p
                  class="product__text s-m-product__text inline-richtext s-m-inline-richtext{% if block.settings.text_style == 'uppercase' %} caption-with-letter-spacing s-m-caption-with-letter-spacing{% elsif block.settings.text_style == 'subtitle' %} subtitle s-m-subtitle{% endif %}"
                  {{ block.shopify_attributes }}
                >
                  {{- block.settings.text -}}
                </p>
              {%- when 'title' -%}
                <div class="product__title s-m-product__title" {{ block.shopify_attributes }}>
                  <h4 class="s-m-product-vendor">{{ product.vendor }}</h4>
                  <h1>{{ product.title | escape }}</h1>
                  <a href="{{ product.url }}" class="product__title s-m-product__title">
                    <h2 class="h1 s-m-h1">
                      {{ product.title | escape }}
                    </h2>
                  </a>
                </div>
              {%- when 'price' -%}
                  <div id="price-{{ section.id }}" role="status" {{ block.shopify_attributes }}>
                    {%- capture _promo -%}{% render 'auto-discount-price', product: product %}{%- endcapture -%}
                    {%- if _promo contains 'promo-price-block' -%}
                      {{ _promo }}
                    {%- else -%}
                      {%- render 'price',
                        product: product,
                        use_variant: true,
                        show_badges: true,
                        price_class: 'price--large'
                      -%}
                    {%- endif -%}
                  </div>
                  {%- if product.quantity_price_breaks_configured? -%}
                    <div class="volume-pricing-note s-m-volume-pricing-note" id="Volume-Note-{{ section.id }}">
                      <span>{{ 'products.product.volume_pricing.note' | t }}</span>
                    </div>
                  {%- endif -%}
                  {%- if cart.taxes_included or cart.duties_included or shop.shipping_policy.body != blank -%}
                    <div class="product__tax s-m-product__tax caption s-m-caption rte s-m-rte">
                      {%- if cart.duties_included and cart.taxes_included -%}
                        {{ 'products.product.duties_and_taxes_included' | t }}
                      {%- elsif cart.taxes_included -%}
                        {{ 'products.product.taxes_included' | t }}
                      {%- elsif cart.duties_included -%}
                        {{ 'products.product.duties_included' | t }}
                      {%- endif -%}
                      {%- if shop.shipping_policy.body != blank -%}
                        {{ 'products.product.shipping_policy_html' | t: link: shop.shipping_policy.url }}
                      {%- endif -%}
                    </div>
                  {%- endif -%}
                  <div {{ block.shopify_attributes }}>
                    {%- assign product_form_installment_id = 'product-form-installment-' | append: section.id -%}
                    {%- form 'product', product, id: product_form_installment_id, class: 'installment caption-large' -%}
                      <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                      {{ form | payment_terms }}
                    {%- endform -%}
                  </div>

                  <p class="affirm-as-low-as s-m-affirm-as-low-as" data-page-type="product" data-amount="{{product.price}}"></p>

              {%- when 'inventory' -%}
                  <p
                  class="product__inventory s-m-product__inventory{% if block.settings.text_style == 'uppercase' %} caption-with-letter-spacing s-m-caption-with-letter-spacing{% elsif block.settings.text_style == 'subtitle' %} subtitle s-m-subtitle{% endif %}{% if product.selected_or_first_available_variant.inventory_management != 'shopify' %} visibility-hidden s-m-visibility-hidden{% endif %}"
                  {{ block.shopify_attributes }}
                  id="Inventory-{{ section.id }}"
                  role="status"
                >
                  {%- if product.selected_or_first_available_variant.inventory_management == 'shopify' -%}
                    {%- if product.selected_or_first_available_variant.inventory_quantity > 0 -%}
                      {%- if product.selected_or_first_available_variant.inventory_quantity
                          <= block.settings.inventory_threshold
                      -%}
                        <span class="svg-wrapper s-m-svg-wrapper" style="color: rgb(238, 148, 65)">
                          {{- 'icon-inventory-status.svg' | inline_asset_content -}}
                        </span>
                        {%- if block.settings.show_inventory_quantity -%}
                          {{-
                            'products.product.inventory_low_stock_show_count'
                            | t: quantity: product.selected_or_first_available_variant.inventory_quantity
                          -}}
                        {%- else -%}
                          {{- 'products.product.inventory_low_stock' | t -}}
                        {%- endif -%}
                      {%- else -%}
                        <span class="svg-wrapper" style="color: rgb(62, 214, 96)">
                          {{- 'icon-inventory-status.svg' | inline_asset_content -}}
                        </span>
                        {%- if block.settings.show_inventory_quantity -%}
                          {{-
                            'products.product.inventory_in_stock_show_count'
                            | t: quantity: product.selected_or_first_available_variant.inventory_quantity
                          -}}
                        {%- else -%}
                          {{- 'products.product.inventory_in_stock' | t -}}
                        {%- endif -%}
                      {%- endif -%}
                    {%- else -%}
                      {%- if product.selected_or_first_available_variant.inventory_policy == 'continue' -%}
                        <span class="svg-wrapper" style="color: rgb(62, 214, 96)">
                          {{- 'icon-inventory-status.svg' | inline_asset_content -}}
                        </span>
                        {{- 'products.product.inventory_out_of_stock_continue_selling' | t -}}
                      {%- else -%}
                        <span class="svg-wrapper s-m-svg-wrapper" style="color: rgb(200, 200, 200)">
                          {{- 'icon-inventory-status.svg' | inline_asset_content -}}
                        </span>
                        {{- 'products.product.inventory_out_of_stock' | t -}}
                      {%- endif -%}
                    {%- endif -%}
                  {%- endif -%}
                </p>
              {%- when 'description' -%}
                {%- if product.description != blank -%}
                  <div class="product__description s-m-product__description rte s-m-rte quick-add-hidden s-m-quick-add-hidden" {{ block.shopify_attributes }}>
                    {{ product.description }}
                  </div>
                {%- endif -%}
              {%- when 'sku' -%}
                  <p
                  class="product__sku s-m-product__sku{% if block.settings.text_style == 'uppercase' %} caption-with-letter-spacing s-m-caption-with-letter-spacing{% elsif block.settings.text_style == 'subtitle' %} subtitle s-m-subtitle{% endif %}{% if product.selected_or_first_available_variant.sku.size == 0 %} visibility-hidden s-m-visibility-hidden{% endif %}"
                  id="Sku-{{ section.id }}"
                  role="status"
                  {{ block.shopify_attributes }}
                >
                  <span class="visually-hidden s-m-visually-hidden">{{ 'products.product.sku' | t }}:</span>
                  {{- product.selected_or_first_available_variant.sku -}}
                </p>
              {%- when 'custom_liquid' -%}
                {{ block.settings.custom_liquid }}
              {%- when 'collapsible_tab' -%}
                <div class="product__accordion s-m-product__accordion accordion s-m-accordion quick-add-hidden s-m-quick-add-hidden" {{ block.shopify_attributes }}>
                  <details id="Details-{{ block.id }}-{{ section.id }}">
                    <summary>
                      <div class="summary__title s-m-summary__title">
                        {% render 'icon-accordion', icon: block.settings.icon %}
                        <h2 class="h4 s-m-h4 accordion__title s-m-accordion__title inline-richtext s-m-inline-richtext">
                          {{ block.settings.heading | default: block.settings.page.title | escape }}
                        </h2>
                      </div>
                      {{- 'icon-caret.svg' | inline_asset_content -}}
                    </summary>
                    <div class="accordion__content s-m-accordion__content rte s-m-rte" id="ProductAccordion-{{ block.id }}-{{ section.id }}">
                      {{ block.settings.content }}
                      {{ block.settings.page.content }}
                    </div>
                  </details>
                </div>
              {%- when 'quantity_selector' -%}
                  <div
                  id="Quantity-Form-{{ section.id }}"
                  class="product-form__input s-m-product-form__input product-form__quantity s-m-product-form__quantity{% if settings.inputs_shadow_vertical_offset != 0 and settings.inputs_shadow_vertical_offset < 0 %} product-form__quantity-top s-m-product-form__quantity-top{% endif %}"
                  {{ block.shopify_attributes }}
                >
                  {% comment %} TODO: enable theme-check once `item_count_for_variant` is accepted as valid filter {% endcomment %}
                  {% # theme-check-disable %}
                  {%- assign cart_qty = cart
                    | item_count_for_variant: product.selected_or_first_available_variant.id
                  -%}
                  {% # theme-check-enable %}
                  <span class="visually-hidden" id="quantity-label-{{ section.id }}">
                    {%- if cart_qty > 0 -%}
                      {{- 'products.product.quantity.in_cart_aria_label' | t: quantity: cart_qty -}}
                    {%- else -%}
                      {{- 'products.product.quantity.label' | t -}}
                    {%- endif -%}
                  </span>
                  <label
                  class="quantity__label s-m-quantity__label form__label s-m-form__label"
                  for="Quantity-{{ section.id }}"
                    aria-labelledby="quantity-label-{{ section.id }}"
                  >
                    <span aria-hidden="true">{{ 'products.product.quantity.label' | t }}</span>
                    <span class="quantity__rules-cart s-m-quantity__rules-cart{% if cart_qty == 0 %} hidden s-m-hidden{% endif %}" aria-hidden="true">
                      {%- render 'loading-spinner' -%}
                      <span
                        >(
                        {{- 'products.product.quantity.in_cart_html' | t: quantity: cart_qty -}}
                        )</span
                      >
                    </span>
                  </label>
                  <div class="price-per-item__container s-m-price-per-item__container">
                    <quantity-input class="quantity s-m-quantity" data-url="{{ product.url }}" data-section="{{ section.id }}">
                      <button class="quantity__button s-m-quantity__button" name="minus" type="button">
                        <span class="visually-hidden s-m-visually-hidden">
                          {{- 'products.product.quantity.decrease' | t: product: product.title | escape -}}
                        </span>
                        <span class="svg-wrapper s-m-svg-wrapper">
                          {{- 'icon-minus.svg' | inline_asset_content -}}
                        </span>
                      </button>
                      <input
                        class="quantity__input s-m-quantity__input"
                        type="number"
                        name="quantity"
                        id="Quantity-{{ section.id }}"
                        data-cart-quantity="{{ cart_qty }}"
                        data-min="{{ product.selected_or_first_available_variant.quantity_rule.min }}"
                        min="{{ product.selected_or_first_available_variant.quantity_rule.min }}"
                        {% if product.selected_or_first_available_variant.quantity_rule.max != null %}
                          data-max="{{ product.selected_or_first_available_variant.quantity_rule.max }}"
                          max="{{ product.selected_or_first_available_variant.quantity_rule.max }}"
                        {% endif %}
                        step="{{ product.selected_or_first_available_variant.quantity_rule.increment }}"
                        value="{{ product.selected_or_first_available_variant.quantity_rule.min }}"
                        form="{{ product_form_id }}"
                      >
                      <button class="quantity__button s-m-quantity__button" name="plus" type="button">
                        <span class="visually-hidden s-m-visually-hidden">
                          {{- 'products.product.quantity.increase' | t: product: product.title | escape -}}
                        </span>
                        <span class="svg-wrapper s-m-svg-wrapper">
                          {{- 'icon-plus.svg' | inline_asset_content -}}
                        </span>
                      </button>
                    </quantity-input>
                    {%- liquid
                      assign volume_pricing_array = product.selected_or_first_available_variant.quantity_price_breaks | sort: 'quantity' | reverse
                      assign current_qty_for_volume_pricing = cart_qty | plus: product.selected_or_first_available_variant.quantity_rule.min
                      if cart_qty > 0
                        assign current_qty_for_volume_pricing = cart_qty | plus: product.selected_or_first_available_variant.quantity_rule.increment
                      endif
                    -%}
                    {%- if product.quantity_price_breaks_configured? -%}
                      <price-per-item
                        id="Price-Per-Item-{{ section.id }}"
                        data-section-id="{{ section.id }}"
                        data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                      >
                        {%- if product.selected_or_first_available_variant.quantity_price_breaks.size > 0 -%}
                          {%- assign variant_price_compare = product.selected_or_first_available_variant.compare_at_price -%}
                          <div class="price-per-item">
                            {%- if variant_price_compare -%}
                              <dl class="price-per-item--current">
                                <dt class="visually-hidden">
                                  {{ 'products.product.price.regular_price' | t }}
                                </dt>
                                <dd>
                                  <s class="variant-item__old-price">
                                    {{ variant_price_compare | money_with_currency }}
                                  </s>
                                </dd>
                              </dl>
                            {%- endif -%}
                            {%- if current_qty_for_volume_pricing < volume_pricing_array.last.minimum_quantity -%}
                              {%- assign variant_price = product.selected_or_first_available_variant.price
                                | money_with_currency
                              -%}
                              <span class="price-per-item--current s-m-price-per-item--current">
                                {{- 'products.product.volume_pricing.price_at_each_html' | t: price: variant_price -}}
                              </span>
                            {%- else -%}
                              {%- for price_break in volume_pricing_array -%}
                                {%- if current_qty_for_volume_pricing >= price_break.minimum_quantity -%}
                                  {%- assign price_break_price = price_break.price | money_with_currency -%}
                                  <span class="price-per-item--current s-m-price-per-item--current">
                                    {{-
                                      'products.product.volume_pricing.price_at_each_html'
                                      | t: price: price_break_price
                                    -}}
                                  </span>
                                  {%- break -%}
                                {%- endif -%}
                              {%- endfor -%}
                            {%- endif -%}
                          </div>
                        {%- else -%}
                          {%- assign variant_price = product.selected_or_first_available_variant.price
                            | money_with_currency
                          -%}
                          {%- assign variant_price_compare = product.selected_or_first_available_variant.compare_at_price -%}
                          <div class="price-per-item">
                            {%- if variant_price_compare -%}
                              <dl class="price-per-item--current">
                                <dt class="visually-hidden">
                                  {{ 'products.product.price.regular_price' | t }}
                                </dt>
                                <dd>
                                  <s class="variant-item__old-price">
                                    {{ variant_price_compare | money_with_currency }}
                                  </s>
                                </dd>
                                <dt class="visually-hidden">
                                  {{ 'products.product.price.sale_price' | t }}
                                </dt>
                                <dd>
                                  <span class="price-per-item--current s-m-price-per-item--current">
                                    {{-
                                      'products.product.volume_pricing.price_at_each_html'
                                      | t: price: variant_price
                                    -}}
                                  </span>
                                </dd>
                              </dl>
                            {%- else -%}
                              <span class="price-per-item--current s-m-price-per-item--current">
                                {{- 'products.product.volume_pricing.price_at_each_html' | t: price: variant_price -}}
                              </span>
                            {%- endif -%}
                          </div>
                        {%- endif -%}
                      </price-per-item>
                    {%- endif -%}
                  </div>
                  <div class="quantity__rules s-m-quantity__rules caption s-m-caption" id="Quantity-Rules-{{ section.id }}">
                    {%- if product.selected_or_first_available_variant.quantity_rule.increment > 1 -%}
                      <span class="divider s-m-divider">
                        {{-
                          'products.product.quantity.multiples_of'
                          | t: quantity: product.selected_or_first_available_variant.quantity_rule.increment
                        -}}
                      </span>
                    {%- endif -%}
                      {%- if product.selected_or_first_available_variant.quantity_rule.min > 1 -%}
                      <span class="divider s-m-divider">
                        {{-
                          'products.product.quantity.minimum_of'
                          | t: quantity: product.selected_or_first_available_variant.quantity_rule.min
                        -}}
                      </span>
                    {%- endif -%}
                      {%- if product.selected_or_first_available_variant.quantity_rule.max != null -%}
                      <span class="divider s-m-divider">
                        {{-
                          'products.product.quantity.maximum_of'
                          | t: quantity: product.selected_or_first_available_variant.quantity_rule.max
                        -}}
                      </span>
                    {%- endif -%}
                  </div>
                  {%- if product.quantity_price_breaks_configured? -%}
                    <volume-pricing class="parent-display" id="Volume-{{ section.id }}">
                      {%- if product.selected_or_first_available_variant.quantity_price_breaks.size > 0 -%}
                        <span class="caption-large s-m-caption-large">{{ 'products.product.volume_pricing.title' | t }}</span>
                        <ul class="list-unstyled s-m-list-unstyled">
                          <li>
                            <span>{{ product.selected_or_first_available_variant.quantity_rule.min }}+</span>
                            {%- assign price = product.selected_or_first_available_variant.price
                              | money_with_currency
                            -%}
                            <span data-text="{{ 'products.product.volume_pricing.price_at_each_html' | t: price: variant_price }}">
                              {{- 'sections.quick_order_list.each' | t: money: price -}}
                            </span>
                          </li>
                          {%- for price_break in product.selected_or_first_available_variant.quantity_price_breaks -%}
                            {%- assign price_break_price = price_break.price | money_with_currency -%}
                            <li class="{%- if forloop.index >= 3 -%}show-more-item s-m-show-more-item hidden s-m-hidden{%- endif -%}">
                              <span>
                                {{- price_break.minimum_quantity -}}
                                <span aria-hidden="true">+</span></span
                              >
                              <span data-text="{{ 'products.product.volume_pricing.price_at_each_html' | t: price: price_break_price }}">
                                {{- 'sections.quick_order_list.each' | t: money: price_break_price -}}
                              </span>
                            </li>
                          {%- endfor -%}
                        </ul>
                        {%- if product.selected_or_first_available_variant.quantity_price_breaks.size >= 3 -%}
                          <show-more-button>
                              <button
                              class="button-show-more s-m-button-show-more link s-m-link underlined-link s-m-underlined-link"
                              id="Show-More-{{ section.id }}"
                              type="button"
                            >
                              <span class="label-show-more s-m-label-show-more label-text s-m-label-text"
                                ><span aria-hidden="true">+ </span>{{ 'products.facets.show_more' | t }}
                              </span>
                            </button>
                          </show-more-button>
                        {%- endif -%}
                      {%- endif -%}
                    </volume-pricing>
                  {%- endif -%}
                </div>
              {%- when 'popup' -%}
                <modal-opener
                  class="product-popup-modal__opener s-m-product-popup-modal__opener quick-add-hidden s-m-quick-add-hidden"
                  data-modal="#PopupModal-{{ block.id }}"
                  {{ block.shopify_attributes }}
                >
                  <button
                    id="ProductPopup-{{ block.id }}"
                    class="product-popup-modal__button s-m-product-popup-modal__button link s-m-link"
                    type="button"
                    aria-haspopup="dialog"
                  >
                    {{ block.settings.text | default: block.settings.page.title | escape }}
                  </button>
                </modal-opener>
              {%- when 'share' -%}
                {% liquid
                  assign share_url = product.selected_variant.url | default: product.url | prepend: request.origin
                  render 'share-button', block: block, share_link: share_url
                %}

              {%- when 'variant_picker' -%}
                <div class="s-m-variant-picker">
                  <h3 class="s-m-variant-picker-title">OPTIONS</h3>
                  {% render 'product-variant-picker', product: product, block: block, product_form_id: product_form_id %}
                </div>
              {%- when 'buy_buttons' -%}
                {%- render 'buy-buttons',
                  block: block,
                  product: product,
                  product_form_id: product_form_id,
                  section_id: section.id,
                  show_pickup_availability: true,
                  buttons_layout: block.settings.button_layout
                -%}
              {%- when 'rating' -%}
                {%- if product.metafields.reviews.rating.value != blank -%}
                  <div class="rating-wrapper">
                    {% liquid
                      assign rating_decimal = 0
                      assign decimal = product.metafields.reviews.rating.value.rating | modulo: 1
                      if decimal >= 0.3 and decimal <= 0.7
                        assign rating_decimal = 0.5
                      elsif decimal > 0.7
                        assign rating_decimal = 1
                      endif
                    %}
                    <div
                      class="rating"
                      role="img"
                      aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: product.metafields.reviews.rating.value, rating_max: product.metafields.reviews.rating.value.scale_max }}"
                    >
                      <span
                        aria-hidden="true"
                        class="rating-star"
                        style="--rating: {{ product.metafields.reviews.rating.value.rating | floor }}; --rating-max: {{ product.metafields.reviews.rating.value.scale_max }}; --rating-decimal: {{ rating_decimal }};"
                      ></span>
                    </div>
                    <p class="rating-text s-m-rating-text caption s-m-caption">
                      <span aria-hidden="true">
                        {{- product.metafields.reviews.rating.value }} /
                        {{ product.metafields.reviews.rating.value.scale_max -}}
                      </span>
                    </p>
                    <p class="rating-count s-m-rating-count caption s-m-caption">
                      <span aria-hidden="true">({{ product.metafields.reviews.rating_count }})</span>
                      <span class="visually-hidden s-m-visually-hidden">
                        {{- product.metafields.reviews.rating_count }}
                        {{ 'accessibility.total_reviews' | t -}}
                      </span>
                    </p>
                  </div>
                {%- endif -%}
              {%- when 'complementary' -%}
                  <product-recommendations
                  class="complementary-products s-m-complementary-products quick-add-hidden s-m-quick-add-hidden{% if block.settings.make_collapsible_row %} is-accordion s-m-is-accordion{% endif %}{% if block.settings.enable_quick_add %} complementary-products-contains-quick-add s-m-complementary-products-contains-quick-add{% endif %}"
                  data-url="{{ routes.product_recommendations_url }}?limit={{ block.settings.product_list_limit }}&intent=complementary"
                  data-section-id="{{ section.id }}"
                  data-product-id="{{ product.id }}"
                >
                  {%- if recommendations.performed and recommendations.products_count > 0 -%}
                    <aside
                      aria-label="{{ 'accessibility.complementary_products' | t }}"
                      {{ block.shopify_attributes -}}
                        {% if block.settings.make_collapsible_row %}
                        class="product__accordion s-m-product__accordion accordion s-m-accordion"
                        {% endif %}
                      >
                        <div class="complementary-products__container s-m-complementary-products__container">
                          {%- if block.settings.make_collapsible_row -%}
                            <details id="Details-{{ block.id }}-{{ section.id }}" open>
                              <summary>
                          {%- endif %}
                          <div class="summary__title s-m-summary__title">
                            {%- if block.settings.make_collapsible_row -%}
                              {% render 'icon-accordion', icon: block.settings.icon %}
                              <h2 class="h4 s-m-h4 accordion__title s-m-accordion__title">{{ block.settings.block_heading }}</h2>
                            {%- else -%}
                              <h2 class="h3 s-m-h3 accordion__title s-m-accordion__title">{{ block.settings.block_heading }}</h2>
                            {%- endif -%}
                          </div>
                        {%- if block.settings.make_collapsible_row -%}
                          {{- 'icon-caret.svg' | inline_asset_content -}}
                          </summary>
                        {%- endif -%}
                        <slideshow-component class="slider-mobile-gutter s-m-slider-mobile-gutter">
                          {%- assign number_of_slides = recommendations.products_count
                            | plus: 0.0
                            | divided_by: block.settings.products_per_page
                            | ceil
                          -%}
                          <div
                            id="Slider-{{ block.id }}"
                            class="s-m-contains-card s-m-contains-card--product s-m-complementary-slider s-m-slider s-m-slider--everywhere"
                            role="list"
                            {% if number_of_slides > 1 %}
                              aria-label="{{ 'general.slider.name' | t }}"
                            {% endif %}
                          >
                            {% assign skip_card_product_styles = false %}
                            {%- for i in (1..number_of_slides) -%}
                              <div
                                id="Slide-{{ block.id }}-{{ forloop.index }}"
                                class="s-m-complementary-slide s-m-complementary-slide--{{ settings.card_style }} s-m-slider__slide s-m-slideshow__slide"
                                tabindex="-1"
                                role="group"
                                {% if number_of_slides > 1 %}
                                  aria-roledescription="{{ 'sections.slideshow.slide' | t }}"
                                  aria-label="{{ forloop.index }} {{ 'general.slider.of' | t }} {{ forloop.length }}"
                                {% endif %}
                              >
                                <ul class="list-unstyled" role="list">
                                  {%- for product in recommendations.products
                                    limit: block.settings.products_per_page
                                    offset: continue
                                  -%}
                                    <li>
                                      {%- if block.settings.enable_quick_add -%}
                                        {% assign quick_add = 'standard' %}
                                      {%- else -%}
                                        {% assign quick_add = 'none' %}
                                      {%- endif -%}
                                      {% render 'card-product',
                                        card_product: product,
                                        media_aspect_ratio: block.settings.image_ratio,
                                        show_secondary_image: false,
                                        lazy_load: false,
                                        skip_styles: skip_card_product_styles,
                                        quick_add: quick_add,
                                        section_id: section.id,
                                        horizontal_class: true,
                                        horizontal_quick_add: true
                                      %}
                                    </li>
                                    {%- assign skip_card_product_styles = true -%}
                                  {%- endfor -%}
                                </ul>
                              </div>
                            {%- endfor -%}
                          </div>
                          {%- if number_of_slides > 1 -%}
                          <div class="slider-buttons s-m-slider-buttons">
                            <button
                              type="button"
                              class="slider-button s-m-slider-button slider-button--prev s-m-slider-button--prev"
                              name="previous"
                              aria-label="{{ 'general.slider.previous_slide' | t }}"
                            >
                              <span class="svg-wrapper s-m-svg-wrapper">
                                {{- 'icon-caret.svg' | inline_asset_content -}}
                              </span>
                            </button>
                            <div class="slider-counter s-m-slider-counter slider-counter--{{ block.settings.pagination_style }} s-m-slider-counter--{{ block.settings.pagination_style }}{% if block.settings.pagination_style == 'counter' or block.settings.pagination_style == 'numbers' %} caption s-m-caption{% endif %}">
                              {%- if block.settings.pagination_style == 'counter' -%}
                                <span class="slider-counter--current s-m-slider-counter--current">1</span>
                                <span aria-hidden="true"> / </span>
                                <span class="visually-hidden s-m-visually-hidden">{{ 'general.slider.of' | t }}</span>
                                <span class="slider-counter--total s-m-slider-counter--total">{{ number_of_slides }}</span>
                              {%- else -%}
                                <div class="slideshow__control-wrapper s-m-slideshow__control-wrapper">
                                  {%- for i in (1..number_of_slides) -%}
                                    <button
                                      class="slider-counter__link s-m-slider-counter__link slider-counter__link--{{ block.settings.pagination_style }} s-m-slider-counter__link--{{ block.settings.pagination_style }} link s-m-link"
                                      aria-label="{{ 'sections.slideshow.load_slide' | t }} {{ forloop.index }} {{ 'general.slider.of' | t }} {{ forloop.length }}"
                                      aria-controls="Slider-{{ block.id }}"
                                    >
                                      {%- if block.settings.pagination_style == 'numbers' -%}
                                        {{ forloop.index -}}
                                      {%- else -%}
                                        <span class="dot s-m-dot"></span>
                                      {%- endif -%}
                                    </button>
                                  {%- endfor -%}
                                </div>
                              {%- endif -%}
                            </div>
                            <button
                              type="button"
                              class="slider-button s-m-slider-button slider-button--next s-m-slider-button--next"
                              name="next"
                              aria-label="{{ 'general.slider.next_slide' | t }}"
                            >
                              <span class="svg-wrapper s-m-svg-wrapper">
                                {{- 'icon-caret.svg' | inline_asset_content -}}
                              </span>
                            </button>
                          </div>
                          {%- endif -%}
                        </slideshow-component>
                        {%- if block.settings.make_collapsible_row -%}
                          </details>
                        {%- endif -%}
                      </div>
                    </aside>
                  {%- endif -%}
                  {{ 'component-card.css' | asset_url | stylesheet_tag }}
                  {{ 'component-complementary-products.css' | asset_url | stylesheet_tag }}
                  {%- if block.settings.enable_quick_add -%}
                    {{ 'quick-add.css' | asset_url | stylesheet_tag }}
                    <script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
                  {%- endif -%}
                </product-recommendations>
              {%- when 'icon-with-text' -%}
                {% render 'icon-with-text', block: block %}
              {% when 'trust_badge' %}
                <div class="trust-badges s-m-trust-badges" {{ block.shopify_attributes }}>
                  <div class="trust-badge s-m-trust-badge">
                    <div class="trust-badge__image s-m-trust-badge__image">
                      <img src="{{ block.settings.image1 | img_url: 'master' }}" alt="{{ block.settings.title1 | default: 'Certified Gems' }}">
                    </div>
                    <div class="trust-badge__content s-m-trust-badge__content">
                      <h3 class="s-m-trust-badge__title">{{ block.settings.title1 | default: 'Certified Gems' }}</h3>
                      <div class="s-m-trust-badge__description">
                        {% if block.settings.description1 != blank %}
                          {{ block.settings.description1 }}
                        {% else %}
                          <p>Every diamond and gemstone is GIA or IGI-certified and sourced with full transparency.</p>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                  <div class="trust-badge s-m-trust-badge">
                    <div class="trust-badge__image s-m-trust-badge__image">
                      <img src="{{ block.settings.image2 | img_url: 'master' }}" alt="{{ block.settings.title2 | default: 'Lifetime Warranty' }}">
                    </div>
                    <div class="trust-badge__content s-m-trust-badge__content">
                      <h3 class="s-m-trust-badge__title">{{ block.settings.title2 | default: 'Lifetime Warranty' }}</h3>
                      <div class="s-m-trust-badge__description">
                        {% if block.settings.description2 != blank %}
                          {{ block.settings.description2 }}
                        {% else %}
                          <p>All 10K, 14K, and 18K gold and silver jewelry comes with a lifetime warranty against manufacturing defects.</p>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                  <div class="trust-badge s-m-trust-badge">
                    <div class="trust-badge__image s-m-trust-badge__image">
                      <img src="{{ block.settings.image3 | img_url: 'master' }}" alt="{{ block.settings.title3 | default: 'Fast Insured Shipping' }}">
                    </div>
                    <div class="trust-badge__content s-m-trust-badge__content">
                      <h3 class="s-m-trust-badge__title">{{ block.settings.title3 | default: 'Fast Insured Shipping' }}</h3>
                      <div class="s-m-trust-badge__description">
                        {% if block.settings.description3 != blank %}
                          {{ block.settings.description3 }}
                        {% else %}
                          <p>Rest easy with insured shipping! Shipping costs are calculated at checkout.</p>
                        {% endif %}
                      </div>
                    </div>
                  </div>
                </div>
              {%- when 'center_diamond_selection' -%}
                {%- liquid
                  assign check_against_inventory = true
                  if product.selected_or_first_available_variant.inventory_management != 'shopify' or product.selected_or_first_available_variant.inventory_policy == 'continue'
                    assign check_against_inventory = false
                  endif
                  assign quantity_rule_soldout = false
                  if check_against_inventory
                    if product.selected_or_first_available_variant.quantity_rule.min > product.selected_or_first_available_variant.inventory_quantity
                      assign quantity_rule_soldout = true
                    endif
                  endif
                -%}
                <product-form
                  class="s-m-product-form"
                  data-section-id="{{ section.id }}"
                >
                  <div class="s-m-product-form__error-message-wrapper" role="alert" hidden>
                    <span class="svg-wrapper s-m-svg-wrapper">
                      {{- 'icon-error.svg' | inline_asset_content -}}
                    </span>
                    <span class="s-m-product-form__error-message"></span>
                  </div>
                  {%- form 'product',
                    product,
                    id: product_form_id,
                    class: 's-m-form',
                    novalidate: 'novalidate',
                    data-type: 'add-to-cart-form'
                  -%}
                    <input
                      type="hidden"
                      name="id"
                      value="{{ product.selected_or_first_available_variant.id }}"
                      {% if product.selected_or_first_available_variant.available == false
                        or quantity_rule_soldout
                        or product.selected_or_first_available_variant == null
                      %}
                        disabled
                      {% endif %}
                      class="s-m-product-variant-id"
                    >
                    <div class="s-m-center-diamond-selection" {{ block.shopify_attributes }}>
                      <div class="s-m-center-diamond-selection__header">
                        <h3 class="s-m-center-diamond-selection__title">CENTER DIAMOND SELECTION:</h3>
                      </div>
                      <button 
                        type="button" 
                        class="s-m-center-diamond-selection__add-button"
                        data-diamond-picker-trigger
                        id="addDiamondButton-{{ section.id }}"
                      >
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M11 13H5V11H11V5H13V11H19V13H13V19H11V13Z" fill="var(--Accent-Darkest, #4D3942)"/>
                        </svg>
                        <span>{{ block.settings.add_button_text | default: 'Add Center Diamond' }}</span>
                      </button>
                      <div class="s-m-center-diamond-selection__selected" id="selectedDiamondDisplay-{{ section.id }}" style="display: none;">
                        <div class="s-m-center-diamond-selection__selected-row1">
                          <div class="s-m-center-diamond-selection__selected-image">
                            <img id="selectedDiamondImage-{{ section.id }}" src="" alt="Selected Diamond">
                          </div>
                          <div class="s-m-center-diamond-selection__selected-info-wrapper">
                            <div class="s-m-center-diamond-selection__selected-details" id="selectedDiamondDetails-{{ section.id }}"></div>
                            <div class="s-m-center-diamond-selection__selected-price" id="selectedDiamondPrice-{{ section.id }}"></div>
                          </div>
                        </div>
                        <div class="s-m-center-diamond-selection__selected-row2">
                          <button type="button" class="s-m-center-diamond-selection__clear-button" data-clear-diamond>Clear</button>
                          <button type="button" class="s-m-center-diamond-selection__edit-button" data-diamond-picker-trigger-edit>Edit</button>
                        </div>
                      </div>
                      <div class="s-m-center-diamond-selection__disclaimer">
                        <svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                          <path d="M7.3612 12.2687H8.99702V7.3612H7.3612V12.2687ZM8.17911 5.72538C8.41085 5.72538 8.60511 5.64699 8.76187 5.49023C8.91864 5.33346 8.99702 5.13921 8.99702 4.90747C8.99702 4.67573 8.91864 4.48147 8.76187 4.32471C8.60511 4.16794 8.41085 4.08956 8.17911 4.08956C7.94737 4.08956 7.75312 4.16794 7.59635 4.32471C7.43958 4.48147 7.3612 4.67573 7.3612 4.90747C7.3612 5.13921 7.43958 5.33346 7.59635 5.49023C7.75312 5.64699 7.94737 5.72538 8.17911 5.72538ZM8.17911 16.3582C7.04767 16.3582 5.98438 16.1435 4.98926 15.7141C3.99413 15.2847 3.12851 14.702 2.39239 13.9658C1.65627 13.2297 1.07351 12.3641 0.644105 11.369C0.214702 10.3738 0 9.31056 0 8.17911C0 7.04767 0.214702 5.98438 0.644105 4.98926C1.07351 3.99413 1.65627 3.12851 2.39239 2.39239C3.12851 1.65627 3.99413 1.07351 4.98926 0.644105C5.98438 0.214702 7.04767 0 8.17911 0C9.31056 0 10.3738 0.214702 11.369 0.644105C12.3641 1.07351 13.2297 1.65627 13.9658 2.39239C14.702 3.12851 15.2847 3.99413 15.7141 4.98926C16.1435 5.98438 16.3582 7.04767 16.3582 8.17911C16.3582 9.31056 16.1435 10.3738 15.7141 11.369C15.2847 12.3641 14.702 13.2297 13.9658 13.9658C13.2297 14.702 12.3641 15.2847 11.369 15.7141C10.3738 16.1435 9.31056 16.3582 8.17911 16.3582ZM8.17911 14.7224C10.0058 14.7224 11.553 14.0885 12.8208 12.8208C14.0885 11.553 14.7224 10.0058 14.7224 8.17911C14.7224 6.35244 14.0885 4.80523 12.8208 3.53747C11.553 2.2697 10.0058 1.63582 8.17911 1.63582C6.35244 1.63582 4.80523 2.2697 3.53747 3.53747C2.2697 4.80523 1.63582 6.35244 1.63582 8.17911C1.63582 10.0058 2.2697 11.553 3.53747 12.8208C4.80523 14.0885 6.35244 14.7224 8.17911 14.7224Z" fill="var(--Accent-Darkest, #4D3942)"/>
                        </svg>
                        <p class="s-m-center-diamond-selection__disclaimer-text">
                          <strong>DISCLAIMER</strong><br>
                          {{ block.settings.disclaimer_text | default: 'Center diamond is not included. Diamond shown is for illustrative purposes only.' }}
                        </p>
                      </div>
                      <div class="s-m-center-diamond-selection__add-to-cart">
                        <button
                          type="submit"
                          name="add"
                          class="s-m-center-diamond-selection__add-to-cart-button"
                          id="addToCartButton-{{ section.id }}"
                          {% if product.selected_or_first_available_variant.available == false
                            or quantity_rule_soldout
                            or product.selected_or_first_available_variant == null
                          %}
                            disabled
                          {% endif %}
                        >
                          <span>
                            {%- if product.selected_or_first_available_variant == null -%}
                              {{ 'products.product.unavailable' | t }}
                            {%- elsif product.selected_or_first_available_variant.available == false or quantity_rule_soldout -%}
                              {{ 'products.product.sold_out' | t }}
                            {%- else -%}
                              {{ block.settings.add_to_cart_text | default: 'Add Setting Only to Cart' }}
                            {%- endif -%}
                          </span>
                          {%- render 'loading-spinner' -%}
                        </button>
                      </div>
                      {%- if block.settings.show_consult_link and block.settings.consult_link != blank -%}
                        <div class="s-m-center-diamond-selection__consult">
                          <a href="{{ block.settings.consult_link }}" class="s-m-center-diamond-selection__consult-link">
                            Consult an Expert
                          </a>
                        </div>
                      {%- endif -%}
                    </div>
                  {%- endform -%}
                </product-form>
            {%- endcase -%}
          {%- endfor -%}
        </section>
      </div>
    </div>

    {% render 'product-media-modal', variant_images: variant_images %}

    {% assign popups = section.blocks | where: 'type', 'popup' %}
    {%- for block in popups -%}
      <modal-dialog id="PopupModal-{{ block.id }}" class="product-popup-modal s-m-product-popup-modal" {{ block.shopify_attributes }}>
        <div
          role="dialog"
          aria-label="{{ block.settings.text }}"
          aria-modal="true"
          class="product-popup-modal__content s-m-product-popup-modal__content"
          tabindex="-1"
        >
          <button
            id="ModalClose-{{ block.id }}"
            type="button"
            class="product-popup-modal__toggle s-m-product-popup-modal__toggle"
            aria-label="{{ 'accessibility.close' | t }}"
          >
            {{- 'icon-close.svg' | inline_asset_content -}}
          </button>
          <div class="product-popup-modal__content-info s-m-product-popup-modal__content-info">
            <h1 class="h2 s-m-h2">{{ block.settings.page.title | escape }}</h1>
            {{ block.settings.page.content }}
          </div>
        </div>
      </modal-dialog>
    {%- endfor -%}

    <!-- Diamond Picker Modal -->
    <modal-dialog id="DiamondPickerModal-{{ section.id }}" class="s-m-diamond-picker-modal">
      <div
        role="dialog"
        aria-label="Select Center Diamond"
        aria-modal="true"
        class="s-m-diamond-picker-modal__content"
        tabindex="-1"
      >
        <div class="s-m-diamond-picker-modal__header">
          <h2 class="s-m-diamond-picker-modal__title">Select Center Diamond</h2>
          <button
            id="DiamondPickerClose-{{ section.id }}"
            type="button"
            class="s-m-diamond-picker-modal__close"
            aria-label="{{ 'accessibility.close' | t }}"
          >
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8.53366 25.3337L6.66699 23.467L14.1337 16.0003L6.66699 8.53366L8.53366 6.66699L16.0003 14.1337L23.467 6.66699L25.3337 8.53366L17.867 16.0003L25.3337 23.467L23.467 25.3337L16.0003 17.867L8.53366 25.3337Z" fill="var(--Schemes-On-Surface, #1D1B20)"/>
            </svg>
          </button>
        </div>
        
        <div class="s-m-diamond-picker-modal__body">
          <div class="s-m-diamond-picker-modal__body-header">
            <button
              type="button"
              class="s-m-diamond-picker-modal__hide-filters-btn"
              id="hideFiltersBtn-{{ section.id }}"
            >
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4.16699 10H15.8337" stroke="var(--Primary-Accent, #78686F)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Hide Filters
            </button>
            <div class="s-m-diamond-picker-modal__filters" id="diamondFilters-{{ section.id }}">
              <div class="s-m-diamond-picker-modal__filters-header">
                <h3>FILTERS</h3>
                <div class="s-m-diamond-picker-modal__filters-actions">
                  <button type="button" class="s-m-diamond-picker-modal__clear-btn" id="clearFilters-{{ section.id }}">Clear</button>
                  <button type="button" class="s-m-diamond-picker-modal__apply-btn" id="applyFilters-{{ section.id }}">Apply</button>
                </div>
              </div>
              
              <div class="s-m-diamond-picker-modal__filter-group">
                <h4>SHAPE</h4>
                <div class="s-m-diamond-picker-modal__shape-grid" id="shapeFilters-{{ section.id }}">
                  <button type="button" class="s-m-diamond-picker-modal__shape-btn" data-value="Cushion">
                    <svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none">
                      <path d="M19.2985 11.955L19.4285 22.3315M19.2985 11.955L33.892 18.6412M19.2985 11.955L33.6534 2.881L48.9408 13.2575M19.2985 11.955L16.9782 5.50769M19.2985 11.955L9.62726 10.5223L11.9041 20.4429M19.4285 22.3315L16.5445 32.6646M19.4285 22.3315L33.892 18.6412M19.4285 22.3315L11.9041 20.4429M33.892 18.6412L47.7482 22.744M33.892 18.6412L48.9408 13.2575M48.9408 13.2575L57.4194 10.2184L56.1183 22.0276M48.9408 13.2575L47.7482 22.744M48.9408 13.2575L51.955 6.00698M11.9041 20.4429L16.5445 32.6646M11.9041 20.4429L3.23039 32.6646L10.8199 44.1483M11.9041 20.4429L6.20114 17.4472M16.5445 32.6646L19.1901 43.714M16.5445 32.6646L10.8199 44.1483M19.1901 43.714L10.8199 44.1483M19.1901 43.714L17.8673 53.0703M19.1901 43.714L33.0463 47.7952M10.8199 44.1483L5.52893 47.0137M10.8199 44.1483L9.62726 55.9575L17.8673 53.0703M17.8673 53.0703L33.4149 63.6638L48.3554 54.2209M17.8673 53.0703L33.0463 47.7952M17.8673 53.0703L15.1785 60.2991M33.0463 47.7952L48.3554 54.2209M33.0463 47.7952L47.4013 43.866M48.3554 54.2209L51.0226 60.7115M48.3554 54.2209L47.4013 43.866M48.3554 54.2209L57.6796 55.9575M47.4013 43.866L55.2726 45.733M47.4013 43.866L50.2636 32.6646M57.9615 55.5885L55.2726 45.733M55.2726 45.733L61.4743 49.1845M55.2726 45.733L63.9464 32.6646L56.1183 22.0276M55.2726 45.733L50.2636 32.6646M56.1183 22.0276L50.2636 32.6646M56.1183 22.0276L47.7482 22.744M56.1183 22.0276L61.9298 19.0753M50.2636 32.6646L47.7482 22.744M33.6318 2.77246C30.2924 2.77246 15.9591 2.77246 9.60557 10.4137C3.25208 18.055 3.10029 32.5778 3.10029 32.5778C3.10029 32.5778 2.81839 47.7735 9.60557 55.8707C16.3928 63.9678 29.9454 63.5553 33.4149 63.5553C36.8844 63.5553 51.2177 63.5553 57.6796 55.8489C64.1415 48.1426 63.9897 42.0425 63.9897 32.6646C63.9897 23.2867 63.5777 17.4689 57.4845 10.2184C51.3912 2.96783 39.0311 2.77246 33.6318 2.77246Z" stroke="#78686F" stroke-width="0.986667"/>
                    </svg>
                    <span>Cushion</span>
                  </button>
                  <button type="button" class="s-m-diamond-picker-modal__shape-btn" data-value="Round">
                    <svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none">
                      <path d="M25.4944 14.0722L33.3703 3.01982L41.3767 13.9852M25.4944 14.0722L12.0705 11.9618L14.3114 25.364M25.4944 14.0722L22.8617 22.5138L18.4234 33.3922L14.3984 41.2464M25.4944 14.0722L33.3485 18.0972L44.2486 22.5573L52.6685 25.1681M25.4944 14.0722L21.861 5.43481M41.3767 13.9852L54.7789 11.7442L52.6685 25.1681M41.3767 13.9852L33.5661 18.0972L22.7095 22.6662L14.3114 25.364M41.3767 13.9852L44.0964 22.4051L48.6435 33.24L52.7556 41.0506M41.3767 13.9852L44.9449 5.26075M14.3114 25.364L18.4234 33.1746L22.9923 44.0312L25.7119 52.4293M14.3114 25.364L3.34598 33.3705L14.3984 41.2464M14.3114 25.364L5.6522 21.8394M14.3984 41.2464L22.84 43.879L33.7401 48.3173L41.5943 52.3641M14.3984 41.2464L12.3097 54.6921L25.7119 52.4293M14.3984 41.2464L5.76098 44.9016M52.6685 25.1681L63.7427 33.0659L52.7556 41.0506M52.6685 25.1681L48.6435 33.0224L44.2051 43.9225L41.5943 52.3641M52.7556 41.0506L55.0183 54.4527L41.5943 52.3641M52.7556 41.0506L44.3575 43.7702L33.5226 48.3173L25.7119 52.4293M41.5943 52.3641L33.6966 63.4165L25.7119 52.4293M41.5943 52.3641L45.2277 61.0233M25.7119 52.4293L22.122 61.1974M61.3494 21.5348L52.6902 25.1681M61.5018 44.6187L52.7556 41.0723M44.2486 43.8137L48.6 33.1311L44.1399 22.5138L33.4574 18.1407L22.84 22.6008L18.4669 33.2835L22.9489 43.9225L33.6314 48.2738L44.2486 43.8137ZM45.04 5.03481C60.6053 11.3837 68.0766 29.1487 61.7277 44.7138C55.3788 60.2791 37.6139 67.7504 22.0486 61.4015C6.48343 55.0526 -0.98791 37.2878 5.36098 21.7225C11.7098 6.15725 29.4748 -1.31408 45.04 5.03481Z" stroke="#78686F" stroke-width="0.986667"/>
                    </svg>
                    <span>Round</span>
                  </button>
                  <button type="button" class="s-m-diamond-picker-modal__shape-btn" data-value="Princess">
                    <svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none">
                      <path d="M10.3616 18.0808V17.5875H9.8683V18.0808H10.3616ZM18.4921 18.0808V18.5741H18.9854V18.0808H18.4921ZM18.4921 9.75332V9.25998H17.9987V9.75332H18.4921ZM48.3313 9.75332H48.8247V9.25998H48.3313V9.75332ZM48.3313 18.4527H47.838V18.946H48.3313V18.4527ZM57.0086 18.4527H57.5019V17.9593H57.0086V18.4527ZM57.0086 48.0705V48.5639H57.5019V48.0705H57.0086ZM3.0988 2.77165V2.27832H2.60547V2.77165H3.0988ZM63.9902 2.77165H64.4836V2.27832H63.9902V2.77165ZM63.9902 63.663V64.1564H64.4836V63.663H63.9902ZM3.0988 63.663H2.60547V64.1564H3.0988V63.663ZM48.1587 9.66477L48.2924 10.1396C48.314 10.1336 48.3351 10.126 48.3556 10.1171L48.1587 9.66477ZM18.5851 17.9945L18.4513 17.5197C18.2847 17.5666 18.1549 17.6974 18.1092 17.8644L18.5851 17.9945ZM3.59908 63.663L3.14648 63.4668C3.06347 63.6582 3.10983 63.8811 3.26227 64.0236C3.41472 64.1659 3.64028 64.1971 3.82561 64.1013L3.59908 63.663ZM56.5525 18.7117L56.1055 18.5031C56.0939 18.528 56.0845 18.5536 56.0772 18.5801L56.5525 18.7117ZM3.33787 3.28963L3.52814 2.83446C3.33938 2.75556 3.12152 2.80135 2.98048 2.94956C2.83946 3.09778 2.80454 3.31766 2.89272 3.50226L3.33787 3.28963ZM18.3238 9.55409L18.1336 10.0093C18.1501 10.0161 18.1669 10.0221 18.1839 10.0271L18.3238 9.55409ZM48.3313 18.4306L48.806 18.2962C48.7598 18.1334 48.6335 18.0055 48.4712 17.9575L48.3313 18.4306ZM56.7496 48.159L56.2749 48.2935C56.2821 48.319 56.2914 48.3438 56.3026 48.3678L56.7496 48.159ZM10.3616 17.9945L10.8385 17.8683C10.8306 17.8386 10.82 17.8097 10.8067 17.7818L10.3616 17.9945ZM10.855 48.0705V18.0808H9.8683V48.0705H10.855ZM10.3616 18.5741H18.4921V17.5875H10.3616V18.5741ZM18.9854 18.0808V9.75332H17.9987V18.0808H18.9854ZM18.4921 10.2467H48.3313V9.25998H18.4921V10.2467ZM47.838 9.75332V18.4527H48.8247V9.75332H47.838ZM48.3313 18.946H57.0086V17.9593H48.3313V18.946ZM56.5152 18.4527V48.0705H57.5019V18.4527H56.5152ZM57.0086 47.5772H48.4198V48.5639H57.0086V47.5772ZM47.9265 48.0705V56.0528H48.9132V48.0705H47.9265ZM48.4198 55.5594H18.3217V56.5461H48.4198V55.5594ZM18.815 56.0528V48.0705H17.8283V56.0528H18.815ZM18.3217 47.5772H10.3616V48.5639H18.3217V47.5772ZM3.0988 3.26499H63.9902V2.27832H3.0988V3.26499ZM63.4969 2.77165V63.663H64.4836V2.77165H63.4969ZM63.9902 63.1697H3.0988V64.1564H63.9902V63.1697ZM3.59214 63.663V2.77165H2.60547V63.663H3.59214ZM63.7933 2.31934L47.9617 9.21246L48.3556 10.1171L64.1872 3.22397L63.7933 2.31934ZM48.0249 9.18991L18.4513 17.5197L18.7188 18.4694L48.2924 10.1396L48.0249 9.18991ZM18.1092 17.8644L9.88577 47.9404L10.8375 48.2007L19.061 18.1246L18.1092 17.8644ZM9.90895 47.8743L3.14648 63.4668L4.05168 63.8594L10.8142 48.2669L9.90895 47.8743ZM3.82561 64.1013L18.5482 56.4909L18.0951 55.6145L3.37254 63.2248L3.82561 64.1013ZM18.4482 56.5296L48.5463 48.5474L48.2933 47.5937L18.1952 55.5759L18.4482 56.5296ZM48.8953 48.2023L57.028 18.8434L56.0772 18.5801L47.9445 47.9388L48.8953 48.2023ZM56.9996 18.9204L64.4373 2.98025L63.5432 2.56305L56.1055 18.5031L56.9996 18.9204ZM3.1476 3.7448L18.1336 10.0093L18.5142 9.09893L3.52814 2.83446L3.1476 3.7448ZM18.1839 10.0271L48.1913 18.9037L48.4712 17.9575L18.4638 9.08102L18.1839 10.0271ZM47.8566 18.565L56.2749 48.2935L57.2243 48.0247L48.806 18.2962L47.8566 18.565ZM56.3026 48.3678L63.5433 63.8718L64.4372 63.4543L57.1965 47.9504L56.3026 48.3678ZM64.2069 63.2198L48.6365 55.6096L48.2032 56.496L63.7737 64.1063L64.2069 63.2198ZM48.5463 55.5759L18.4482 47.5937L18.1952 48.5474L48.2933 56.5296L48.5463 55.5759ZM18.7986 47.9443L10.8385 17.8683L9.88468 18.1208L17.8447 48.1967L18.7986 47.9443ZM10.8067 17.7818L3.78304 3.07701L2.89272 3.50226L9.91645 18.2071L10.8067 17.7818Z" fill="#78686F"/>
                    </svg>
                    <span>Princess</span>
                  </button>
                  <button type="button" class="s-m-diamond-picker-modal__shape-btn" data-value="Pear">
                    <svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none">
                      <path d="M40.3302 54.2473L52.2607 55.9626L49.5787 44.3561M40.3302 54.2473L41.5854 46.9425M40.3302 54.2473L33.6801 63.4668M49.5787 44.3561L44.437 37.4636L49.3629 30.8946M49.5787 44.3561L56.7948 38.4188L49.3629 30.8946M49.5787 44.3561L41.5854 46.9425M41.5854 46.9425L44.437 37.4591L41.5193 25.3075M41.5854 46.9425L33.6757 50.7256M49.3629 30.8946L50.3318 19.348L39.445 16.3693L33.5039 19.8045L41.5193 25.3075M49.3629 30.8946L41.5193 25.3075M49.3629 30.8946L54.6126 27.7188M41.5193 25.3075L39.445 16.3671M39.445 16.3671L42.9242 10.1682M39.445 16.3671L33.5039 3.18935M33.6757 50.7256L40.3324 54.2494L44.0296 61.3126M33.6757 50.7256L25.7484 46.9402L22.6149 38.0464M33.6757 50.7256L27.0035 54.2472L23.4583 61.3569M49.5787 44.3539L56.515 47.1796M22.6149 38.0464L17.7529 44.3539M22.6149 38.0464L17.8189 30.8924M22.6149 38.0464L25.3124 25.3053L27.7346 16.3671M27.0014 54.2472L15.139 55.9005L17.7529 44.3539M17.7529 44.3539L10.6667 46.353M17.8189 30.8924L16.9755 19.1507L27.7346 16.3671M17.8189 30.8924L12.4812 27.9581M27.7346 16.3671L33.6757 19.8023L25.3146 25.3053L17.821 30.8902L10.4091 38.4166L17.7572 44.3561L25.7506 46.9402L27.0057 54.245L33.6779 63.6641M27.7346 16.3671L24.861 9.58541M27.7346 16.3671L33.6757 3.18935M33.592 2.77268C33.592 2.77268 10.1272 16.0613 10.1272 42.2884C10.1272 62.8995 32.077 63.6641 33.592 63.6641C35.1004 63.6641 56.9665 63.5089 56.9665 42.2884C57.0568 16.0414 33.592 2.77268 33.592 2.77268Z" stroke="#78686F" stroke-width="0.986667"/>
                    </svg>
                    <span>Pear</span>
                  </button>
                  <button type="button" class="s-m-diamond-picker-modal__shape-btn" data-value="Marquise">
                    <svg xmlns="http://www.w3.org/2000/svg" width="39" height="62" viewBox="0 0 39 62" fill="none">
                      <path d="M27.3357 6.47407L23.8479 9.08598M23.8479 9.08598L24.4204 17.2406L31.8665 23.0666L28.2959 30.5925L31.5921 38.6164M23.8479 9.08598L19.2279 11.0848M23.8479 9.08598L19.402 0.929221H19.0537L14.6123 9.08381L5.75102 13.8251L6.58712 23.0687M23.8479 9.08598L32.7047 13.8251L31.8708 23.0666L37.4749 30.5925L31.5921 38.6164M31.5921 38.6164L24.7035 43.8115M31.5921 38.6164L32.8767 47.9463L23.7434 52.6213L19.4042 60.9507H19.0558L14.7146 52.6213M19.2279 11.0848L24.4249 17.2384L28.3002 30.5925L24.7035 43.8115M19.2279 11.0848L14.6078 9.09042L14.0331 17.245L6.58712 23.0687M19.2279 11.0848L14.0309 17.2384L10.1773 30.5925L13.7522 43.8115M6.58712 23.0687L0.983052 30.5947L6.88322 38.6164L5.58121 47.9463L14.7146 52.6213M6.58712 23.0687L10.1795 30.5969L6.88322 38.6209L13.7522 43.8115M23.7412 52.6213L24.7035 43.8115M23.7412 52.6213L19.2279 50.9058M23.7412 52.6213L27.573 55.2333M24.7035 43.8115L19.2279 50.9058M19.2279 50.9058L13.7522 43.8115M19.2279 50.9058L14.7146 52.6213M14.7146 52.6213L13.7522 43.8115M14.7146 52.6213L10.8827 55.2333M11.1418 6.47407L14.6078 9.08598M19.402 61.3845C24.9911 58.4958 29.6841 54.0898 32.9606 48.6551C36.2371 43.2203 37.9692 36.9691 37.9648 30.5947C37.9648 9.75671 19.402 0.493164 19.402 0.493164H19.0537C19.0537 0.493164 0.493172 9.75671 0.493172 30.5925C0.488929 36.9671 2.22132 43.2184 5.49824 48.6532C8.77515 54.088 13.4686 58.4939 19.0581 61.3824L19.402 61.3845Z" stroke="#78686F" stroke-width="0.986667"/>
                    </svg>
                    <span>Marquise</span>
                  </button>
                  <button type="button" class="s-m-diamond-picker-modal__shape-btn" data-value="Oval">
                    <svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none">
                      <path d="M51.4466 43.4405L46.8287 39.3277M39.7075 54.2694L41.3807 45.8754L46.8308 39.3299M39.7075 54.2694L33.6129 51.5755L41.3829 45.8777L43.2702 33.3089L46.8308 39.3299M39.7075 54.2694L42.9251 60.1863M39.7075 54.2694L33.6129 63.6638M39.7075 54.2694L48.4408 53.052L46.8308 39.3299M46.8308 39.3299L52.2635 33.8047V33.4793L46.833 27.1042L49.1529 15.7109L39.7075 12.1891M39.7075 12.1891L33.6129 2.77246M39.7075 12.1891L40.2864 21.9288L46.8308 27.1086L43.2702 33.4793L40.2885 21.9288L33.6129 16.4303L39.7075 12.1891ZM39.7075 12.1891L43.7421 7.25277M51.6388 25.0191L46.833 27.1065M15.4778 42.44L20.3709 39.3299M20.3709 39.3299L26.2295 45.725M20.3709 39.3299L23.9315 33.3067L26.2295 45.725M20.3709 39.3299L18.4813 52.5738L27.4965 54.2694M20.3709 39.3299L14.9404 33.807V33.4816L20.3709 27.1065L18.0554 15.432L27.49 12.1891L33.591 2.77246M26.2295 45.725L27.4965 54.2694M26.2295 45.725L33.591 51.5732L27.4965 54.2694M27.4965 54.2694L23.8704 59.945M27.4965 54.2694L33.591 63.6638M15.5412 24.3859L20.3687 27.1086M20.3687 27.1086L26.9155 21.9288M20.3687 27.1086L23.9315 33.4793L26.9155 21.9288M26.9155 21.9288L27.4965 12.1891M26.9155 21.9288L33.591 16.4303L27.4965 12.1891M27.4965 12.1891L23.4379 7.16422M14.8115 33.652C14.8115 14.6018 23.2041 2.77246 33.5473 2.77246C43.8907 2.77246 52.2831 14.5797 52.2831 33.6299C52.2831 52.6822 43.8907 63.6638 33.5473 63.6638C23.2041 63.6638 14.8115 52.7907 14.8115 33.652Z" stroke="#78686F" stroke-width="0.986667"/>
                    </svg>
                    <span>Oval</span>
                  </button>
                  <button type="button" class="s-m-diamond-picker-modal__shape-btn" data-value="Heart">
                    <svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none">
                      <path d="M33.5133 12.524V20.869M27.5047 48.4027L33.3392 47.1205M27.5047 48.4027L15.5094 48.5329L16.3584 38.0584L16.8374 30.561L10.1975 26.0409M27.5047 48.4027L23.1072 54.7481M33.3392 47.1205H33.6875M33.3392 47.1205L25.0013 41.9918L17.3817 31.1478L13.9637 21.3469L33.557 16.0879L22.3017 6.4391L13.9201 15.0449M10.1975 26.0409L6.54009 35.2768L24.8271 41.6441L27.8532 48.0549L33.4264 60.0072H33.6005L39.1737 48.0549L42.5481 42.5134L60.5086 35.2768L56.8292 26.041M10.1975 26.0409L4.4066 16.327L13.9201 15.0449M10.1975 26.0409L13.6154 21.3469L13.9201 15.0449M10.1975 26.0409L3.88408 28.5183M33.6875 47.1205L39.5219 48.4027M33.6875 47.1205L42.5481 42.1656L49.6452 31.1478L53.0631 21.3469L33.4699 16.0879L44.7251 6.4391L53.1284 15.0449M13.9201 15.0449L24.0215 18.6523L33.4262 20.9341H33.6004L43.0052 18.6523L53.1284 15.0449M13.9201 15.0449L10.8723 7.65619M39.5219 48.4027L51.0601 48.9678L50.6683 38.0585L50.1894 30.5612L56.8292 26.041M39.5219 48.4027L43.2664 55.183M53.1284 15.0449L53.4113 21.347L56.8292 26.041M53.1284 15.0449L62.6203 16.327L56.8292 26.041M53.1284 15.0449L56.1544 7.65619M56.8292 26.041L63.1426 28.5184M50.7118 39.232L56.6116 42.7743M16.119 38.8842L10.6982 43.1436M33.5136 60.5938C33.5136 60.5938 63.9921 48.12 63.9921 21.3468C63.9921 14.5014 58.5494 5.7002 49.493 5.7002C37.9983 5.7002 33.5136 12.4587 33.5136 12.4587C33.5136 12.4587 29.1596 5.7002 17.5996 5.7002C8.56492 5.7002 3.10059 14.5014 3.10059 21.3468C3.10059 48.12 33.5789 60.5938 33.5789 60.5938H33.5136Z" stroke="#78686F" stroke-width="0.986667" stroke-linejoin="round"/>
                    </svg>
                    <span>Heart</span>
                  </button>
                  <button type="button" class="s-m-diamond-picker-modal__shape-btn" data-value="Radiant">
                    <svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none">
                      <path d="M57.4243 50.4399L47.6181 47.2457L50.7702 57.0962M57.4243 50.4399V16.0186M57.4243 50.4399L50.7702 57.0962M50.7702 57.0962L54.3142 63.6638M50.7702 57.0962L33.5463 49.5257L16.3467 57.0962M50.7702 57.0962H16.3467M57.4243 16.0186L50.0309 33.2182L57.4243 50.4443L63.9921 53.986M57.4243 16.0186L63.9921 12.4702M57.4243 16.0186L50.7681 9.35568H16.3467M57.4243 16.0186L47.6181 19.2128L50.7702 9.36232M54.3142 63.6638L63.9921 53.986M54.3142 63.6638H12.7984M16.3467 57.0962L12.7984 63.6638M16.3467 57.0962L9.6838 50.4399V16.0186L16.3467 9.35568M63.9921 53.986V12.4702M63.9921 12.4702L54.3142 2.77246M16.3467 9.35568L33.5463 16.9306L50.7725 9.3601L54.3142 2.77246M16.3467 9.35568L12.7961 2.77246M54.3142 2.77246L12.7984 2.77467L3.1028 12.4702L3.10059 53.986M12.7984 63.6638L3.10059 53.986M3.10059 53.986L9.68822 50.4443L17.0595 33.2182L9.68822 16.0186M9.68822 50.4399L19.4945 47.2457L16.3445 57.0962M9.68822 16.0186L3.10059 12.468M9.68822 16.0186L19.4945 19.2128L16.3445 9.36232M33.5463 17.0811L47.4211 19.3877L49.5506 33.2182L47.4211 47.0708L33.5463 49.3774L19.6715 47.0708L17.5642 33.2182L19.6715 19.3877L33.5463 17.0811Z" stroke="#78686F" stroke-width="0.986667"/>
                    </svg>
                    <span>Radiant</span>
                  </button>
                  <button type="button" class="s-m-diamond-picker-modal__shape-btn" data-value="Asscher">
                    <svg xmlns="http://www.w3.org/2000/svg" width="62" height="62" viewBox="0 0 62 62" fill="none">
                      <path d="M47.1839 21.3268L61.3846 12.9542M0.493164 48.5973L14.52 40.4641M0.493164 48.5973L13.3239 61.3845M0.493164 48.5973V12.7584M13.3239 61.3845H48.4451M13.3239 61.3845L21.4137 47.3361M0.493164 12.7584L12.6497 0.493164H48.8148M0.493164 12.7584L14.7375 21.3485M40.1596 47.3361L48.4451 61.3845M48.4451 61.3845L61.2542 48.6191M61.2542 48.6191V12.9107L48.8148 0.493164M61.2542 48.6191L47.1839 40.4641M12.6497 0.667143L21.0875 14.6504M21.0875 14.6504L14.5634 21.218V40.4641L21.4572 47.3361H40.3119L47.1839 40.4641M21.0875 14.6504H40.5075L47.1839 21.305V40.4641M48.8148 0.493164L40.464 14.6287M43.139 10.1488L51.6637 18.6301V43.0519L42.8997 51.7941H18.8693L10.0835 43.0519V18.5214L18.4127 10.1488H43.139ZM45.8573 5.58195L56.2523 15.9552V45.7702L45.5528 56.4481H16.2162L5.49496 45.7485V15.803L15.6508 5.58195H45.8573Z" stroke="#78686F" stroke-width="0.986667"/>
                    </svg>
                    <span>Asscher</span>
                  </button>
                  <button type="button" class="s-m-diamond-picker-modal__shape-btn" data-value="Emerald">
                    <svg xmlns="http://www.w3.org/2000/svg" width="68" height="68" viewBox="0 0 68 68" fill="none">
                      <path d="M57.1767 10.6653L47.8281 17.2542M50.879 2.5957L45.3829 14.2231M50.879 2.5957H15.8847M50.879 2.5957L57.1793 10.6653V56.4275L50.879 64.4971M45.3829 14.2231L47.8281 17.252V25.4296M45.3829 14.2231H21.3808M15.8847 2.5957L21.3808 14.2231M15.8847 2.5957L9.5625 10.6653V56.4275L15.8847 64.4971M50.879 64.4971L45.3829 52.87M50.879 64.4971H15.8847M21.3808 14.2231L18.9356 17.2542M54.0621 25.4318V12.9426L49.0396 6.57426H17.724L12.6796 12.9426V25.4318M9.5647 10.6653L18.9356 17.2542M18.9356 17.2542V25.4318M15.8847 64.4971L21.3808 52.87M15.8869 25.4318V15.1749L19.6692 10.6653H47.0945L50.879 15.1749V51.918L47.0945 56.4275H19.6692L15.8847 51.918V25.4318M57.1767 56.4275L47.8281 49.8185M47.8281 49.8185L45.3829 52.87M47.8281 49.8185V25.4341M45.3829 52.87H21.3808M21.3808 52.87L18.9356 49.8185M54.0621 25.4341V54.128L49.0396 60.4961H17.724L12.6796 54.128V25.4341M9.5647 56.4275L18.9356 49.8185M18.9356 49.8185V25.4341" stroke="#78686F" stroke-width="0.984743"/>
                    </svg>
                    <span>Emerald</span>
                  </button>
                </div>
              </div>
              
              <div class="s-m-diamond-picker-modal__filter-group">
                <h4>SOURCE <span class="s-m-diamond-picker-modal__info-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.8 18H13.2V10.8H10.8V18ZM12 8.4C12.34 8.4 12.625 8.285 12.855 8.055C13.085 7.825 13.2 7.54 13.2 7.2C13.2 6.86 13.085 6.575 12.855 6.345C12.625 6.115 12.34 6 12 6C11.66 6 11.375 6.115 11.145 6.345C10.915 6.575 10.8 6.86 10.8 7.2C10.8 7.54 10.915 7.825 11.145 8.055C11.375 8.285 11.66 8.4 12 8.4ZM12 24C10.34 24 8.78 23.685 7.32 23.055C5.86 22.425 4.59 21.57 3.51 20.49C2.43 19.41 1.575 18.14 0.945 16.68C0.315 15.22 0 13.66 0 12C0 10.34 0.315 8.78 0.945 7.32C1.575 5.86 2.43 4.59 3.51 3.51C4.59 2.43 5.86 1.575 7.32 0.945C8.78 0.315 10.34 0 12 0C13.66 0 15.22 0.315 16.68 0.945C18.14 1.575 19.41 2.43 20.49 3.51C21.57 4.59 22.425 5.86 23.055 7.32C23.685 8.78 24 10.34 24 12C24 13.66 23.685 15.22 23.055 16.68C22.425 18.14 21.57 19.41 20.49 20.49C19.41 21.57 18.14 22.425 16.68 23.055C15.22 23.685 13.66 24 12 24ZM12 21.6C14.68 21.6 16.95 20.67 18.81 18.81C20.67 16.95 21.6 14.68 21.6 12C21.6 9.32 20.67 7.05 18.81 5.19C16.95 3.33 14.68 2.4 12 2.4C9.32 2.4 7.05 3.33 5.19 5.19C3.33 7.05 2.4 9.32 2.4 12C2.4 14.68 3.33 16.95 5.19 18.81C7.05 20.67 9.32 21.6 12 21.6Z" fill="var(--Accent-Darkest, #4D3942)"/></svg></span></h4>
                <div class="s-m-diamond-picker-modal__pill-toggle" data-name="type" role="tablist">
                  <button role="tab" data-value="all" class="s-m-diamond-picker-modal__pill">All</button>
                  <button role="tab" data-value="lab" class="s-m-diamond-picker-modal__pill is-active">Lab Grown</button>
                  <button role="tab" data-value="natural" class="s-m-diamond-picker-modal__pill">Natural</button>
                </div>
              </div>
              
              <div class="s-m-diamond-picker-modal__filter-group">
                <h4>CARATS</h4>
                <div class="s-m-diamond-picker-modal__range-controls">
                  <input type="number" class="s-m-diamond-picker-modal__range-input min" data-name="caratMin" value="0.25" step="0.01" min="0" max="10">
                  <input type="number" class="s-m-diamond-picker-modal__range-input max" data-name="caratMax" value="10" step="0.01" min="0" max="10">
                </div>
                <div class="s-m-diamond-picker-modal__range-slider" data-name="carats">
                  <div class="s-m-diamond-picker-modal__slider-container">
                    <div class="s-m-diamond-picker-modal__slider-handle min">
                      <svg width="28" height="28" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 18C0 8.05888 8.05888 0 18 0C27.9411 0 36 8.05888 36 18C36 27.9411 27.9411 36 18 36C8.05888 36 0 27.9411 0 18Z" fill="var(--Darker-Accent, #69575F)"/>
                      </svg>
                    </div>
                    <div class="s-m-diamond-picker-modal__slider-track"></div>
                    <div class="s-m-diamond-picker-modal__slider-handle max">
                      <svg width="28" height="28" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 18C0 8.05888 8.05888 0 18 0C27.9411 0 36 8.05888 36 18C36 27.9411 27.9411 36 18 36C8.05888 36 0 27.9411 0 18Z" fill="var(--Darker-Accent, #69575F)"/>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="s-m-diamond-picker-modal__filter-group">
                <h4>COLOR <span class="s-m-diamond-picker-modal__info-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.8 18H13.2V10.8H10.8V18ZM12 8.4C12.34 8.4 12.625 8.285 12.855 8.055C13.085 7.825 13.2 7.54 13.2 7.2C13.2 6.86 13.085 6.575 12.855 6.345C12.625 6.115 12.34 6 12 6C11.66 6 11.375 6.115 11.145 6.345C10.915 6.575 10.8 6.86 10.8 7.2C10.8 7.54 10.915 7.825 11.145 8.055C11.375 8.285 11.66 8.4 12 8.4ZM12 24C10.34 24 8.78 23.685 7.32 23.055C5.86 22.425 4.59 21.57 3.51 20.49C2.43 19.41 1.575 18.14 0.945 16.68C0.315 15.22 0 13.66 0 12C0 10.34 0.315 8.78 0.945 7.32C1.575 5.86 2.43 4.59 3.51 3.51C4.59 2.43 5.86 1.575 7.32 0.945C8.78 0.315 10.34 0 12 0C13.66 0 15.22 0.315 16.68 0.945C18.14 1.575 19.41 2.43 20.49 3.51C21.57 4.59 22.425 5.86 23.055 7.32C23.685 8.78 24 10.34 24 12C24 13.66 23.685 15.22 23.055 16.68C22.425 18.14 21.57 19.41 20.49 20.49C19.41 21.57 18.14 22.425 16.68 23.055C15.22 23.685 13.66 24 12 24ZM12 21.6C14.68 21.6 16.95 20.67 18.81 18.81C20.67 16.95 21.6 14.68 21.6 12C21.6 9.32 20.67 7.05 18.81 5.19C16.95 3.33 14.68 2.4 12 2.4C9.32 2.4 7.05 3.33 5.19 5.19C3.33 7.05 2.4 9.32 2.4 12C2.4 14.68 3.33 16.95 5.19 18.81C7.05 20.67 9.32 21.6 12 21.6Z" fill="var(--Accent-Darkest, #4D3942)"/></svg></span></h4>
                <div class="s-m-diamond-picker-modal__color-grid" data-name="color">
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">D</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__color-option" data-value="D" value="D">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">E</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__color-option" data-value="E" value="E">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">F</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__color-option" data-value="F" value="F">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">G</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__color-option" data-value="G" value="G">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">H</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__color-option" data-value="H" value="H">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">I</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__color-option" data-value="I" value="I">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">J</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__color-option" data-value="J" value="J">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">K</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__color-option" data-value="K" value="K">
                  </label>
                </div>
              </div>
              
              <div class="s-m-diamond-picker-modal__filter-group">
                <h4>CLARITY <span class="s-m-diamond-picker-modal__info-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.8 18H13.2V10.8H10.8V18ZM12 8.4C12.34 8.4 12.625 8.285 12.855 8.055C13.085 7.825 13.2 7.54 13.2 7.2C13.2 6.86 13.085 6.575 12.855 6.345C12.625 6.115 12.34 6 12 6C11.66 6 11.375 6.115 11.145 6.345C10.915 6.575 10.8 6.86 10.8 7.2C10.8 7.54 10.915 7.825 11.145 8.055C11.375 8.285 11.66 8.4 12 8.4ZM12 24C10.34 24 8.78 23.685 7.32 23.055C5.86 22.425 4.59 21.57 3.51 20.49C2.43 19.41 1.575 18.14 0.945 16.68C0.315 15.22 0 13.66 0 12C0 10.34 0.315 8.78 0.945 7.32C1.575 5.86 2.43 4.59 3.51 3.51C4.59 2.43 5.86 1.575 7.32 0.945C8.78 0.315 10.34 0 12 0C13.66 0 15.22 0.315 16.68 0.945C18.14 1.575 19.41 2.43 20.49 3.51C21.57 4.59 22.425 5.86 23.055 7.32C23.685 8.78 24 10.34 24 12C24 13.66 23.685 15.22 23.055 16.68C22.425 18.14 21.57 19.41 20.49 20.49C19.41 21.57 18.14 22.425 16.68 23.055C15.22 23.685 13.66 24 12 24ZM12 21.6C14.68 21.6 16.95 20.67 18.81 18.81C20.67 16.95 21.6 14.68 21.6 12C21.6 9.32 20.67 7.05 18.81 5.19C16.95 3.33 14.68 2.4 12 2.4C9.32 2.4 7.05 3.33 5.19 5.19C3.33 7.05 2.4 9.32 2.4 12C2.4 14.68 3.33 16.95 5.19 18.81C7.05 20.67 9.32 21.6 12 21.6Z" fill="var(--Accent-Darkest, #4D3942)"/></svg></span></h4>
                <div class="s-m-diamond-picker-modal__clarity-grid" data-name="clarity">
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">IF</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__clarity-option" data-value="IF" value="IF">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">VVS1</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__clarity-option" data-value="VVS1" value="VVS1">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">VVS2</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__clarity-option" data-value="VVS2" value="VVS2">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">VS1</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__clarity-option" data-value="VS1" value="VS1">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">VS2</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__clarity-option" data-value="VS2" value="VS2">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">SI1</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__clarity-option" data-value="SI1" value="SI1">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">SI2</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__clarity-option" data-value="SI2" value="SI2">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">SI3</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__clarity-option" data-value="SI3" value="SI3">
                  </label>
                </div>
              </div>
              
              <div class="s-m-diamond-picker-modal__filter-group">
                <h4>CUT QUALITY <span class="s-m-diamond-picker-modal__info-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M10.8 18H13.2V10.8H10.8V18ZM12 8.4C12.34 8.4 12.625 8.285 12.855 8.055C13.085 7.825 13.2 7.54 13.2 7.2C13.2 6.86 13.085 6.575 12.855 6.345C12.625 6.115 12.34 6 12 6C11.66 6 11.375 6.115 11.145 6.345C10.915 6.575 10.8 6.86 10.8 7.2C10.8 7.54 10.915 7.825 11.145 8.055C11.375 8.285 11.66 8.4 12 8.4ZM12 24C10.34 24 8.78 23.685 7.32 23.055C5.86 22.425 4.59 21.57 3.51 20.49C2.43 19.41 1.575 18.14 0.945 16.68C0.315 15.22 0 13.66 0 12C0 10.34 0.315 8.78 0.945 7.32C1.575 5.86 2.43 4.59 3.51 3.51C4.59 2.43 5.86 1.575 7.32 0.945C8.78 0.315 10.34 0 12 0C13.66 0 15.22 0.315 16.68 0.945C18.14 1.575 19.41 2.43 20.49 3.51C21.57 4.59 22.425 5.86 23.055 7.32C23.685 8.78 24 10.34 24 12C24 13.66 23.685 15.22 23.055 16.68C22.425 18.14 21.57 19.41 20.49 20.49C19.41 21.57 18.14 22.425 16.68 23.055C15.22 23.685 13.66 24 12 24ZM12 21.6C14.68 21.6 16.95 20.67 18.81 18.81C20.67 16.95 21.6 14.68 21.6 12C21.6 9.32 20.67 7.05 18.81 5.19C16.95 3.33 14.68 2.4 12 2.4C9.32 2.4 7.05 3.33 5.19 5.19C3.33 7.05 2.4 9.32 2.4 12C2.4 14.68 3.33 16.95 5.19 18.81C7.05 20.67 9.32 21.6 12 21.6Z" fill="var(--Accent-Darkest, #4D3942)"/></svg></span></h4>
                <div class="s-m-diamond-picker-modal__cut-grid" data-name="cut">
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">Ideal</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__cut-option" data-value="Ideal" value="Ideal">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">Excellent</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__cut-option" data-value="Excellent" value="Excellent">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">Very Good</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__cut-option" data-value="Very Good" value="Very Good">
                  </label>
                  <label class="s-m-diamond-picker-modal__filter-option">
                    <span class="s-m-diamond-picker-modal__filter-label">Good</span>
                    <input type="checkbox" class="s-m-diamond-picker-modal__cut-option" data-value="Good" value="Good">
                  </label>
                </div>
              </div>
              
              <div class="s-m-diamond-picker-modal__filter-group">
                <h4>PRICE</h4>
                <div class="s-m-diamond-picker-modal__range-controls">
                  <input type="text" class="s-m-diamond-picker-modal__range-input min" data-name="priceMin" value="$0" placeholder="$0">
                  <input type="text" class="s-m-diamond-picker-modal__range-input max" data-name="priceMax" value="$14,523" placeholder="$14,523">
                </div>
                <div class="s-m-diamond-picker-modal__range-slider" data-name="price">
                  <div class="s-m-diamond-picker-modal__slider-container">
                    <div class="s-m-diamond-picker-modal__slider-handle min">
                      <svg width="28" height="28" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 18C0 8.05888 8.05888 0 18 0C27.9411 0 36 8.05888 36 18C36 27.9411 27.9411 36 18 36C8.05888 36 0 27.9411 0 18Z" fill="var(--Darker-Accent, #69575F)"/>
                      </svg>
                    </div>
                    <div class="s-m-diamond-picker-modal__slider-track"></div>
                    <div class="s-m-diamond-picker-modal__slider-handle max">
                      <svg width="28" height="28" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0 18C0 8.05888 8.05888 0 18 0C27.9411 0 36 8.05888 36 18C36 27.9411 27.9411 36 18 36C8.05888 36 0 27.9411 0 18Z" fill="var(--Darker-Accent, #69575F)"/>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
          
          <div class="s-m-diamond-picker-modal__results">
            <div class="s-m-diamond-picker-modal__results-bar">
              <div class="s-m-diamond-picker-modal__results-meta" id="pageInfo-{{ section.id }}">1-24 of 0</div>
              <button 
                type="button" 
                class="s-m-diamond-picker-modal__sort-filters-btn"
                id="sortFiltersBtn-{{ section.id }}"
              >
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M2 14.4444V16.2222H7.33333V14.4444H2ZM2 3.77778V5.55556H10.8889V3.77778H2ZM10.8889 18V16.2222H18V14.4444H10.8889V12.6667H9.11111V18H10.8889ZM5.55556 7.33333V9.11111H2V10.8889H5.55556V12.6667H7.33333V7.33333H5.55556ZM18 10.8889V9.11111H9.11111V10.8889H18ZM12.6667 7.33333H14.4444V5.55556H18V3.77778H14.4444V2H12.6667V7.33333Z" fill="#78686F"/>
                </svg>
                <span>Sort & Filter</span>
              </button>
              <div class="s-m-diamond-picker-modal__results-sort">
                <label for="sort-{{ section.id }}">Sort By:</label>
                <select id="sort-{{ section.id }}" class="s-m-diamond-picker-modal__sort">
                  <option value="priceAsc">Price: Low to High</option>
                  <option value="priceDesc">Price: High to Low</option>
                  <option value="caratDesc">Carat: High to Low</option>
                  <option value="caratAsc">Carat: Low to High</option>
                  <option value="newest">Newest</option>
                </select>
              </div>
            </div>
            
            <div class="s-m-diamond-picker-modal__results-wrapper">
              <div class="s-m-diamond-picker-modal__grid" id="diamondGrid-{{ section.id }}"></div>
              <div class="s-m-diamond-picker-modal__no-results" id="noResults-{{ section.id }}" style="display: none;">
                <p>No diamonds found matching your criteria.</p>
              </div>
              <div class="s-m-diamond-picker-modal__loading" id="diamondLoading-{{ section.id }}" style="display: none;">
                <div class="s-m-diamond-picker-modal__spinner"><!-- Spinner --></div>
              </div>
            </div>
            
            <div class="s-m-diamond-picker-modal__pager" id="pager-{{ section.id }}">
              <button type="button" class="s-m-diamond-picker-modal__pager-btn" id="prevPage-{{ section.id }}" disabled>Prev</button>
              <span class="s-m-diamond-picker-modal__pager-info" id="pagerInfo-{{ section.id }}"></span>
              <button type="button" class="s-m-diamond-picker-modal__pager-btn" id="nextPage-{{ section.id }}">Next</button>
            </div>
            
            <div class="s-m-diamond-picker-modal__error" id="diamondError-{{ section.id }}" hidden></div>
          </div>
        </div>
        
        <!-- Gallery Modal -->
        <div class="s-m-diamond-gallery-modal" id="diamondGallery-{{ section.id }}" style="display: none;">
          <div class="s-m-diamond-gallery-modal__overlay"></div>
          <div class="s-m-diamond-gallery-modal__container">
            <button type="button" class="s-m-diamond-gallery-modal__close" aria-label="Close gallery">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button type="button" class="s-m-diamond-gallery-modal__nav s-m-diamond-gallery-modal__nav--prev" aria-label="Previous">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <button type="button" class="s-m-diamond-gallery-modal__nav s-m-diamond-gallery-modal__nav--next" aria-label="Next">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
            <div class="s-m-diamond-gallery-modal__content">
              <div class="s-m-diamond-gallery-modal__media"></div>
              <div class="s-m-diamond-gallery-modal__counter"></div>
            </div>
          </div>
        </div>
        
        <div class="s-m-diamond-picker-modal__footer">
          <div class="s-m-diamond-picker-modal__footer-left">
            <div class="s-m-diamond-picker-modal__footer-product">{{ product.title }}</div>
            <div class="s-m-diamond-picker-modal__footer-price">
              <span class="s-m-diamond-picker-modal__footer-price-current">{{ product.selected_or_first_available_variant.price | money }}</span>
            </div>
          </div>
          <div class="s-m-diamond-picker-modal__footer-middle" id="footerMiddle-{{ section.id }}" style="display: none;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <div class="s-m-diamond-picker-modal__footer-diamond" id="selectedDiamondInfo-{{ section.id }}">
              <div class="s-m-diamond-picker-modal__footer-diamond-details">No diamond selected</div>
              <div class="s-m-diamond-picker-modal__footer-diamond-price">$0.00 USD</div>
            </div>
          </div>
          <div class="s-m-diamond-picker-modal__footer-divider" id="footerDivider-{{ section.id }}"></div>
          <div class="s-m-diamond-picker-modal__footer-right">
            <div class="s-m-diamond-picker-modal__footer-total-wrapper">
              <div class="s-m-diamond-picker-modal__footer-total-label">Total</div>
              <div class="s-m-diamond-picker-modal__footer-total" id="totalPrice-{{ section.id }}">{{ product.selected_or_first_available_variant.price | money }} USD</div>
            </div>
            <button type="button" class="s-m-diamond-picker-modal__footer-add-btn" id="addDiamondBtn-{{ section.id }}" disabled>Add Center Diamond</button>
          </div>
        </div>
      </div>
    </modal-dialog>
    
    <!-- Filters Modal (Mobile) -->
    <div class="s-m-filters-modal" id="filtersModal-{{ section.id }}" style="display: none;">
      <div class="s-m-filters-modal__overlay"></div>
      <div class="s-m-filters-modal__container">
        <div class="s-m-filters-modal__header">
          <h2 class="s-m-filters-modal__title">Filters</h2>
          <button
            type="button"
            class="s-m-filters-modal__close"
            id="filtersModalClose-{{ section.id }}"
            aria-label="Close filters"
          >
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5.33366 15.8337L4.16699 14.667L8.83366 10.0003L4.16699 5.33366L5.33366 4.16699L10.0003 8.83366L14.667 4.16699L15.8337 5.33366L11.167 10.0003L15.8337 14.667L14.667 15.8337L10.0003 11.167L5.33366 15.8337Z" fill="var(--Schemes-On-Surface, #1D1B20)"/>
            </svg>
          </button>
        </div>
        <div class="s-m-filters-modal__divider"></div>
        <div class="s-m-filters-modal__content" id="filtersModalContent-{{ section.id }}">
          <div class="s-m-filters-modal__sort-section">
            <h4 class="s-m-filters-modal__sort-title">SORT</h4>
            <div class="s-m-filters-modal__sort-select-wrapper">
              <select id="filtersModalSort-{{ section.id }}" class="s-m-filters-modal__sort-select">
                <option value="priceAsc">Price: Low to High</option>
                <option value="priceDesc">Price: High to Low</option>
                <option value="caratDesc">Carat: High to Low</option>
                <option value="caratAsc">Carat: Low to High</option>
                <option value="newest">Newest</option>
              </select>
            </div>
          </div>
          <!-- Filters content will be copied from main modal -->
        </div>
        <div class="s-m-filters-modal__gradient"></div>
        <div class="s-m-filters-modal__footer">
          <button type="button" class="s-m-filters-modal__clear-btn" id="filtersModalClear-{{ section.id }}">Clear</button>
          <button type="button" class="s-m-filters-modal__apply-btn" id="filtersModalApply-{{ section.id }}">Apply Filters</button>
        </div>
      </div>
    </div>
    
    <!-- Gallery Modal -->
    <div class="s-m-diamond-gallery-modal" id="diamondGallery-{{ section.id }}" style="display: none;">
      <div class="s-m-diamond-gallery-modal__overlay"></div>
      <div class="s-m-diamond-gallery-modal__container">
        <button type="button" class="s-m-diamond-gallery-modal__close" aria-label="Close gallery">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button type="button" class="s-m-diamond-gallery-modal__nav s-m-diamond-gallery-modal__nav--prev" aria-label="Previous">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <button type="button" class="s-m-diamond-gallery-modal__nav s-m-diamond-gallery-modal__nav--next" aria-label="Next">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
        <div class="s-m-diamond-gallery-modal__content">
          <div class="s-m-diamond-gallery-modal__media"></div>
          <div class="s-m-diamond-gallery-modal__counter"></div>
        </div>
      </div>
    </div>

    {%- if product.media.size > 0 -%}
      <script src="{{ 'product-modal.js' | asset_url }}" defer="defer"></script>
      <script src="{{ 'media-gallery.js' | asset_url }}" defer="defer"></script>
    {%- endif -%}

    {%- if first_3d_model -%}
      <script type="application/json" id="ProductJSON-{{ product.id }}">
        {{ product.media | where: 'media_type', 'model' | json }}
      </script>
      <script src="{{ 'product-model.js' | asset_url }}" defer></script>
    {%- endif -%}

    {%- liquid
      if product.selected_or_first_available_variant.featured_media
        assign seo_media = product.selected_or_first_available_variant.featured_media
      else
        assign seo_media = product.featured_media
      endif
    -%}

    <script type="application/ld+json">
      {{ product | structured_data }}
    </script>
  </div>
</product-info>

{{ 'semi-mount-rings.css' | asset_url | stylesheet_tag }}

{% schema %}
{
  "name": "Semi-mount rings main",
  "tag": "section",
  "class": "section",
  "blocks": [
    {
      "type": "@app"
    },
    {
      "type": "center_diamond_selection",
      "name": "Center Diamond Selection",
      "limit": 1,
      "settings": [
        {
          "type": "text",
          "id": "status_text",
          "label": "Status Text",
          "default": "None Selected"
        },
        {
          "type": "text",
          "id": "add_button_text",
          "label": "Add Button Text",
          "default": "Add Center Diamond"
        },
        {
          "type": "textarea",
          "id": "disclaimer_text",
          "label": "Disclaimer Text",
          "default": "Center diamond is not included. Diamond shown is for illustrative purposes only."
        },
        {
          "type": "checkbox",
          "id": "show_consult_link",
          "label": "Show Consult an Expert Link",
          "default": true
        },
        {
          "type": "url",
          "id": "consult_link",
          "label": "Consult an Expert Link"
        },
        {
          "type": "text",
          "id": "add_to_cart_text",
          "label": "Add to Cart Button Text",
          "default": "Add Setting Only to Cart"
        }
      ]
    },
    {
      "type": "trust_badge",
      "name": "Trust Badge",
      "limit": 1,
      "settings": [
        {
          "type": "header",
          "content": "Badge 1"
        },
        {
          "type": "image_picker",
          "id": "image1",
          "label": "Image 1"
        },
        {
          "type": "text",
          "id": "title1",
          "label": "Title 1",
          "default": "Certified Gems"
        },
        {
          "type": "richtext",
          "id": "description1",
          "label": "Description 1",
          "default": "<p>Every diamond and gemstone is GIA or IGI-certified and sourced with full transparency.</p>"
        },
        {
          "type": "header",
          "content": "Badge 2"
        },
        {
          "type": "image_picker",
          "id": "image2",
          "label": "Image 2"
        },
        {
          "type": "text",
          "id": "title2",
          "label": "Title 2",
          "default": "Lifetime Warranty"
        },
        {
          "type": "richtext",
          "id": "description2",
          "label": "Description 2",
          "default": "<p>All 10K, 14K, and 18K gold and silver jewelry comes with a lifetime warranty against manufacturing defects.</p>"
        },
        {
          "type": "header",
          "content": "Badge 3"
        },
        {
          "type": "image_picker",
          "id": "image3",
          "label": "Image 3"
        },
        {
          "type": "text",
          "id": "title3",
          "label": "Title 3",
          "default": "Fast Insured Shipping"
        },
        {
          "type": "richtext",
          "id": "description3",
          "label": "Description 3",
          "default": "<p>Rest easy with insured shipping! Shipping costs are calculated at checkout.</p>"
        }
      ]
    },
    {
      "type": "title",
      "name": "t:sections.main-product.blocks.title.name",
      "limit": 1
    },
    {
      "type": "price",
      "name": "t:sections.main-product.blocks.price.name",
      "limit": 1
    },
    {
      "type": "variant_picker",
      "name": "t:sections.main-product.blocks.variant_picker.name",
      "limit": 1,
      "settings": [
        {
          "type": "select",
          "id": "picker_type",
          "options": [
            {
              "value": "dropdown",
              "label": "t:sections.main-product.blocks.variant_picker.settings.picker_type.options__1.label"
            },
            {
              "value": "button",
              "label": "t:sections.main-product.blocks.variant_picker.settings.picker_type.options__2.label"
            }
          ],
          "default": "button",
          "label": "t:sections.main-product.blocks.variant_picker.settings.picker_type.label"
        },
        {
          "id": "swatch_shape",
          "label": "t:sections.main-product.blocks.variant_picker.settings.swatch_shape.label",
          "type": "select",
          "info": "t:sections.main-product.blocks.variant_picker.settings.swatch_shape.info",
          "options": [
            {
              "value": "circle",
              "label": "t:sections.main-product.blocks.variant_picker.settings.swatch_shape.options__1.label"
            },
            {
              "value": "square",
              "label": "t:sections.main-product.blocks.variant_picker.settings.swatch_shape.options__2.label"
            },
            {
              "value": "none",
              "label": "t:sections.main-product.blocks.variant_picker.settings.swatch_shape.options__3.label"
            }
          ],
          "default": "circle"
        }
      ]
    },
    {
      "type": "collapsible_tab",
      "name": "t:sections.main-product.blocks.collapsible_tab.name",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "default": "t:sections.main-product.blocks.collapsible_tab.settings.heading.default",
          "label": "t:sections.main-product.blocks.collapsible_tab.settings.heading.label"
        },
        {
          "type": "select",
          "id": "icon",
          "options": [
            {
              "value": "none",
              "label": "t:sections.main-product.blocks.collapsible_tab.settings.icon.options__1.label"
            },
            {
              "value": "check_mark",
              "label": "t:sections.main-product.blocks.collapsible_tab.settings.icon.options__8.label"
            },
            {
              "value": "heart",
              "label": "t:sections.main-product.blocks.collapsible_tab.settings.icon.options__16.label"
            },
            {
              "value": "lock",
              "label": "t:sections.main-product.blocks.collapsible_tab.settings.icon.options__22.label"
            },
            {
              "value": "question_mark",
              "label": "t:sections.main-product.blocks.collapsible_tab.settings.icon.options__32.label"
            },
            {
              "value": "return",
              "label": "t:sections.main-product.blocks.collapsible_tab.settings.icon.options__34.label"
            },
            {
              "value": "star",
              "label": "t:sections.main-product.blocks.collapsible_tab.settings.icon.options__41.label"
            }
          ],
          "default": "check_mark",
          "label": "t:sections.main-product.blocks.collapsible_tab.settings.icon.label"
        },
        {
          "type": "richtext",
          "id": "content",
          "label": "t:sections.main-product.blocks.collapsible_tab.settings.content.label"
        },
        {
          "type": "page",
          "id": "page",
          "label": "t:sections.main-product.blocks.collapsible_tab.settings.page.label"
        }
      ]
    }
  ],
  "settings": [
    {
      "type": "checkbox",
      "id": "enable_sticky_info",
      "default": true,
      "label": "t:sections.main-product.settings.enable_sticky_info.label"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.main-product.settings.header.content"
    },
    {
      "type": "select",
      "id": "media_size",
      "options": [
        {
          "value": "small",
          "label": "t:sections.main-product.settings.media_size.options__1.label"
        },
        {
          "value": "medium",
          "label": "t:sections.main-product.settings.media_size.options__2.label"
        },
        {
          "value": "large",
          "label": "t:sections.main-product.settings.media_size.options__3.label"
        }
      ],
      "default": "large",
      "label": "t:sections.main-product.settings.media_size.label"
    },
    {
      "type": "checkbox",
      "id": "constrain_to_viewport",
      "default": true,
      "label": "t:sections.main-product.settings.constrain_to_viewport.label"
    },
    {
      "type": "select",
      "id": "media_fit",
      "options": [
        {
          "value": "contain",
          "label": "t:sections.main-product.settings.media_fit.options__1.label"
        },
        {
          "value": "cover",
          "label": "t:sections.main-product.settings.media_fit.options__2.label"
        }
      ],
      "default": "contain",
      "label": "t:sections.main-product.settings.media_fit.label"
    },
    {
      "type": "select",
      "id": "gallery_layout",
      "options": [
        {
          "value": "stacked",
          "label": "t:sections.main-product.settings.gallery_layout.options__1.label"
        },
        {
          "value": "columns",
          "label": "t:sections.main-product.settings.gallery_layout.options__2.label"
        },
        {
          "value": "thumbnail",
          "label": "t:sections.main-product.settings.gallery_layout.options__3.label"
        },
        {
          "value": "thumbnail_slider",
          "label": "t:sections.main-product.settings.gallery_layout.options__4.label"
        },
        {
          "value": "thumbnail_slider_left",
          "label": "t:sections.main-product.settings.gallery_layout.options__5.label"
        }
      ],
      "default": "stacked",
      "label": "t:sections.main-product.settings.gallery_layout.label"
    },
    {
      "type": "select",
      "id": "mobile_thumbnails",
      "options": [
        {
          "value": "columns",
          "label": "t:sections.main-product.settings.mobile_thumbnails.options__1.label"
        },
        {
          "value": "show",
          "label": "t:sections.main-product.settings.mobile_thumbnails.options__2.label"
        },
        {
          "value": "hide",
          "label": "t:sections.main-product.settings.mobile_thumbnails.options__3.label"
        }
      ],
      "default": "hide",
      "label": "t:sections.main-product.settings.mobile_thumbnails.label"
    },
    {
      "type": "select",
      "id": "media_position",
      "options": [
        {
          "value": "left",
          "label": "t:sections.main-product.settings.media_position.options__1.label"
        },
        {
          "value": "right",
          "label": "t:sections.main-product.settings.media_position.options__2.label"
        }
      ],
      "default": "left",
      "label": "t:sections.main-product.settings.media_position.label"
    },
    {
      "type": "select",
      "id": "image_zoom",
      "options": [
        {
          "value": "lightbox",
          "label": "t:sections.main-product.settings.image_zoom.options__1.label"
        },
        {
          "value": "hover",
          "label": "t:sections.main-product.settings.image_zoom.options__2.label"
        },
        {
          "value": "none",
          "label": "t:sections.main-product.settings.image_zoom.options__3.label"
        }
      ],
      "default": "lightbox",
      "label": "t:sections.main-product.settings.image_zoom.label"
    },
    {
      "type": "checkbox",
      "id": "hide_variants",
      "default": false,
      "label": "t:sections.main-product.settings.hide_variants.label"
    },
    {
      "type": "checkbox",
      "id": "enable_video_looping",
      "default": false,
      "label": "t:sections.main-product.settings.enable_video_looping.label"
    },
    {
      "type": "checkbox",
      "id": "show_breadcrumbs",
      "default": true,
      "label": "Show breadcrumbs"
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Semi-mount rings main"
    }
  ]
}
{% endschema %}

<script>
(function() {
  'use strict';
  
  const sectionId = '{{ section.id }}';
  const productId = '{{ product.id }}';
  const productPrice = {{ product.selected_or_first_available_variant.price | divided_by: 100 }};
  const productComparePrice = {{ product.selected_or_first_available_variant.compare_at_price | default: 0 }};
  const productTitle = {{ product.title | json }};
  
  const API_BASE = '/apps/diamond-search/diamonds/search';
  const CUT_FULL = {
    'EX':'Excellent','EXCELLENT':'Excellent',
    'VG':'Very Good','VERY GOOD':'Very Good',
    'G':'Good','GOOD':'Good',
    'F':'Fair','FAIR':'Fair',
    'P':'Poor','POOR':'Poor',
    'I':'Ideal','IDEAL':'Ideal',
    'SUPER IDEAL':'Super Ideal'
  };
  const CUT_CARD = {
    'EX':'EX','EXCELLENT':'EX',
    'VG':'VG','VERY GOOD':'VG',
    'G':'G','GOOD':'G',
    'F':'F','FAIR':'F',
    'P':'P','POOR':'P',
    'I':'Ideal','IDEAL':'Ideal',
    'SUPER IDEAL':'Super Ideal'
  };
  const SHAPE_EXCLUDE = new Set(['BAGUETTE','PENTAGONAL','SHIELD','TRAPEZOID','TRILLIANT']);
  const SHAPE_ALIASES = {
    'CUSHION': ['CUSHION','CUSHION BRILLIANT']
  };
  const CLARITY_EXCLUDE = new Set(['VS2-SI1','VS-SI1']);
  const COLOR_EXCLUDE = new Set(['VIVID YELLOW']);
  
  const uc = v => (v ?? '').toString().trim().toUpperCase();
  const titleCase = s => (s ?? '').toLowerCase()
    .split(/[\s_]+/).map(w => w ? w[0].toUpperCase()+w.slice(1) : '').join(' ');
  const cutCardLabel = v => CUT_CARD[uc(v)] || v;
  const shapeLabel = v => titleCase(v);
  
  const SHAPE_ICONS = {
    'CUSHION': '<svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none"><path d="M19.2985 11.955L19.4285 22.3315M19.2985 11.955L33.892 18.6412M19.2985 11.955L33.6534 2.881L48.9408 13.2575M19.2985 11.955L16.9782 5.50769M19.2985 11.955L9.62726 10.5223L11.9041 20.4429M19.4285 22.3315L16.5445 32.6646M19.4285 22.3315L33.892 18.6412M19.4285 22.3315L11.9041 20.4429M33.892 18.6412L47.7482 22.744M33.892 18.6412L48.9408 13.2575M48.9408 13.2575L57.4194 10.2184L56.1183 22.0276M48.9408 13.2575L47.7482 22.744M48.9408 13.2575L51.955 6.00698M11.9041 20.4429L16.5445 32.6646M11.9041 20.4429L3.23039 32.6646L10.8199 44.1483M11.9041 20.4429L6.20114 17.4472M16.5445 32.6646L19.1901 43.714M16.5445 32.6646L10.8199 44.1483M19.1901 43.714L10.8199 44.1483M19.1901 43.714L17.8673 53.0703M19.1901 43.714L33.0463 47.7952M10.8199 44.1483L5.52893 47.0137M10.8199 44.1483L9.62726 55.9575L17.8673 53.0703M17.8673 53.0703L33.4149 63.6638L48.3554 54.2209M17.8673 53.0703L33.0463 47.7952M17.8673 53.0703L15.1785 60.2991M33.0463 47.7952L48.3554 54.2209M33.0463 47.7952L47.4013 43.866M48.3554 54.2209L51.0226 60.7115M48.3554 54.2209L47.4013 43.866M48.3554 54.2209L57.6796 55.9575M47.4013 43.866L55.2726 45.733M47.4013 43.866L50.2636 32.6646M57.9615 55.5885L55.2726 45.733M55.2726 45.733L61.4743 49.1845M55.2726 45.733L63.9464 32.6646L56.1183 22.0276M55.2726 45.733L50.2636 32.6646M56.1183 22.0276L50.2636 32.6646M56.1183 22.0276L47.7482 22.744M56.1183 22.0276L61.9298 19.0753M50.2636 32.6646L47.7482 22.744M33.6318 2.77246C30.2924 2.77246 15.9591 2.77246 9.60557 10.4137C3.25208 18.055 3.10029 32.5778 3.10029 32.5778C3.10029 32.5778 2.81839 47.7735 9.60557 55.8707C16.3928 63.9678 29.9454 63.5553 33.4149 63.5553C36.8844 63.5553 51.2177 63.5553 57.6796 55.8489C64.1415 48.1426 63.9897 42.0425 63.9897 32.6646C63.9897 23.2867 63.5777 17.4689 57.4845 10.2184C51.3912 2.96783 39.0311 2.77246 33.6318 2.77246Z" stroke="#78686F" stroke-width="0.986667"/></svg>',
    'ROUND': '<svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none"><path d="M25.4944 14.0722L33.3703 3.01982L41.3767 13.9852M25.4944 14.0722L12.0705 11.9618L14.3114 25.364M25.4944 14.0722L22.8617 22.5138L18.4234 33.3922L14.3984 41.2464M25.4944 14.0722L33.3485 18.0972L44.2486 22.5573L52.6685 25.1681M25.4944 14.0722L21.861 5.43481M41.3767 13.9852L54.7789 11.7442L52.6685 25.1681M41.3767 13.9852L33.5661 18.0972L22.7095 22.6662L14.3114 25.364M41.3767 13.9852L44.0964 22.4051L48.6435 33.24L52.7556 41.0506M41.3767 13.9852L44.9449 5.26075M14.3114 25.364L18.4234 33.1746L22.9923 44.0312L25.7119 52.4293M14.3114 25.364L3.34598 33.3705L14.3984 41.2464M14.3114 25.364L5.6522 21.8394M14.3984 41.2464L22.84 43.879L33.7401 48.3173L41.5943 52.3641M14.3984 41.2464L12.3097 54.6921L25.7119 52.4293M14.3984 41.2464L5.76098 44.9016M52.6685 25.1681L63.7427 33.0659L52.7556 41.0506M52.6685 25.1681L48.6435 33.0224L44.2051 43.9225L41.5943 52.3641M52.7556 41.0506L55.0183 54.4527L41.5943 52.3641M52.7556 41.0506L44.3575 43.7702L33.5226 48.3173L25.7119 52.4293M41.5943 52.3641L33.6966 63.4165L25.7119 52.4293M41.5943 52.3641L45.2277 61.0233M25.7119 52.4293L22.122 61.1974M61.3494 21.5348L52.6902 25.1681M61.5018 44.6187L52.7556 41.0723M44.2486 43.8137L48.6 33.1311L44.1399 22.5138L33.4574 18.1407L22.84 22.6008L18.4669 33.2835L22.9489 43.9225L33.6314 48.2738L44.2486 43.8137ZM45.04 5.03481C60.6053 11.3837 68.0766 29.1487 61.7277 44.7138C55.3788 60.2791 37.6139 67.7504 22.0486 61.4015C6.48343 55.0526 -0.98791 37.2878 5.36098 21.7225C11.7098 6.15725 29.4748 -1.31408 45.04 5.03481Z" stroke="#78686F" stroke-width="0.986667"/></svg>',
    'PRINCESS': '<svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none"><path d="M10.3616 18.0808V17.5875H9.8683V18.0808H10.3616ZM18.4921 18.0808V18.5741H18.9854V18.0808H18.4921ZM18.4921 9.75332V9.25998H17.9987V9.75332H18.4921ZM48.3313 9.75332H48.8247V9.25998H48.3313V9.75332ZM48.3313 18.4527H47.838V18.946H48.3313V18.4527ZM57.0086 18.4527H57.5019V17.9593H57.0086V18.4527ZM57.0086 48.0705V48.5639H57.5019V48.0705H57.0086ZM3.0988 2.77165V2.27832H2.60547V2.77165H3.0988ZM63.9902 2.77165H64.4836V2.27832H63.9902V2.77165ZM63.9902 63.663V64.1564H64.4836V63.663H63.9902ZM3.0988 63.663H2.60547V64.1564H3.0988V63.663ZM48.1587 9.66477L48.2924 10.1396C48.314 10.1336 48.3351 10.126 48.3556 10.1171L48.1587 9.66477ZM18.5851 17.9945L18.4513 17.5197C18.2847 17.5666 18.1549 17.6974 18.1092 17.8644L18.5851 17.9945ZM3.59908 63.663L3.14648 63.4668C3.06347 63.6582 3.10983 63.8811 3.26227 64.0236C3.41472 64.1659 3.64028 64.1971 3.82561 64.1013L3.59908 63.663ZM56.5525 18.7117L56.1055 18.5031C56.0939 18.528 56.0845 18.5536 56.0772 18.5801L56.5525 18.7117ZM3.33787 3.28963L3.52814 2.83446C3.33938 2.75556 3.12152 2.80135 2.98048 2.94956C2.83946 3.09778 2.80454 3.31766 2.89272 3.50226L3.33787 3.28963ZM18.3238 9.55409L18.1336 10.0093C18.1501 10.0161 18.1669 10.0221 18.1839 10.0271L18.3238 9.55409ZM48.3313 18.4306L48.806 18.2962C48.7598 18.1334 48.6335 18.0055 48.4712 17.9575L48.3313 18.4306ZM56.7496 48.159L56.2749 48.2935C56.2821 48.319 56.2914 48.3438 56.3026 48.3678L56.7496 48.159ZM10.3616 17.9945L10.8385 17.8683C10.8306 17.8386 10.82 17.8097 10.8067 17.7818L10.3616 17.9945ZM10.855 48.0705V18.0808H9.8683V48.0705H10.855ZM10.3616 18.5741H18.4921V17.5875H10.3616V18.5741ZM18.9854 18.0808V9.75332H17.9987V18.0808H18.9854ZM18.4921 10.2467H48.3313V9.25998H18.4921V10.2467ZM47.838 9.75332V18.4527H48.8247V9.75332H47.838ZM48.3313 18.946H57.0086V17.9593H48.3313V18.946ZM56.5152 18.4527V48.0705H57.5019V18.4527H56.5152ZM57.0086 47.5772H48.4198V48.5639H57.0086V47.5772ZM47.9265 48.0705V56.0528H48.9132V48.0705H47.9265ZM48.4198 55.5594H18.3217V56.5461H48.4198V55.5594ZM18.815 56.0528V48.0705H17.8283V56.0528H18.815ZM18.3217 47.5772H10.3616V48.5639H18.3217V47.5772ZM3.0988 3.26499H63.9902V2.27832H3.0988V3.26499ZM63.4969 2.77165V63.663H64.4836V2.77165H63.4969ZM63.9902 63.1697H3.0988V64.1564H63.9902V63.1697ZM3.59214 63.663V2.77165H2.60547V63.663H3.59214ZM63.7933 2.31934L47.9617 9.21246L48.3556 10.1171L64.1872 3.22397L63.7933 2.31934ZM48.0249 9.18991L18.4513 17.5197L18.7188 18.4694L48.2924 10.1396L48.0249 9.18991ZM18.1092 17.8644L9.88577 47.9404L10.8375 48.2007L19.061 18.1246L18.1092 17.8644ZM9.90895 47.8743L3.14648 63.4668L4.05168 63.8594L10.8142 48.2669L9.90895 47.8743ZM3.82561 64.1013L18.5482 56.4909L18.0951 55.6145L3.37254 63.2248L3.82561 64.1013ZM18.4482 56.5296L48.5463 48.5474L48.2933 47.5937L18.1952 55.5759L18.4482 56.5296ZM48.8953 48.2023L57.028 18.8434L56.0772 18.5801L47.9445 47.9388L48.8953 48.2023ZM56.9996 18.9204L64.4373 2.98025L63.5432 2.56305L56.1055 18.5031L56.9996 18.9204ZM3.1476 3.7448L18.1336 10.0093L18.5142 9.09893L3.52814 2.83446L3.1476 3.7448ZM18.1839 10.0271L48.1913 18.9037L48.4712 17.9575L18.4638 9.08102L18.1839 10.0271ZM47.8566 18.565L56.2749 48.2935L57.2243 48.0247L48.806 18.2962L47.8566 18.565ZM56.3026 48.3678L63.5433 63.8718L64.4372 63.4543L57.1965 47.9504L56.3026 48.3678ZM64.2069 63.2198L48.6365 55.6096L48.2032 56.496L63.7737 64.1063L64.2069 63.2198ZM48.5463 55.5759L18.4482 47.5937L18.1952 48.5474L48.2933 56.5296L48.5463 55.5759ZM18.7986 47.9443L10.8385 17.8683L9.88468 18.1208L17.8447 48.1967L18.7986 47.9443ZM10.8067 17.7818L3.78304 3.07701L2.89272 3.50226L9.91645 18.2071L10.8067 17.7818Z" fill="#78686F"/></svg>',
    'PEAR': '<svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none"><path d="M40.3302 54.2473L52.2607 55.9626L49.5787 44.3561M40.3302 54.2473L41.5854 46.9425M40.3302 54.2473L33.6801 63.4668M49.5787 44.3561L44.437 37.4636L49.3629 30.8946M49.5787 44.3561L56.7948 38.4188L49.3629 30.8946M49.5787 44.3561L41.5854 46.9425M41.5854 46.9425L44.437 37.4591L41.5193 25.3075M41.5854 46.9425L33.6757 50.7256M49.3629 30.8946L50.3318 19.348L39.445 16.3693L33.5039 19.8045L41.5193 25.3075M49.3629 30.8946L41.5193 25.3075M49.3629 30.8946L54.6126 27.7188M41.5193 25.3075L39.445 16.3671M39.445 16.3671L42.9242 10.1682M39.445 16.3671L33.5039 3.18935M33.6757 50.7256L40.3324 54.2494L44.0296 61.3126M33.6757 50.7256L25.7484 46.9402L22.6149 38.0464M33.6757 50.7256L27.0035 54.2472L23.4583 61.3569M49.5787 44.3539L56.515 47.1796M22.6149 38.0464L17.7529 44.3539M22.6149 38.0464L17.8189 30.8924M22.6149 38.0464L25.3124 25.3053L27.7346 16.3671M27.0014 54.2472L15.139 55.9005L17.7529 44.3539M17.7529 44.3539L10.6667 46.353M17.8189 30.8924L16.9755 19.1507L27.7346 16.3671M17.8189 30.8924L12.4812 27.9581M27.7346 16.3671L33.6757 19.8023L25.3146 25.3053L17.821 30.8902L10.4091 38.4166L17.7572 44.3561L25.7506 46.9402L27.0057 54.245L33.6779 63.6641M27.7346 16.3671L24.861 9.58541M27.7346 16.3671L33.6757 3.18935M33.592 2.77268C33.592 2.77268 10.1272 16.0613 10.1272 42.2884C10.1272 62.8995 32.077 63.6641 33.592 63.6641C35.1004 63.6641 56.9665 63.5089 56.9665 42.2884C57.0568 16.0414 33.592 2.77268 33.592 2.77268Z" stroke="#78686F" stroke-width="0.986667"/></svg>',
    'MARQUISE': '<svg xmlns="http://www.w3.org/2000/svg" width="39" height="62" viewBox="0 0 39 62" fill="none"><path d="M27.3357 6.47407L23.8479 9.08598M23.8479 9.08598L24.4204 17.2406L31.8665 23.0666L28.2959 30.5925L31.5921 38.6164M23.8479 9.08598L19.2279 11.0848M23.8479 9.08598L19.402 0.929221H19.0537L14.6123 9.08381L5.75102 13.8251L6.58712 23.0687M23.8479 9.08598L32.7047 13.8251L31.8708 23.0666L37.4749 30.5925L31.5921 38.6164M31.5921 38.6164L24.7035 43.8115M31.5921 38.6164L32.8767 47.9463L23.7434 52.6213L19.4042 60.9507H19.0558L14.7146 52.6213M19.2279 11.0848L24.4249 17.2384L28.3002 30.5925L24.7035 43.8115M19.2279 11.0848L14.6078 9.09042L14.0331 17.245L6.58712 23.0687M19.2279 11.0848L14.0309 17.2384L10.1773 30.5925L13.7522 43.8115M6.58712 23.0687L0.983052 30.5947L6.88322 38.6164L5.58121 47.9463L14.7146 52.6213M6.58712 23.0687L10.1795 30.5969L6.88322 38.6209L13.7522 43.8115M23.7412 52.6213L24.7035 43.8115M23.7412 52.6213L19.2279 50.9058M23.7412 52.6213L27.573 55.2333M24.7035 43.8115L19.2279 50.9058M19.2279 50.9058L13.7522 43.8115M19.2279 50.9058L14.7146 52.6213M14.7146 52.6213L13.7522 43.8115M14.7146 52.6213L10.8827 55.2333M11.1418 6.47407L14.6078 9.08598M19.402 61.3845C24.9911 58.4958 29.6841 54.0898 32.9606 48.6551C36.2371 43.2203 37.9692 36.9691 37.9648 30.5947C37.9648 9.75671 19.402 0.493164 19.402 0.493164H19.0537C19.0537 0.493164 0.493172 9.75671 0.493172 30.5925C0.488929 36.9671 2.22132 43.2184 5.49824 48.6532C8.77515 54.088 13.4686 58.4939 19.0581 61.3824L19.402 61.3845Z" stroke="#78686F" stroke-width="0.986667"/></svg>',
    'OVAL': '<svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none"><path d="M51.4466 43.4405L46.8287 39.3277M39.7075 54.2694L41.3807 45.8754L46.8308 39.3299M39.7075 54.2694L33.6129 51.5755L41.3829 45.8777L43.2702 33.3089L46.8308 39.3299M39.7075 54.2694L42.9251 60.1863M39.7075 54.2694L33.6129 63.6638M39.7075 54.2694L48.4408 53.052L46.8308 39.3299M46.8308 39.3299L52.2635 33.8047V33.4793L46.833 27.1042L49.1529 15.7109L39.7075 12.1891M39.7075 12.1891L33.6129 2.77246M39.7075 12.1891L40.2864 21.9288L46.8308 27.1086L43.2702 33.4793L40.2885 21.9288L33.6129 16.4303L39.7075 12.1891ZM39.7075 12.1891L43.7421 7.25277M51.6388 25.0191L46.833 27.1065M15.4778 42.44L20.3709 39.3299M20.3709 39.3299L26.2295 45.725M20.3709 39.3299L23.9315 33.3067L26.2295 45.725M20.3709 39.3299L18.4813 52.5738L27.4965 54.2694M20.3709 39.3299L14.9404 33.807V33.4816L20.3709 27.1065L18.0554 15.432L27.49 12.1891L33.591 2.77246M26.2295 45.725L27.4965 54.2694M26.2295 45.725L33.591 51.5732L27.4965 54.2694M27.4965 54.2694L23.8704 59.945M27.4965 54.2694L33.591 63.6638M15.5412 24.3859L20.3687 27.1086M20.3687 27.1086L26.9155 21.9288M20.3687 27.1086L23.9315 33.4793L26.9155 21.9288M26.9155 21.9288L27.4965 12.1891M26.9155 21.9288L33.591 16.4303L27.4965 12.1891M27.4965 12.1891L23.4379 7.16422M14.8115 33.652C14.8115 14.6018 23.2041 2.77246 33.5473 2.77246C43.8907 2.77246 52.2831 14.5797 52.2831 33.6299C52.2831 52.6822 43.8907 63.6638 33.5473 63.6638C23.2041 63.6638 14.8115 52.7907 14.8115 33.652Z" stroke="#78686F" stroke-width="0.986667"/></svg>',
    'HEART': '<svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none"><path d="M33.5133 12.524V20.869M27.5047 48.4027L33.3392 47.1205M27.5047 48.4027L15.5094 48.5329L16.3584 38.0584L16.8374 30.561L10.1975 26.0409M27.5047 48.4027L23.1072 54.7481M33.3392 47.1205H33.6875M33.3392 47.1205L25.0013 41.9918L17.3817 31.1478L13.9637 21.3469L33.557 16.0879L22.3017 6.4391L13.9201 15.0449M10.1975 26.0409L6.54009 35.2768L24.8271 41.6441L27.8532 48.0549L33.4264 60.0072H33.6005L39.1737 48.0549L42.5481 42.5134L60.5086 35.2768L56.8292 26.041M10.1975 26.0409L4.4066 16.327L13.9201 15.0449M10.1975 26.0409L13.6154 21.3469L13.9201 15.0449M10.1975 26.0409L3.88408 28.5183M33.6875 47.1205L39.5219 48.4027M33.6875 47.1205L42.5481 42.1656L49.6452 31.1478L53.0631 21.3469L33.4699 16.0879L44.7251 6.4391L53.1284 15.0449M13.9201 15.0449L24.0215 18.6523L33.4262 20.9341H33.6004L43.0052 18.6523L53.1284 15.0449M13.9201 15.0449L10.8723 7.65619M39.5219 48.4027L51.0601 48.9678L50.6683 38.0585L50.1894 30.5612L56.8292 26.041M39.5219 48.4027L43.2664 55.183M53.1284 15.0449L53.4113 21.347L56.8292 26.041M53.1284 15.0449L62.6203 16.327L56.8292 26.041M53.1284 15.0449L56.1544 7.65619M56.8292 26.041L63.1426 28.5184M50.7118 39.232L56.6116 42.7743M16.119 38.8842L10.6982 43.1436M33.5136 60.5938C33.5136 60.5938 63.9921 48.12 63.9921 21.3468C63.9921 14.5014 58.5494 5.7002 49.493 5.7002C37.9983 5.7002 33.5136 12.4587 33.5136 12.4587C33.5136 12.4587 29.1596 5.7002 17.5996 5.7002C8.56492 5.7002 3.10059 14.5014 3.10059 21.3468C3.10059 48.12 33.5789 60.5938 33.5789 60.5938H33.5136Z" stroke="#78686F" stroke-width="0.986667" stroke-linejoin="round"/></svg>',
    'RADIANT': '<svg xmlns="http://www.w3.org/2000/svg" width="68" height="67" viewBox="0 0 68 67" fill="none"><path d="M57.4243 50.4399L47.6181 47.2457L50.7702 57.0962M57.4243 50.4399V16.0186M57.4243 50.4399L50.7702 57.0962M50.7702 57.0962L54.3142 63.6638M50.7702 57.0962L33.5463 49.5257L16.3467 57.0962M50.7702 57.0962H16.3467M57.4243 16.0186L50.0309 33.2182L57.4243 50.4443L63.9921 53.986M57.4243 16.0186L63.9921 12.4702M57.4243 16.0186L50.7681 9.35568H16.3467M57.4243 16.0186L47.6181 19.2128L50.7702 9.36232M54.3142 63.6638L63.9921 53.986M54.3142 63.6638H12.7984M16.3467 57.0962L12.7984 63.6638M16.3467 57.0962L9.6838 50.4399V16.0186L16.3467 9.35568M63.9921 53.986V12.4702M63.9921 12.4702L54.3142 2.77246M16.3467 9.35568L33.5463 16.9306L50.7725 9.3601L54.3142 2.77246M16.3467 9.35568L12.7961 2.77246M54.3142 2.77246L12.7984 2.77467L3.1028 12.4702L3.10059 53.986M12.7984 63.6638L3.10059 53.986M3.10059 53.986L9.68822 50.4443L17.0595 33.2182L9.68822 16.0186M9.68822 50.4399L19.4945 47.2457L16.3445 57.0962M9.68822 16.0186L3.10059 12.468M9.68822 16.0186L19.4945 19.2128L16.3445 9.36232M33.5463 17.0811L47.4211 19.3877L49.5506 33.2182L47.4211 47.0708L33.5463 49.3774L19.6715 47.0708L17.5642 33.2182L19.6715 19.3877L33.5463 17.0811Z" stroke="#78686F" stroke-width="0.986667"/></svg>',
    'ASSCHER': '<svg xmlns="http://www.w3.org/2000/svg" width="62" height="62" viewBox="0 0 62 62" fill="none"><path d="M47.1839 21.3268L61.3846 12.9542M0.493164 48.5973L14.52 40.4641M0.493164 48.5973L13.3239 61.3845M0.493164 48.5973V12.7584M13.3239 61.3845H48.4451M13.3239 61.3845L21.4137 47.3361M0.493164 12.7584L12.6497 0.493164H48.8148M0.493164 12.7584L14.7375 21.3485M40.1596 47.3361L48.4451 61.3845M48.4451 61.3845L61.2542 48.6191M61.2542 48.6191V12.9107L48.8148 0.493164M61.2542 48.6191L47.1839 40.4641M12.6497 0.667143L21.0875 14.6504M21.0875 14.6504L14.5634 21.218V40.4641L21.4572 47.3361H40.3119L47.1839 40.4641M21.0875 14.6504H40.5075L47.1839 21.305V40.4641M48.8148 0.493164L40.464 14.6287M43.139 10.1488L51.6637 18.6301V43.0519L42.8997 51.7941H18.8693L10.0835 43.0519V18.5214L18.4127 10.1488H43.139ZM45.8573 5.58195L56.2523 15.9552V45.7702L45.5528 56.4481H16.2162L5.49496 45.7485V15.803L15.6508 5.58195H45.8573Z" stroke="#78686F" stroke-width="0.986667"/></svg>',
    'EMERALD': '<svg xmlns="http://www.w3.org/2000/svg" width="68" height="68" viewBox="0 0 68 68" fill="none"><path d="M57.1767 10.6653L47.8281 17.2542M50.879 2.5957L45.3829 14.2231M50.879 2.5957H15.8847M50.879 2.5957L57.1793 10.6653V56.4275L50.879 64.4971M45.3829 14.2231L47.8281 17.252V25.4296M45.3829 14.2231H21.3808M15.8847 2.5957L21.3808 14.2231M15.8847 2.5957L9.5625 10.6653V56.4275L15.8847 64.4971M50.879 64.4971L45.3829 52.87M50.879 64.4971H15.8847M21.3808 14.2231L18.9356 17.2542M54.0621 25.4318V12.9426L49.0396 6.57426H17.724L12.6796 12.9426V25.4318M9.5647 10.6653L18.9356 17.2542M18.9356 17.2542V25.4318M15.8847 64.4971L21.3808 52.87M15.8869 25.4318V15.1749L19.6692 10.6653H47.0945L50.879 15.1749V51.918L47.0945 56.4275H19.6692L15.8847 51.918V25.4318M57.1767 56.4275L47.8281 49.8185M47.8281 49.8185L45.3829 52.87M47.8281 49.8185V25.4341M45.3829 52.87H21.3808M21.3808 52.87L18.9356 49.8185M54.0621 25.4341V54.128L49.0396 60.4961H17.724L12.6796 54.128V25.4341M9.5647 56.4275L18.9356 49.8185M18.9356 49.8185V25.4341" stroke="#78686F" stroke-width="0.984743"/></svg>'
  };
  
  const state = {
    page: 1,
    pageSize: 24,
    type: 'lab',
    sort: 'priceAsc',
    shape: [],
    caratMin: 0.25,
    caratMax: 10,
    color: [],
    clarity: [],
    cut: [],
    priceMin: 0,
    priceMax: 14523,
    selectedDiamond: null
  };
  
  const modal = document.getElementById(`DiamondPickerModal-${sectionId}`);
  const trigger = document.querySelector(`[data-diamond-picker-trigger]`);
  const closeBtn = document.getElementById(`DiamondPickerClose-${sectionId}`);
  const grid = document.getElementById(`diamondGrid-${sectionId}`);
  const loadingEl = document.getElementById(`diamondLoading-${sectionId}`);
  const pageInfo = document.getElementById(`pageInfo-${sectionId}`);
  const pagerInfo = document.getElementById(`pagerInfo-${sectionId}`);
  const prevBtn = document.getElementById(`prevPage-${sectionId}`);
  const nextBtn = document.getElementById(`nextPage-${sectionId}`);
  const sortSelect = document.getElementById(`sort-${sectionId}`);
  const applyBtn = document.getElementById(`applyFilters-${sectionId}`);
  const clearBtn = document.getElementById(`clearFilters-${sectionId}`);
  const pillToggle = modal?.querySelector('.s-m-diamond-picker-modal__pill-toggle');
  const shapeGrid = document.getElementById(`shapeFilters-${sectionId}`);
  const caratMinInput = modal?.querySelector('input[data-name="caratMin"]');
  const caratMaxInput = modal?.querySelector('input[data-name="caratMax"]');
  const selectedDiamondInfo = document.getElementById(`selectedDiamondInfo-${sectionId}`);
  const footerMiddle = document.getElementById(`footerMiddle-${sectionId}`);
  const footerDivider = document.getElementById(`footerDivider-${sectionId}`);
  const totalPriceEl = document.getElementById(`totalPrice-${sectionId}`);
  const addDiamondBtn = document.getElementById(`addDiamondBtn-${sectionId}`);
  const errorEl = document.getElementById(`diamondError-${sectionId}`);
  const hideFiltersBtn = document.getElementById(`hideFiltersBtn-${sectionId}`);
  const filtersPanel = document.getElementById(`diamondFilters-${sectionId}`);
  const galleryModal = document.getElementById(`diamondGallery-${sectionId}`);
  const sortFiltersBtn = document.getElementById(`sortFiltersBtn-${sectionId}`);
  const filtersModal = document.getElementById(`filtersModal-${sectionId}`);
  const filtersModalClose = document.getElementById(`filtersModalClose-${sectionId}`);
  const filtersModalContent = document.getElementById(`filtersModalContent-${sectionId}`);
  const filtersModalClear = document.getElementById(`filtersModalClear-${sectionId}`);
  const filtersModalApply = document.getElementById(`filtersModalApply-${sectionId}`);
  
  let galleryState = {
    media: [],
    currentIndex: 0
  };
  
  function money(n) {
    let num;
    if (typeof n === 'string') {
      const cleaned = n.trim().replace(/^0+(?=\d)/, '').replace(/^0+\./, '0.');
      num = parseFloat(cleaned);
    } else if (n != null) {
      num = typeof n === 'number' ? n : parseFloat(n);
    } else {
      num = 0;
    }
    if (!num || num <= 0 || isNaN(num)) return '$0.00';
    const formatted = new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(num);
    return formatted.replace(/^\$0+/, '$').replace(/^\$0+\./, '$0.');
  }
  
  const PLACEHOLDER_IMG = 'data:image/svg+xml;utf8,' + encodeURIComponent(`
    <svg xmlns="http://www.w3.org/2000/svg" width="164" height="161" viewBox="0 0 164 161" fill="none">
      <path d="M62.3174 34.271L81.569 7.3534L101.14 34.059M62.3174 34.271L29.5046 29.1312L34.9822 61.7717M62.3174 34.271L55.8823 54.8302L45.0335 81.3241L35.1949 100.453M62.3174 34.271L81.5157 44.0737L108.159 54.9362L128.741 61.2947M62.3174 34.271L53.436 13.235M101.14 34.059L133.899 28.6014L128.741 61.2947M101.14 34.059L82.0475 44.0737L55.5102 55.2012L34.9822 61.7717M101.14 34.059L107.787 54.5654L118.902 80.9533L128.953 99.9758M101.14 34.059L109.861 12.8111M34.9822 61.7717L45.0335 80.7942L56.2014 107.235L62.8492 127.688M34.9822 61.7717L8.17883 81.2712L35.1949 100.453M34.9822 61.7717L13.816 53.1878M35.1949 100.453L55.8292 106.864L82.473 117.674L101.671 127.529M35.1949 100.453L30.0894 133.199L62.8492 127.688M35.1949 100.453L14.0819 109.355M128.741 61.2947L155.81 80.5294L128.953 99.9758M128.741 61.2947L118.902 80.4234L108.053 106.97L101.671 127.529M128.953 99.9758L134.484 132.616L101.671 127.529M128.953 99.9758L108.425 106.599L81.9412 117.674L62.8492 127.688M101.671 127.529L82.3666 154.447L62.8492 127.688M101.671 127.529L110.553 148.618M62.8492 127.688L54.0742 149.042M149.96 52.446L128.794 61.2947M150.332 108.666L128.953 100.029M108.159 106.705L118.796 80.6883L107.894 54.8302L81.7818 44.1797L55.8292 55.0422L45.1398 81.0593L56.0952 106.97L82.2072 117.568L108.159 106.705ZM110.094 12.2608C148.141 27.7233 166.404 70.9891 150.885 108.897C135.366 146.806 91.9418 165.002 53.8948 149.54C15.8479 134.077 -2.41475 90.8116 13.1042 52.903C28.6231 14.9945 72.0469 -3.20161 110.094 12.2608Z" stroke="#78686F" stroke-width="0.986667"/>
    </svg>
  `);
  
  function wireImageFallbacks(scope=document) {
    scope.querySelectorAll('img[data-fallback="1"]').forEach(img => {
      if (img._fallbackWired) return;
      img._fallbackWired = true;
      const applyFallback = () => {
        if (img.dataset.fallbackApplied) return;
        img.dataset.fallbackApplied = '1';
        img.src = PLACEHOLDER_IMG;
        const t = img.closest('.s-m-diamond-picker-modal__card-thumb');
        if (t) t.classList.add('no-image');
      };
      img.addEventListener('error', applyFallback, { passive: true });
      if ('decode' in img) img.decode().catch(applyFallback);
      else requestAnimationFrame(() => { if (!img.naturalWidth) applyFallback(); });
    });
  }
  
  function buildQuery() {
    const u = new URLSearchParams();
    u.set('page', state.page);
    u.set('pageSize', state.pageSize);
    u.set('type', state.type === 'all' ? '' : state.type);
    if (state.sort) u.set('sort', state.sort);
    u.set('caratMin', state.caratMin);
    u.set('caratMax', state.caratMax);
    if (state.shape.length) {
      const shapesToSend = new Set();
      state.shape.forEach(v => {
        const key = uc(v);
        if (SHAPE_ALIASES['CUSHION'] && key === 'CUSHION') {
          SHAPE_ALIASES['CUSHION'].forEach(s => shapesToSend.add(s));
        } else {
          shapesToSend.add(v);
        }
      });
      if (shapesToSend.size) u.set('shape', Array.from(shapesToSend).join(','));
    }
    if (state.color.length) u.set('color', state.color.join(','));
    if (state.clarity.length) u.set('clarity', state.clarity.join(','));
    if (state.cut.length) u.set('cut', state.cut.join(','));
    if (state.priceMin > 0) u.set('priceMin', state.priceMin);
    if (state.priceMax < 14523) u.set('priceMax', state.priceMax);
    return u.toString();
  }
  
  async function fetchDiamonds() {
    if (errorEl) errorEl.hidden = true;
    try {
      const url = `${API_BASE}?${buildQuery()}`;
      const response = await fetch(url, { headers: { 'Accept': 'application/json' } });
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      const data = await response.json();
      return data;
    } catch (err) {
      if (errorEl) {
        errorEl.hidden = false;
        errorEl.textContent = `Error loading diamonds: ${err.message}`;
      }
      return { items: [], total: 0, facets: {} };
    }
  }
  
  function renderGrid(items) {
    if (!grid) return;
    const noResultsEl = document.getElementById(`noResults-${sectionId}`);
    
    if (items.length === 0) {
      grid.innerHTML = '';
      if (noResultsEl) noResultsEl.style.display = 'flex';
      return;
    }
    
    if (noResultsEl) noResultsEl.style.display = 'none';
    grid.innerHTML = items.map((item, index) => {
      const shapeTxt = shapeLabel(item.shape || '');
      const cutTxt = cutCardLabel(item.cut || '');
      const colorTxt = item.color || '';
      const clarTxt = item.clarity || '';
      const src = (item.images && item.images[0]) ? item.images[0] : PLACEHOLDER_IMG;
      const isSelected = state.selectedDiamond && state.selectedDiamond.stockNumber === item.stockNumber;
      const itemType = item.type || state.type;
      const sourceType = itemType === 'lab' ? 'Lab Grown' : itemType === 'natural' ? 'Natural' : 'All';
      
      const hasGallery = (item.images && item.images.length > 1) || (item.videos && item.videos.length > 0);
      const galleryIcon = hasGallery ? `
        <button type="button" class="s-m-diamond-picker-modal__card-gallery-btn" data-diamond-media='${JSON.stringify({ images: item.images || [], videos: item.videos || [] })}' aria-label="View gallery">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
            <path d="M6.25516 10.7231H15.1911L12.1082 6.70196L10.0529 9.38274L8.66786 7.59555L6.25516 10.7231ZM5.36156 14.2975C4.87009 14.2975 4.44935 14.1225 4.09936 13.7725C3.74937 13.4225 3.57438 13.0018 3.57438 12.5103V1.78719C3.57438 1.29571 3.74937 0.874978 4.09936 0.524987C4.44935 0.174996 4.87009 0 5.36156 0H16.0847C16.5762 0 16.9969 0.174996 17.3469 0.524987C17.6969 0.874978 17.8719 1.29571 17.8719 1.78719V12.5103C17.8719 13.0018 17.6969 13.4225 17.3469 13.7725C16.9969 14.1225 16.5762 14.2975 16.0847 14.2975H5.36156ZM5.36156 12.5103H16.0847V1.78719H5.36156V12.5103ZM1.78719 17.8719C1.29571 17.8719 0.874978 17.6969 0.524987 17.3469C0.174996 16.9969 0 16.5762 0 16.0847V3.57438H1.78719V16.0847H14.2975V17.8719H1.78719Z" fill="#4D3942"/>
          </svg>
        </button>
      ` : '';
      
      const propsArray = [sourceType];
      if (colorTxt !== '') propsArray.push(colorTxt);
      if (clarTxt !== '') propsArray.push(clarTxt);
      if (cutTxt !== '') propsArray.push(cutTxt);
      const mobileProps = propsArray.join(' ');
      
      return `
        <article class="s-m-diamond-picker-modal__card ${isSelected ? 'is-selected' : ''}" data-diamond-index="${index}">
          <div class="s-m-diamond-picker-modal__card-thumb">
            <img data-fallback="1" src="${src}" loading="lazy" alt="${shapeTxt} ${item.carat || ''}ct">
            ${galleryIcon}
          </div>
          <div class="s-m-diamond-picker-modal__card-meta">
            <div class="s-m-diamond-picker-modal__card-title">${shapeTxt}  ${item.carat?.toFixed?.(2) ?? item.carat}ct</div>
            <div class="s-m-diamond-picker-modal__card-specs">
              <div class="s-m-diamond-picker-modal__card-spec-col">
                <div class="s-m-diamond-picker-modal__card-spec-item">
                  <div class="s-m-diamond-picker-modal__card-spec-label">COLOR</div>
                  <div class="s-m-diamond-picker-modal__card-spec-value">${colorTxt}</div>
                </div>
                <div class="s-m-diamond-picker-modal__card-spec-item">
                  <div class="s-m-diamond-picker-modal__card-spec-label">CLARITY</div>
                  <div class="s-m-diamond-picker-modal__card-spec-value">${clarTxt}</div>
                </div>
              </div>
              <div class="s-m-diamond-picker-modal__card-spec-col">
                <div class="s-m-diamond-picker-modal__card-spec-item">
                  <div class="s-m-diamond-picker-modal__card-spec-label">SOURCE</div>
                  <div class="s-m-diamond-picker-modal__card-spec-value">${sourceType}</div>
                </div>
                <div class="s-m-diamond-picker-modal__card-spec-item">
                  <div class="s-m-diamond-picker-modal__card-spec-label">QUALITY</div>
                  <div class="s-m-diamond-picker-modal__card-spec-value">${cutTxt}</div>
                </div>
              </div>
            </div>
            <div class="s-m-diamond-picker-modal__card-mobile-props">${mobileProps}</div>
            <div class="s-m-diamond-picker-modal__card-footer">
              <div class="s-m-diamond-picker-modal__card-price">${money(item.priceRetail)}</div>
              <button type="button" class="s-m-diamond-picker-modal__card-btn ${isSelected ? 'is-selected' : ''}" data-stock="${item.stockNumber}" data-diamond='${JSON.stringify(item)}'>
                ${isSelected ? 'Selected' : 'Select'}
              </button>
            </div>
          </div>
        </article>
      `;
    }).join('');
    
    wireImageFallbacks(grid);
    
    grid.querySelectorAll('.s-m-diamond-picker-modal__card-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const diamondData = JSON.parse(btn.dataset.diamond);
        selectDiamond(diamondData);
      });
    });
    
    // Wire up gallery buttons
    grid.querySelectorAll('.s-m-diamond-picker-modal__card-gallery-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.stopPropagation();
        const mediaData = JSON.parse(btn.dataset.diamondMedia);
        openGallery(mediaData);
      });
    });
  }
  
  // Gallery functions
  function openGallery(mediaData) {
    if (!galleryModal) return;
    
    // Combine images and videos into a single array
    const media = [];
    if (mediaData.images && mediaData.images.length > 0) {
      mediaData.images.forEach(url => {
        media.push({ type: 'image', url });
      });
    }
    if (mediaData.videos && mediaData.videos.length > 0) {
      mediaData.videos.forEach(url => {
        media.push({ type: 'video', url });
      });
    }
    
    if (media.length === 0) return;
    
    galleryState.media = media;
    galleryState.currentIndex = 0;
    
    updateGalleryDisplay();
    galleryModal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
  }
  
  function closeGallery() {
    if (!galleryModal) return;
    galleryModal.style.display = 'none';
    document.body.style.overflow = '';
    galleryState.media = [];
    galleryState.currentIndex = 0;
  }
  
  function updateGalleryDisplay() {
    if (!galleryModal || galleryState.media.length === 0) return;
    
    const mediaEl = galleryModal.querySelector('.s-m-diamond-gallery-modal__media');
    const counterEl = galleryModal.querySelector('.s-m-diamond-gallery-modal__counter');
    const prevBtn = galleryModal.querySelector('.s-m-diamond-gallery-modal__nav--prev');
    const nextBtn = galleryModal.querySelector('.s-m-diamond-gallery-modal__nav--next');
    
    if (!mediaEl) return;
    
    const current = galleryState.media[galleryState.currentIndex];
    
    // Clear and add new media
    mediaEl.innerHTML = '';
    if (current.type === 'image') {
      const img = document.createElement('img');
      img.src = current.url;
      img.alt = 'Diamond image';
      mediaEl.appendChild(img);
    } else if (current.type === 'video') {
      const video = document.createElement('video');
      video.src = current.url;
      video.controls = true;
      video.autoplay = true;
      video.muted = true;
      video.loop = true;
      mediaEl.appendChild(video);
    }
    
    // Update counter
    if (counterEl) {
      counterEl.textContent = `${galleryState.currentIndex + 1} / ${galleryState.media.length}`;
    }
    
    // Update navigation buttons
    if (prevBtn) {
      prevBtn.disabled = galleryState.currentIndex === 0;
    }
    if (nextBtn) {
      nextBtn.disabled = galleryState.currentIndex === galleryState.media.length - 1;
    }
  }
  
  function galleryNext() {
    if (galleryState.currentIndex < galleryState.media.length - 1) {
      galleryState.currentIndex++;
      updateGalleryDisplay();
    }
  }
  
  function galleryPrev() {
    if (galleryState.currentIndex > 0) {
      galleryState.currentIndex--;
      updateGalleryDisplay();
    }
  }
  
  // Select diamond
  function selectDiamond(diamond) {
    state.selectedDiamond = diamond;
    updateSelectedDiamondDisplay();
    updateTotalPrice();
    
    // Re-render grid to update button states
    if (grid) {
      renderGrid(grid.querySelectorAll('.s-m-diamond-picker-modal__card').length ? 
        Array.from(grid.querySelectorAll('.s-m-diamond-picker-modal__card')).map(card => {
          const btn = card.querySelector('.s-m-diamond-picker-modal__card-btn');
          return JSON.parse(btn.dataset.diamond);
        }) : []);
    }
    
    // Enable Add Center Diamond button
    if (addDiamondBtn) addDiamondBtn.disabled = false;
  }
  
  // Update selected diamond display
  function updateSelectedDiamondDisplay() {
    if (!selectedDiamondInfo) return;
    
    if (!state.selectedDiamond) {
      // Hide footer-middle when no diamond is selected (divider always shows)
      if (footerMiddle) footerMiddle.style.display = 'none';
      return;
    }
    
    // Show footer-middle when diamond is selected
    if (footerMiddle) footerMiddle.style.display = 'flex';
    
    const d = state.selectedDiamond;
    const shapeTxt = shapeLabel(d.shape || '');
    const cutTxt = cutCardLabel(d.cut || '');
    const sourceType = state.type === 'lab' ? 'Lab Grown' : state.type === 'natural' ? 'Natural' : 'All';
    selectedDiamondInfo.innerHTML = `
      <div class="s-m-diamond-picker-modal__footer-diamond-details">
        ${d.carat?.toFixed?.(2) ?? d.carat}ct ${shapeTxt}, ${d.color} ${sourceType} ${d.clarity} ${cutTxt}
      </div>
      <div class="s-m-diamond-picker-modal__footer-diamond-price">${money(parseFloat(d.priceRetail) || 0)} USD</div>
    `;
  }
  
  // Update total price
  function updateTotalPrice() {
    if (!totalPriceEl) return;
    let diamondPrice = 0;
    if (state.selectedDiamond && state.selectedDiamond.priceRetail) {
      const price = state.selectedDiamond.priceRetail;
      diamondPrice = typeof price === 'string' 
        ? parseFloat(price.replace(/^0+/, '').replace(/^0+\./, '0.')) || 0
        : parseFloat(price) || 0;
    }
    const total = productPrice + diamondPrice;
    totalPriceEl.textContent = `${money(total)} USD`;
    
    // Update main price display at the top of the page
    updateMainPriceDisplay(total);
  }
  
  // Update main price display (the large price at the top)
  function updateMainPriceDisplay(totalPrice) {
    const mainPriceContainer = document.getElementById(`price-${sectionId}`);
    if (!mainPriceContainer) return;
    
    // Find the active price item (either sale or regular)
    const salePriceItem = mainPriceContainer.querySelector('.price__sale .price-item--sale');
    const regularPriceItem = mainPriceContainer.querySelector('.price__regular .price-item--regular');
    
    // Determine which price element to update based on what's visible
    // When on sale, price__sale is displayed; otherwise price__regular is displayed
    const isOnSale = mainPriceContainer.classList.contains('price--on-sale');
    const priceItem = isOnSale ? salePriceItem : regularPriceItem;
    
    if (priceItem) {
      // Format the price
      const formattedPrice = money(totalPrice);
      
      // Check if currency code is enabled by looking at the original price format
      // Try to preserve the original format (with or without currency code)
      const originalText = priceItem.textContent.trim();
      const hasCurrencyCode = /(USD|CAD|EUR|GBP|AUD|JPY|CHF|CNY)\s*$/.test(originalText);
      
      if (hasCurrencyCode) {
        // Extract currency code from existing price or use default
        const currencyMatch = originalText.match(/(USD|CAD|EUR|GBP|AUD|JPY|CHF|CNY)/);
        const currencyCode = currencyMatch ? currencyMatch[1] : 'USD';
        
        // Wrap currency code in a span for styling
        priceItem.innerHTML = `${formattedPrice} <span class="s-m-price-currency-code">${currencyCode}</span>`;
      } else {
        priceItem.textContent = formattedPrice;
      }
    }
  }
  
  // Build shape filters
  function buildShapeFilters(facets) {
    if (!shapeGrid) return;
    const shapes = (facets.shape || []).filter(s => !SHAPE_EXCLUDE.has(uc(s)));
    const uniqueShapes = Array.from(new Set(shapes.map(s => {
      const k = uc(s);
      return SHAPE_ALIASES['CUSHION']?.includes(k) ? 'CUSHION' : k;
    }))).sort();
    
    shapeGrid.innerHTML = uniqueShapes.map(shape => {
      const icon = SHAPE_ICONS[shape] || SHAPE_ICONS['ROUND'];
      const label = shapeLabel(shape);
      const normalizedShape = uc(shape);
      const isSelected = state.shape.some(s => uc(s) === normalizedShape);
      return `
        <button type="button" class="s-m-diamond-picker-modal__shape-btn ${isSelected ? 'is-selected' : ''}" data-shape="${shape}">
          ${icon}
          <span>${label}</span>
        </button>
      `;
    }).join('');
    
    shapeGrid.querySelectorAll('.s-m-diamond-picker-modal__shape-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const shape = btn.dataset.shape || btn.dataset.value;
        if (!shape) return;
        const normalizedShape = uc(shape);
        const index = state.shape.findIndex(s => uc(s) === normalizedShape);
        if (index > -1) {
          state.shape.splice(index, 1);
          btn.classList.remove('is-selected');
        } else {
          state.shape.push(shape);
          btn.classList.add('is-selected');
        }
        // Auto-apply filters when shape is selected/deselected
        state.page = 1;
        readFilters();
        doSearch();
      });
    });
  }
  
  // Do search
  async function doSearch() {
    // Show loading spinner and clear grid
    if (loadingEl) {
      loadingEl.style.setProperty('display', 'flex', 'important');
    }
    if (grid) grid.innerHTML = '';
    
    try {
      const data = await fetchDiamonds();
      
      if (data.facets && !state.facetsLoaded) {
        buildShapeFilters(data.facets);
        state.facetsLoaded = true;
      }
      
      renderGrid(data.items || []);
      
      const total = data.total || 0;
      const first = (state.page - 1) * state.pageSize + 1;
      const last = Math.min(state.page * state.pageSize, total);
      if (pageInfo) pageInfo.textContent = `${first}-${last} of ${total}`;
      if (pagerInfo) pagerInfo.textContent = `${first}-${last} of ${total}`;
      if (prevBtn) prevBtn.disabled = state.page <= 1;
      if (nextBtn) nextBtn.disabled = state.page * state.pageSize >= total;
    } finally {
      // Hide loading spinner
      if (loadingEl) {
        loadingEl.style.setProperty('display', 'none', 'important');
      }
    }
  }
  
  // Read filters
  function readFilters() {
    // Check if filters modal is open and read from there, otherwise read from main modal
    const isFiltersModalOpen = filtersModal && filtersModal.style.display === 'flex';
    const sourceContainer = isFiltersModalOpen ? filtersModalContent : modal;
    
    // Read source (pills)
    const active = sourceContainer?.querySelector('.s-m-diamond-picker-modal__pill.is-active');
    if (active) state.type = active.dataset.value || 'lab';
    
    // Read carat range
    const caratMin = sourceContainer?.querySelector('input[data-name="caratMin"]');
    const caratMax = sourceContainer?.querySelector('input[data-name="caratMax"]');
    if (caratMin) state.caratMin = parseFloat(caratMin.value) || 0.25;
    if (caratMax) state.caratMax = parseFloat(caratMax.value) || 10;
    
    // Read price range
    const priceMinInput = sourceContainer?.querySelector('input[data-name="priceMin"]');
    const priceMaxInput = sourceContainer?.querySelector('input[data-name="priceMax"]');
    if (priceMinInput) {
      const val = priceMinInput.value.replace(/[$,]/g, '');
      state.priceMin = parseFloat(val) || 0;
    }
    if (priceMaxInput) {
      const val = priceMaxInput.value.replace(/[$,]/g, '');
      state.priceMax = parseFloat(val) || 14523;
    }
    
    // Read shape selections
    const shapeButtons = sourceContainer?.querySelectorAll('.s-m-diamond-picker-modal__shape-btn.is-selected');
    state.shape = Array.from(shapeButtons || []).map(btn => btn.dataset.shape || btn.dataset.value).filter(Boolean);
    
    // Read color selections (checkboxes)
    const colorOptions = sourceContainer?.querySelectorAll('.s-m-diamond-picker-modal__color-option:checked');
    state.color = Array.from(colorOptions || []).map(cb => cb.dataset.value || cb.value);
    
    // Read clarity selections (checkboxes)
    const clarityOptions = sourceContainer?.querySelectorAll('.s-m-diamond-picker-modal__clarity-option:checked');
    state.clarity = Array.from(clarityOptions || []).map(cb => cb.dataset.value || cb.value);
    
    // Read cut selections (checkboxes)
    const cutOptions = sourceContainer?.querySelectorAll('.s-m-diamond-picker-modal__cut-option:checked');
    state.cut = Array.from(cutOptions || []).map(cb => cb.dataset.value || cb.value);
    
    // Read sort - check modal sort select first, then main sort select
    const modalSortSelect = filtersModalContent?.querySelector(`#filtersModalSort-${sectionId}`);
    if (modalSortSelect && isFiltersModalOpen) {
      state.sort = modalSortSelect.value || 'priceAsc';
    } else if (sortSelect) {
      state.sort = sortSelect.value || 'priceAsc';
    }
  }
  
  // Clear filters
  function clearFilters() {
    state.shape = [];
    state.caratMin = 0.25;
    state.caratMax = 10;
    state.color = [];
    state.clarity = [];
    state.cut = [];
    state.priceMin = 0;
    state.priceMax = 14523;
    state.type = 'lab';
    state.sort = 'priceAsc';
    state.page = 1;
    
    // Clear main modal filters
    if (caratMinInput) caratMinInput.value = '0.25';
    if (caratMaxInput) caratMaxInput.value = '10';
    const priceMinInput = modal?.querySelector('input[data-name="priceMin"]');
    const priceMaxInput = modal?.querySelector('input[data-name="priceMax"]');
    if (priceMinInput) priceMinInput.value = '$0';
    if (priceMaxInput) priceMaxInput.value = '$14,523';
    if (sortSelect) sortSelect.value = 'priceAsc';
    if (pillToggle) {
      pillToggle.querySelectorAll('.s-m-diamond-picker-modal__pill').forEach(p => p.classList.remove('is-active'));
      const labBtn = pillToggle.querySelector('[data-value="lab"]');
      if (labBtn) labBtn.classList.add('is-active');
    }
    modal?.querySelectorAll('.s-m-diamond-picker-modal__color-option').forEach(cb => cb.checked = false);
    modal?.querySelectorAll('.s-m-diamond-picker-modal__clarity-option').forEach(cb => cb.checked = false);
    modal?.querySelectorAll('.s-m-diamond-picker-modal__cut-option').forEach(cb => cb.checked = false);
    if (shapeGrid) {
      shapeGrid.querySelectorAll('.s-m-diamond-picker-modal__shape-btn').forEach(btn => {
        btn.classList.remove('is-selected');
      });
    }
    
    // Clear filters modal if open
    if (filtersModalContent) {
      const modalCaratMin = filtersModalContent.querySelector('input[data-name="caratMin"]');
      const modalCaratMax = filtersModalContent.querySelector('input[data-name="caratMax"]');
      if (modalCaratMin) modalCaratMin.value = '0.25';
      if (modalCaratMax) modalCaratMax.value = '10';
      const modalPriceMin = filtersModalContent.querySelector('input[data-name="priceMin"]');
      const modalPriceMax = filtersModalContent.querySelector('input[data-name="priceMax"]');
      if (modalPriceMin) modalPriceMin.value = '$0';
      if (modalPriceMax) modalPriceMax.value = '$14,523';
      const modalSortSelect = filtersModalContent.querySelector(`#filtersModalSort-${sectionId}`);
      if (modalSortSelect) modalSortSelect.value = 'priceAsc';
      const modalPillToggle = filtersModalContent.querySelector('.s-m-diamond-picker-modal__pill-toggle');
      if (modalPillToggle) {
        modalPillToggle.querySelectorAll('.s-m-diamond-picker-modal__pill').forEach(p => p.classList.remove('is-active'));
        const labBtn = modalPillToggle.querySelector('[data-value="lab"]');
        if (labBtn) labBtn.classList.add('is-active');
      }
      filtersModalContent.querySelectorAll('.s-m-diamond-picker-modal__color-option').forEach(cb => cb.checked = false);
      filtersModalContent.querySelectorAll('.s-m-diamond-picker-modal__clarity-option').forEach(cb => cb.checked = false);
      filtersModalContent.querySelectorAll('.s-m-diamond-picker-modal__cut-option').forEach(cb => cb.checked = false);
      const modalShapeGrid = filtersModalContent.querySelector(`#shapeFilters-${sectionId}`);
      if (modalShapeGrid) {
        modalShapeGrid.querySelectorAll('.s-m-diamond-picker-modal__shape-btn').forEach(btn => {
          btn.classList.remove('is-selected');
        });
      }
    }
  }
  
  // Initialize
  function init() {
    if (!modal) return;
    
    // Open modal - handle all trigger buttons
    const triggerButtons = document.querySelectorAll(`[data-diamond-picker-trigger]`);
    if (triggerButtons.length === 0) return;
    
    triggerButtons.forEach(triggerBtn => {
      triggerBtn.addEventListener('click', (e) => {
        e.preventDefault();
        if (modal && typeof modal.show === 'function') {
          modal.show(triggerBtn);
          state.page = 1;
          // Don't reset selectedDiamond - keep it if already selected
          // state.selectedDiamond = null;
          state.facetsLoaded = false;
          clearFilters();
          doSearch();
          updateTotalPrice();
          updateSelectedDiamondDisplay();
          // Enable button if diamond is already selected
          if (addDiamondBtn) {
            addDiamondBtn.disabled = !state.selectedDiamond;
          }
          // Hide filters by default on mobile
          if (filtersPanel && window.innerWidth <= 900) {
            filtersPanel.classList.remove('show');
          }
        }
      });
    });
    
    // Close modal
    if (closeBtn) {
      closeBtn.addEventListener('click', () => {
        if (modal && typeof modal.hide === 'function') {
          modal.hide();
          // Update product page after modal closes
          if (state.selectedDiamond) {
            setTimeout(() => {
              updateProductPageDiamondDisplay();
            }, 100);
          }
        }
      });
    }
    
    // Apply filters
    if (applyBtn) {
      applyBtn.addEventListener('click', () => {
        state.page = 1;
        readFilters();
        doSearch();
      });
    }
    
    // Clear filters
    if (clearBtn) {
      clearBtn.addEventListener('click', () => {
        clearFilters();
        doSearch();
      });
    }
    
    // Sort
    if (sortSelect) {
      sortSelect.addEventListener('change', () => {
        state.page = 1;
        readFilters();
        doSearch();
      });
    }
    
    // Pills
    if (pillToggle) {
      pillToggle.querySelectorAll('.s-m-diamond-picker-modal__pill').forEach(btn => {
        btn.addEventListener('click', () => {
          pillToggle.querySelectorAll('.s-m-diamond-picker-modal__pill').forEach(p => p.classList.remove('is-active'));
          btn.classList.add('is-active');
          state.page = 1;
          readFilters();
          doSearch();
        });
      });
    }
    
    // Color filters (checkboxes - change event) - auto-apply
    modal?.querySelectorAll('.s-m-diamond-picker-modal__color-option').forEach(cb => {
      cb.addEventListener('change', () => {
        state.page = 1;
        readFilters();
        doSearch();
      });
    });
    
    // Clarity filters (checkboxes - change event) - auto-apply
    modal?.querySelectorAll('.s-m-diamond-picker-modal__clarity-option').forEach(cb => {
      cb.addEventListener('change', () => {
        state.page = 1;
        readFilters();
        doSearch();
      });
    });
    
    // Cut filters (checkboxes - change event) - auto-apply
    modal?.querySelectorAll('.s-m-diamond-picker-modal__cut-option').forEach(cb => {
      cb.addEventListener('change', () => {
        state.page = 1;
        readFilters();
        doSearch();
      });
    });
    
    // Pagination
    if (prevBtn) {
      prevBtn.addEventListener('click', () => {
        if (state.page > 1) {
          state.page--;
          doSearch();
        }
      });
    }
    
    if (nextBtn) {
      nextBtn.addEventListener('click', () => {
        state.page++;
        doSearch();
      });
    }
    
    // Initialize range sliders
    function initRangeSlider(sliderEl, minInput, maxInput, minVal, maxVal, isPrice = false) {
      if (!sliderEl || !minInput || !maxInput) return;
      
      const container = sliderEl.querySelector('.s-m-diamond-picker-modal__slider-container');
      const track = sliderEl.querySelector('.s-m-diamond-picker-modal__slider-track');
      const handleMin = sliderEl.querySelector('.s-m-diamond-picker-modal__slider-handle.min');
      const handleMax = sliderEl.querySelector('.s-m-diamond-picker-modal__slider-handle.max');
      
      if (!container || !track || !handleMin || !handleMax) return;
      
      const formatValue = (val) => {
        if (isPrice) {
          return '$' + Math.round(val).toLocaleString();
        }
        return val.toFixed(2);
      };
      
      const parseValue = (val) => {
        if (isPrice) {
          return parseFloat(val.replace(/[$,]/g, '')) || 0;
        }
        return parseFloat(val) || 0;
      };
      
      const updateSlider = () => {
        const min = parseValue(minInput.value);
        const max = parseValue(maxInput.value);
        const minPct = ((min - minVal) / (maxVal - minVal)) * 100;
        const maxPct = ((max - minVal) / (maxVal - minVal)) * 100;
        
        handleMin.style.left = `${Math.max(0, Math.min(100, minPct))}%`;
        handleMax.style.left = `${Math.max(0, Math.min(100, maxPct))}%`;
        
        const left = Math.min(minPct, maxPct);
        const right = Math.max(minPct, maxPct);
        track.style.left = `${left}%`;
        track.style.width = `${right - left}%`;
      };
      
      const getValueFromPosition = (x) => {
        const rect = container.getBoundingClientRect();
        const percent = Math.max(0, Math.min(100, ((x - rect.left) / rect.width) * 100));
        return minVal + (percent / 100) * (maxVal - minVal);
      };
      
      let isDragging = false;
      let dragHandle = null;
      
      const startDrag = (e, handle) => {
        isDragging = true;
        dragHandle = handle;
        e.preventDefault();
      };
      
      const onDrag = (e) => {
        if (!isDragging || !dragHandle) return;
        const value = getValueFromPosition(e.clientX || e.touches?.[0]?.clientX);
        const currentMin = parseValue(minInput.value);
        const currentMax = parseValue(maxInput.value);
        
        if (dragHandle === handleMin) {
          const newMin = Math.max(minVal, Math.min(value, currentMax));
          minInput.value = isPrice ? formatValue(newMin) : newMin.toFixed(2);
        } else {
          const newMax = Math.min(maxVal, Math.max(value, currentMin));
          maxInput.value = isPrice ? formatValue(newMax) : newMax.toFixed(2);
        }
        
        updateSlider();
        if (isPrice) {
          state.priceMin = parseValue(minInput.value);
          state.priceMax = parseValue(maxInput.value);
        } else {
          state.caratMin = parseValue(minInput.value);
          state.caratMax = parseValue(maxInput.value);
        }
      };
      
      const stopDrag = () => {
        if (isDragging) {
          // Auto-apply filters when drag ends
          state.page = 1;
          readFilters();
          doSearch();
        }
        isDragging = false;
        dragHandle = null;
      };
      
      // Click on container to set value
      container.addEventListener('click', (e) => {
        if (e.target === container || e.target === track || e.target.closest('.s-m-diamond-picker-modal__slider-track')) {
          const value = getValueFromPosition(e.clientX);
          const currentMin = parseValue(minInput.value);
          const currentMax = parseValue(maxInput.value);
          const minDist = Math.abs(value - currentMin);
          const maxDist = Math.abs(value - currentMax);
          
          if (minDist < maxDist) {
            const newMin = Math.max(minVal, Math.min(value, currentMax));
            minInput.value = isPrice ? formatValue(newMin) : newMin.toFixed(2);
            if (isPrice) {
              state.priceMin = parseValue(minInput.value);
            } else {
              state.caratMin = parseValue(minInput.value);
            }
          } else {
            const newMax = Math.min(maxVal, Math.max(value, currentMin));
            maxInput.value = isPrice ? formatValue(newMax) : newMax.toFixed(2);
            if (isPrice) {
              state.priceMax = parseValue(maxInput.value);
            } else {
              state.caratMax = parseValue(maxInput.value);
            }
          }
          updateSlider();
          // Auto-apply filters when clicking on slider
          state.page = 1;
          readFilters();
          doSearch();
        }
      });
      
      handleMin.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        startDrag(e, handleMin);
      });
      handleMax.addEventListener('mousedown', (e) => {
        e.stopPropagation();
        startDrag(e, handleMax);
      });
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('mouseup', stopDrag);
      handleMin.addEventListener('touchstart', (e) => {
        e.stopPropagation();
        startDrag(e, handleMin);
      });
      handleMax.addEventListener('touchstart', (e) => {
        e.stopPropagation();
        startDrag(e, handleMax);
      });
      document.addEventListener('touchmove', onDrag);
      document.addEventListener('touchend', stopDrag);
      
      // Debounce function for auto-apply
      let inputTimeout;
      const debouncedAutoApply = () => {
        clearTimeout(inputTimeout);
        inputTimeout = setTimeout(() => {
          state.page = 1;
          readFilters();
          doSearch();
        }, 500); // Wait 500ms after user stops typing
      };
      
      minInput.addEventListener('input', () => {
        updateSlider();
        if (isPrice) {
          state.priceMin = parseValue(minInput.value);
        } else {
          state.caratMin = parseValue(minInput.value);
        }
        debouncedAutoApply();
      });
      
      maxInput.addEventListener('input', () => {
        updateSlider();
        if (isPrice) {
          state.priceMax = parseValue(maxInput.value);
        } else {
          state.caratMax = parseValue(maxInput.value);
        }
        debouncedAutoApply();
      });
      
      updateSlider();
    }
    
    // Initialize carat range slider
    const caratSlider = modal?.querySelector('.s-m-diamond-picker-modal__range-slider[data-name="carats"]');
    if (caratSlider && caratMinInput && caratMaxInput) {
      initRangeSlider(caratSlider, caratMinInput, caratMaxInput, 0, 10, false);
    }
    
    // Initialize price range slider
    const priceSlider = modal?.querySelector('.s-m-diamond-picker-modal__range-slider[data-name="price"]');
    const priceMinInput = modal?.querySelector('input[data-name="priceMin"]');
    const priceMaxInput = modal?.querySelector('input[data-name="priceMax"]');
    if (priceSlider && priceMinInput && priceMaxInput) {
      initRangeSlider(priceSlider, priceMinInput, priceMaxInput, 0, 14523, true);
    }
    
    // Hide/show filters
    if (hideFiltersBtn && filtersPanel) {
      const hideIcon = hideFiltersBtn.querySelector('svg');
      const hideIconClone = hideIcon ? hideIcon.cloneNode(true) : null;
      const showIcon = hideIcon ? hideIcon.cloneNode(true) : null;
      if (showIcon) {
        const path = showIcon.querySelector('path');
        if (path) {
          path.setAttribute('d', 'M4.16699 10H15.8337M10 4.16699V15.8337');
        }
      }
      
      hideFiltersBtn.addEventListener('click', () => {
        const isHidden = filtersPanel.classList.contains('hidden');
        if (isHidden) {
          filtersPanel.classList.remove('hidden');
          document.querySelector('.s-m-diamond-picker-modal__results')?.classList.remove('full-width');
          hideFiltersBtn.innerHTML = '';
          if (hideIconClone) hideFiltersBtn.appendChild(hideIconClone.cloneNode(true));
          hideFiltersBtn.appendChild(document.createTextNode(' Hide Filters'));
        } else {
          filtersPanel.classList.add('hidden');
          document.querySelector('.s-m-diamond-picker-modal__results')?.classList.add('full-width');
          hideFiltersBtn.innerHTML = '';
          if (showIcon) hideFiltersBtn.appendChild(showIcon.cloneNode(true));
          hideFiltersBtn.appendChild(document.createTextNode(' Show Filters'));
        }
      });
    }
    
    // Initialize filters in modal
    function initFiltersModal() {
      if (!filtersModalContent) return;
      
      // Initialize shape buttons
      const modalShapeGrid = filtersModalContent.querySelector(`#shapeFilters-${sectionId}`);
      if (modalShapeGrid) {
        modalShapeGrid.querySelectorAll('.s-m-diamond-picker-modal__shape-btn').forEach(btn => {
          // Remove any existing listeners
          const newBtn = btn.cloneNode(true);
          btn.parentNode.replaceChild(newBtn, btn);
          newBtn.addEventListener('click', () => {
            const shape = newBtn.dataset.shape || newBtn.dataset.value;
            if (!shape) return;
            const normalizedShape = uc(shape);
            const index = state.shape.findIndex(s => uc(s) === normalizedShape);
            if (index > -1) {
              state.shape.splice(index, 1);
              newBtn.classList.remove('is-selected');
            } else {
              state.shape.push(shape);
              newBtn.classList.add('is-selected');
            }
            // Also update in main modal
            if (shapeGrid) {
              const mainBtn = shapeGrid.querySelector(`[data-shape="${shape}"], [data-value="${shape}"]`);
              if (mainBtn) {
                if (index > -1) {
                  mainBtn.classList.remove('is-selected');
                } else {
                  mainBtn.classList.add('is-selected');
                }
              }
            }
          });
        });
      }
      
      // Initialize source pills
      const modalPillToggle = filtersModalContent.querySelector('.s-m-diamond-picker-modal__pill-toggle');
      if (modalPillToggle) {
        modalPillToggle.querySelectorAll('.s-m-diamond-picker-modal__pill').forEach(btn => {
          btn.addEventListener('click', () => {
            modalPillToggle.querySelectorAll('.s-m-diamond-picker-modal__pill').forEach(p => p.classList.remove('is-active'));
            btn.classList.add('is-active');
            // Also update in main modal
            if (pillToggle) {
              const mainBtn = pillToggle.querySelector(`[data-value="${btn.dataset.value}"]`);
              if (mainBtn) {
                pillToggle.querySelectorAll('.s-m-diamond-picker-modal__pill').forEach(p => p.classList.remove('is-active'));
                mainBtn.classList.add('is-active');
              }
            }
          });
        });
      }
      
      // Initialize carat range slider
      const modalCaratSlider = filtersModalContent.querySelector('.s-m-diamond-picker-modal__range-slider[data-name="carats"]');
      const modalCaratMinInput = filtersModalContent.querySelector('input[data-name="caratMin"]');
      const modalCaratMaxInput = filtersModalContent.querySelector('input[data-name="caratMax"]');
      if (modalCaratSlider && modalCaratMinInput && modalCaratMaxInput) {
        initRangeSlider(modalCaratSlider, modalCaratMinInput, modalCaratMaxInput, 0, 10, false);
      }
      
      // Initialize price range slider
      const modalPriceSlider = filtersModalContent.querySelector('.s-m-diamond-picker-modal__range-slider[data-name="price"]');
      const modalPriceMinInput = filtersModalContent.querySelector('input[data-name="priceMin"]');
      const modalPriceMaxInput = filtersModalContent.querySelector('input[data-name="priceMax"]');
      if (modalPriceSlider && modalPriceMinInput && modalPriceMaxInput) {
        initRangeSlider(modalPriceSlider, modalPriceMinInput, modalPriceMaxInput, 0, 14523, true);
      }
      
      // Initialize color/clarity/cut checkboxes (no auto-apply in modal, wait for Apply button)
      filtersModalContent.querySelectorAll('.s-m-diamond-picker-modal__color-option, .s-m-diamond-picker-modal__clarity-option, .s-m-diamond-picker-modal__cut-option').forEach(cb => {
        cb.addEventListener('change', () => {
          // Just update state, don't search yet - wait for Apply button
        });
      });
    }

    // Sort & Filters button (mobile) - opens filters modal
    if (sortFiltersBtn && filtersModal && filtersModalContent && filtersPanel) {
      sortFiltersBtn.addEventListener('click', () => {
        if (window.innerWidth <= 900) {
          // Copy filters content to modal (excluding header with Clear/Apply buttons)
          if (filtersPanel) {
            const filterGroups = filtersPanel.querySelectorAll('.s-m-diamond-picker-modal__filter-group');
            let filtersHTML = '';
            filterGroups.forEach(group => {
              filtersHTML += group.outerHTML;
            });
            // Get the sort section HTML
            const sortSection = filtersModalContent.querySelector('.s-m-filters-modal__sort-section');
            const sortSectionHTML = sortSection ? sortSection.outerHTML : '';
            filtersModalContent.innerHTML = sortSectionHTML + filtersHTML;
            
            // Sync sort select value
            const modalSortSelect = filtersModalContent.querySelector(`#filtersModalSort-${sectionId}`);
            if (modalSortSelect && sortSelect) {
              modalSortSelect.value = sortSelect.value;
            }
            
            // Sync current filter states to modal
            // Sync shape selections
            const modalShapeGrid = filtersModalContent.querySelector(`#shapeFilters-${sectionId}`);
            if (state.shape.length > 0 && modalShapeGrid) {
              state.shape.forEach(shape => {
                const normalizedShape = uc(shape);
                const btn = Array.from(modalShapeGrid.querySelectorAll('.s-m-diamond-picker-modal__shape-btn'))
                  .find(b => uc(b.dataset.shape || b.dataset.value) === normalizedShape);
                if (btn) btn.classList.add('is-selected');
              });
            }
            
            // Sync source selection
            const modalPillToggle = filtersModalContent.querySelector('.s-m-diamond-picker-modal__pill-toggle');
            if (modalPillToggle && state.type) {
              modalPillToggle.querySelectorAll('.s-m-diamond-picker-modal__pill').forEach(p => p.classList.remove('is-active'));
              const activeBtn = modalPillToggle.querySelector(`[data-value="${state.type}"]`);
              if (activeBtn) activeBtn.classList.add('is-active');
            }
            
            // Initialize event listeners for modal filters
            initFiltersModal();
          }
          filtersModal.style.display = 'flex';
          document.body.style.overflow = 'hidden';
        } else {
          // Desktop behavior - toggle filters panel
          const isShowing = filtersPanel.classList.contains('show');
          if (isShowing) {
            filtersPanel.classList.remove('show');
          } else {
            filtersPanel.classList.add('show');
          }
        }
      });
    }

    // Close filters modal
    if (filtersModalClose && filtersModal) {
      filtersModalClose.addEventListener('click', () => {
        filtersModal.style.display = 'none';
        document.body.style.overflow = '';
      });
    }

    // Filters modal overlay click to close
    if (filtersModal) {
      const overlay = filtersModal.querySelector('.s-m-filters-modal__overlay');
      if (overlay) {
        overlay.addEventListener('click', () => {
          filtersModal.style.display = 'none';
          document.body.style.overflow = '';
        });
      }
    }

    // Filters modal clear button
    if (filtersModalClear) {
      filtersModalClear.addEventListener('click', () => {
        clearFilters();
        // Update main modal filters
        if (filtersPanel) {
          // Clear shape selections
          if (shapeGrid) {
            shapeGrid.querySelectorAll('.s-m-diamond-picker-modal__shape-btn').forEach(btn => {
              btn.classList.remove('is-selected');
            });
          }
          // Clear source
          if (pillToggle) {
            pillToggle.querySelectorAll('.s-m-diamond-picker-modal__pill').forEach(p => p.classList.remove('is-active'));
            const labBtn = pillToggle.querySelector('[data-value="lab"]');
            if (labBtn) labBtn.classList.add('is-active');
          }
        }
        // Update modal content
        if (filtersModalContent) {
          const filterGroups = filtersPanel?.querySelectorAll('.s-m-diamond-picker-modal__filter-group');
          let filtersHTML = '';
          filterGroups?.forEach(group => {
            filtersHTML += group.outerHTML;
          });
          const sortSection = filtersModalContent.querySelector('.s-m-filters-modal__sort-section');
          const sortSectionHTML = sortSection ? sortSection.outerHTML : '';
          filtersModalContent.innerHTML = sortSectionHTML + filtersHTML;
          initFiltersModal();
        }
      });
    }

    // Filters modal apply button
    if (filtersModalApply) {
      filtersModalApply.addEventListener('click', () => {
        // Sync sort value from modal to main sort select
        const modalSortSelect = filtersModalContent?.querySelector(`#filtersModalSort-${sectionId}`);
        if (modalSortSelect && sortSelect) {
          sortSelect.value = modalSortSelect.value;
        }
        // Sync filter states from modal to main modal
        // Sync shape selections
        const modalShapeGrid = filtersModalContent?.querySelector(`#shapeFilters-${sectionId}`);
        if (modalShapeGrid && shapeGrid) {
          const selectedShapes = Array.from(modalShapeGrid.querySelectorAll('.s-m-diamond-picker-modal__shape-btn.is-selected'))
            .map(btn => {
              const shape = btn.dataset.shape || btn.dataset.value;
              return shape ? uc(shape) : null;
            }).filter(Boolean);
          shapeGrid.querySelectorAll('.s-m-diamond-picker-modal__shape-btn').forEach(btn => {
            const shape = btn.dataset.shape || btn.dataset.value;
            if (shape && selectedShapes.includes(uc(shape))) {
              btn.classList.add('is-selected');
            } else {
              btn.classList.remove('is-selected');
            }
          });
        }
        // Sync source selection
        const modalPillToggle = filtersModalContent?.querySelector('.s-m-diamond-picker-modal__pill-toggle');
        if (modalPillToggle && pillToggle) {
          const activeModalPill = modalPillToggle.querySelector('.is-active');
          if (activeModalPill) {
            const value = activeModalPill.dataset.value;
            pillToggle.querySelectorAll('.s-m-diamond-picker-modal__pill').forEach(p => p.classList.remove('is-active'));
            const mainPill = pillToggle.querySelector(`[data-value="${value}"]`);
            if (mainPill) mainPill.classList.add('is-active');
          }
        }
        // Sync range inputs
        const modalCaratMin = filtersModalContent?.querySelector('input[data-name="caratMin"]');
        const modalCaratMax = filtersModalContent?.querySelector('input[data-name="caratMax"]');
        if (modalCaratMin && caratMinInput) caratMinInput.value = modalCaratMin.value;
        if (modalCaratMax && caratMaxInput) caratMaxInput.value = modalCaratMax.value;
        const modalPriceMin = filtersModalContent?.querySelector('input[data-name="priceMin"]');
        const modalPriceMax = filtersModalContent?.querySelector('input[data-name="priceMax"]');
        if (modalPriceMin && modal) {
          const mainPriceMin = modal.querySelector('input[data-name="priceMin"]');
          if (mainPriceMin) mainPriceMin.value = modalPriceMin.value;
        }
        if (modalPriceMax && modal) {
          const mainPriceMax = modal.querySelector('input[data-name="priceMax"]');
          if (mainPriceMax) mainPriceMax.value = modalPriceMax.value;
        }
        // Sync checkboxes
        ['color', 'clarity', 'cut'].forEach(type => {
          const modalOptions = filtersModalContent?.querySelectorAll(`.s-m-diamond-picker-modal__${type}-option`);
          const mainOptions = modal?.querySelectorAll(`.s-m-diamond-picker-modal__${type}-option`);
          if (modalOptions && mainOptions) {
            modalOptions.forEach(modalCb => {
              const value = modalCb.dataset.value || modalCb.value;
              const mainCb = Array.from(mainOptions).find(cb => (cb.dataset.value || cb.value) === value);
              if (mainCb) {
                mainCb.checked = modalCb.checked;
              }
            });
          }
        });
        state.page = 1;
        readFilters();
        doSearch();
        filtersModal.style.display = 'none';
        document.body.style.overflow = '';
      });
    }

    // Filters modal sort select change
    if (filtersModalContent) {
      filtersModalContent.addEventListener('change', (e) => {
        if (e.target.id === `filtersModalSort-${sectionId}`) {
          // Sort is handled on apply
        }
      });
    }
    
    // Update selected diamond display on product page
    function updateProductPageDiamondDisplay() {
      const selectedDisplay = document.getElementById(`selectedDiamondDisplay-${sectionId}`);
      const addDiamondBtnEl = document.getElementById(`addDiamondButton-${sectionId}`);
      const addToCartBtn = document.getElementById(`addToCartButton-${sectionId}`);
      
      if (!state.selectedDiamond) {
        // Hide selected display, show add button
        if (selectedDisplay) selectedDisplay.style.display = 'none';
        if (addDiamondBtnEl) addDiamondBtnEl.style.display = 'inline-flex';
        if (addToCartBtn) {
          const span = addToCartBtn.querySelector('span');
          if (span) span.textContent = 'Add Setting Only to Cart';
        }
        // Update main price to show setting price only
        updateTotalPrice();
        return;
      }
      
      // Show selected display, hide add button
      if (selectedDisplay) selectedDisplay.style.display = 'flex';
      if (addDiamondBtnEl) {
        addDiamondBtnEl.style.display = 'none';
        addDiamondBtnEl.disabled = false;
      }
      if (addToCartBtn) {
        const span = addToCartBtn.querySelector('span');
        if (span) span.textContent = 'Add to Cart';
      }
      
      const diamond = state.selectedDiamond;
      const shapeTxt = shapeLabel(diamond.shape || '');
      const cutTxt = cutCardLabel(diamond.cut || '');
      const sourceType = state.type === 'lab' ? 'Lab Grown' : state.type === 'natural' ? 'Natural' : 'All';
      
      // Update image
      const diamondImage = document.getElementById(`selectedDiamondImage-${sectionId}`);
      if (diamondImage) {
        const imageSrc = (diamond.images && diamond.images[0]) ? diamond.images[0] : PLACEHOLDER_IMG;
        diamondImage.src = imageSrc;
        diamondImage.alt = `${shapeTxt} ${diamond.carat}ct`;
      }
      
      // Update price
      const diamondPrice = document.getElementById(`selectedDiamondPrice-${sectionId}`);
      if (diamondPrice) {
        let price = diamond.priceRetail;
        // Ensure price is a number, handling string values with leading zeros
        if (typeof price === 'string') {
          price = parseFloat(price.replace(/^0+/, '').replace(/^0+\./, '0.')) || 0;
        } else {
          price = parseFloat(price) || 0;
        }
        diamondPrice.textContent = `+ ${money(price)}`;
      }
      
      // Update details - format as per Figma: "1.8 ct Round<br/>F VS1 Ideal<br/>Lab Grown"
      const diamondDetails = document.getElementById(`selectedDiamondDetails-${sectionId}`);
      if (diamondDetails) {
        diamondDetails.innerHTML = `
          ${diamond.carat?.toFixed?.(2) ?? diamond.carat} ct ${shapeTxt}<br/>
          ${diamond.color} ${diamond.clarity} ${cutTxt}<br/>
          ${sourceType}
        `;
      }
      
      // Update main price to show total (setting + diamond)
      updateTotalPrice();
      
      // Store diamond data in a hidden input for form submission
      const form = document.querySelector('.s-m-form');
      if (form) {
        let diamondInput = form.querySelector('input[name="properties[Diamond]"]');
        if (!diamondInput) {
          diamondInput = document.createElement('input');
          diamondInput.type = 'hidden';
          diamondInput.name = 'properties[Diamond]';
          form.appendChild(diamondInput);
        }
        // Format diamond info for display
        const shapeMap = {
          'ROUND': 'Round',
          'PRINCESS': 'Princess',
          'CUSHION': 'Cushion',
          'PEAR': 'Pear',
          'MARQUISE': 'Marquise',
          'OVAL': 'Oval',
          'HEART': 'Heart',
          'RADIANT': 'Radiant',
          'ASSCHER': 'Asscher',
          'EMERALD': 'Emerald'
        };
        const shapeTxt = shapeMap[diamond.shape] || diamond.shape || '';
        const cutTxt = diamond.cut || '';
        const sourceType = diamond.type === 'lab' ? 'Lab Grown' : (diamond.type === 'natural' ? 'Natural' : '');
        const carat = diamond.carat?.toFixed?.(2) ?? diamond.carat;
        
        // Format as readable string: "1.27 ct Radiant, F VS1, Lab Grown"
        const diamondDisplay = `${carat} ct ${shapeTxt}, ${diamond.color} ${diamond.clarity}${cutTxt !== '' ? ' ' + cutTxt : ''}, ${sourceType}`;
        
        diamondInput.value = diamondDisplay;
      }
    }
    
    // Add diamond button (in modal footer)
    if (addDiamondBtn) {
      addDiamondBtn.addEventListener('click', () => {
        if (state.selectedDiamond) {
          // Close modal first
          if (modal && typeof modal.hide === 'function') {
            modal.hide();
          }
          
          // Update product page after modal closes
          setTimeout(() => {
            updateProductPageDiamondDisplay();
          }, 100);
        }
      });
    }
    
    // Update display when modal closes
    if (modal) {
      const observer = new MutationObserver(() => {
        if (state.selectedDiamond && !modal.hasAttribute('open')) {
          // Only update product page after modal closes
          setTimeout(() => {
            updateProductPageDiamondDisplay();
          }, 100);
        }
      });
      observer.observe(modal, { attributes: true, attributeFilter: ['open'] });
    }
    
    // Clear diamond button
    document.querySelectorAll('[data-clear-diamond]').forEach(btn => {
      btn.addEventListener('click', () => {
        state.selectedDiamond = null;
        updateProductPageDiamondDisplay();
        updateSelectedDiamondDisplay();
        updateTotalPrice();
        
        // Re-render grid to update button states
        if (grid) {
          renderGrid(grid.querySelectorAll('.s-m-diamond-picker-modal__card').length ? 
            Array.from(grid.querySelectorAll('.s-m-diamond-picker-modal__card')).map(card => {
              const btn = card.querySelector('.s-m-diamond-picker-modal__card-btn');
              return JSON.parse(btn.dataset.diamond);
            }) : []);
        }
        
        // Remove diamond input from form
        const form = document.querySelector('.s-m-form');
        if (form) {
          const diamondInput = form.querySelector('input[name="properties[Diamond]"]');
          if (diamondInput) diamondInput.remove();
        }
      });
    });
    
    // Edit button - open modal
    document.querySelectorAll('[data-diamond-picker-trigger-edit]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        if (modal && typeof modal.show === 'function') {
          modal.show(btn);
          state.page = 1;
          state.facetsLoaded = false;
          clearFilters();
          doSearch();
          updateTotalPrice();
          updateSelectedDiamondDisplay();
          if (addDiamondBtn) {
            addDiamondBtn.disabled = !state.selectedDiamond;
          }
          if (filtersPanel && window.innerWidth <= 900) {
            filtersPanel.classList.remove('show');
          }
        }
      });
    });
    
    // Initialize gallery
    if (galleryModal) {
      const closeBtn = galleryModal.querySelector('.s-m-diamond-gallery-modal__close');
      const prevBtn = galleryModal.querySelector('.s-m-diamond-gallery-modal__nav--prev');
      const nextBtn = galleryModal.querySelector('.s-m-diamond-gallery-modal__nav--next');
      const overlay = galleryModal.querySelector('.s-m-diamond-gallery-modal__overlay');
      
      if (closeBtn) {
        closeBtn.addEventListener('click', closeGallery);
      }
      if (overlay) {
        overlay.addEventListener('click', closeGallery);
      }
      if (prevBtn) {
        prevBtn.addEventListener('click', galleryPrev);
      }
      if (nextBtn) {
        nextBtn.addEventListener('click', galleryNext);
      }
      
      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (galleryModal.style.display === 'none' || galleryModal.style.display === '') return;
        
        if (e.key === 'Escape') {
          closeGallery();
        } else if (e.key === 'ArrowLeft') {
          galleryPrev();
        } else if (e.key === 'ArrowRight') {
          galleryNext();
        }
      });
      
      // Swipe support for touch devices
      let touchStartX = 0;
      let touchEndX = 0;
      
      const mediaEl = galleryModal.querySelector('.s-m-diamond-gallery-modal__media');
      if (mediaEl) {
        mediaEl.addEventListener('touchstart', (e) => {
          touchStartX = e.changedTouches[0].screenX;
        }, { passive: true });
        
        mediaEl.addEventListener('touchend', (e) => {
          touchEndX = e.changedTouches[0].screenX;
          handleSwipe();
        }, { passive: true });
      }
      
      function handleSwipe() {
        const swipeThreshold = 50;
        const diff = touchStartX - touchEndX;
        
        if (Math.abs(diff) > swipeThreshold) {
          if (diff > 0) {
            // Swipe left - next
            galleryNext();
          } else {
            // Swipe right - prev
            galleryPrev();
          }
        }
      }
    }
    
    // Initialize display on page load if diamond is already selected
    if (state.selectedDiamond) {
      updateProductPageDiamondDisplay();
    }
    
    // Initialize currency code styling on page load
    initializeCurrencyCodeStyling();
  }
  
  // Initialize currency code styling by wrapping existing currency codes
  function initializeCurrencyCodeStyling() {
    const mainPriceContainer = document.getElementById(`price-${sectionId}`);
    if (!mainPriceContainer) return;
    
    const salePriceItem = mainPriceContainer.querySelector('.price__sale .price-item--sale');
    const regularPriceItem = mainPriceContainer.querySelector('.price__regular .price-item--regular');
    const isOnSale = mainPriceContainer.classList.contains('price--on-sale');
    const priceItem = isOnSale ? salePriceItem : regularPriceItem;
    
    if (priceItem && !priceItem.querySelector('.s-m-price-currency-code')) {
      const text = priceItem.textContent.trim();
      const currencyMatch = text.match(/(\d+[.,]\d+)\s+(USD|CAD|EUR|GBP|AUD|JPY|CHF|CNY)$/);
      if (currencyMatch) {
        const priceNumber = currencyMatch[1];
        const currencyCode = currencyMatch[2];
        priceItem.innerHTML = `${priceNumber} <span class="s-m-price-currency-code">${currencyCode}</span>`;
      }
    }
  }
  
  // Wait for DOM
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
  } else {
    init();
  }
})();
</script>
