{%- comment -%}
  Shows original (strike-through) → discounted price + badge
  - Computes the best per-item promo among multiple automatic discounts.
  - Does not change the real product price; it’s display-only.

  CONFIG:
  - Update the collection handles and discount values below if needed.
{%- endcomment -%}

{%- comment -%} Black Friday Discounts (Priority) {%- endcomment -%}
{%- assign bf_diamond_classics_collection = 'diamond-classics' -%}
{%- assign bf_diamond_classics_percent = 70 -%}

{%- assign bf_diamond_pendants_collection = 'lab-grown-diamond-initial-pendant-necklaces' -%}
{%- assign bf_diamond_pendants_percent = 60 -%}

{%- assign bf_rolex_collection = 'pre-owned-rolex' -%}
{%- assign bf_rolex_fixed_amount_cents = 200000 -%}

{%- assign rolex_1_collection = 'rolex-1' -%}
{%- assign rolex_1_fixed_amount_cents = 200000 -%}

{%- comment -%} Regular 15% Launch Offer {%- endcomment -%}
{% assign percent_offer_collections = '' %}
{% assign percent_offer_collection = percent_offer_collections | split: ',' %}
{%- assign percent_offer_value = 15 -%}

{%- assign variant = product.selected_or_first_available_variant -%}
{%- assign base_price = variant.price -%}

{%- assign best_price = base_price -%}
{%- assign best_label = '' -%}

{%- comment -%} Check collections for Black Friday discounts {%- endcomment -%}
{%- assign in_bf_diamond_classics = false -%}
{%- assign in_bf_diamond_pendants = false -%}
{%- assign in_bf_rolex = false -%}
{%- assign in_rolex_1 = false -%}
{%- assign in_percent_offer = false -%}

{%- for c in product.collections -%}
  {%- if c.handle == bf_diamond_classics_collection -%}{% assign in_bf_diamond_classics = true %}{% endif -%}
  {%- if c.handle == bf_diamond_pendants_collection -%}{% assign in_bf_diamond_pendants = true %}{% endif -%}
  {%- if c.handle == bf_rolex_collection -%}{% assign in_bf_rolex = true %}{% endif -%}
  {%- if c.handle == rolex_1_collection -%}{% assign in_rolex_1 = true %}{% endif -%}
  {%- if percent_offer_collection contains c.handle -%}{% assign in_percent_offer = true %}{% endif -%}
{%- endfor -%}

{%- comment -%} Black Friday Diamond Classics - 70% off (Priority 1) {%- endcomment -%}
{%- if in_bf_diamond_classics -%}
  {%- assign percent_left = 100 | minus: bf_diamond_classics_percent -%}
  {%- assign cand = base_price | times: percent_left | divided_by: 100 -%}
  {%- assign best_price = cand -%}
  {%- assign best_label = 'Black Friday Diamond Classics' -%}
{%- elsif in_bf_diamond_pendants -%}
  {%- comment -%} Black Friday Diamond Pendants - 60% off (Priority 2) {%- endcomment -%}
  {%- assign percent_left = 100 | minus: bf_diamond_pendants_percent -%}
  {%- assign cand = base_price | times: percent_left | divided_by: 100 -%}
  {%- assign best_price = cand -%}
  {%- assign best_label = 'Black Friday Diamond Pendants' -%}
{%- elsif in_bf_rolex -%}
  {%- comment -%} Black Friday Pre-Owned Rolex - $2,000 off (Priority 3) {%- endcomment -%}
  {%- assign cand = base_price | minus: bf_rolex_fixed_amount_cents -%}
  {%- if cand < 0 -%}{% assign cand = 0 %}{%- endif -%}
  {%- assign best_price = cand -%}
  {%- assign best_label = 'Black Friday Pre-Owned Rolex' -%}
{%- elsif in_rolex_1 -%}
  {%- comment -%} Rolex-1 Collection - $2,000 off (Priority 4) {%- endcomment -%}
  {%- assign cand = base_price | minus: rolex_1_fixed_amount_cents -%}
  {%- if cand < 0 -%}{% assign cand = 0 %}{%- endif -%}
  {%- assign best_price = cand -%}
  {%- assign best_label = 'Black Friday Pre-Owned Rolex' -%}
{%- endif -%}

{%- comment -%} 15% Off Launch Offer (Fallback) {%- endcomment -%}
{% comment %} {%- if in_percent_offer and best_price == base_price -%}
  {%- assign percent_left = 100 | minus: percent_offer_value -%}
  {%- assign cand = base_price | times: percent_left | divided_by: 100 -%}
  {%- assign best_price = cand -%}
  {%- assign best_label = '15% Off Launch Offer' -%}
{%- endif -%} {% endcomment %}

{%- comment -%} Only render if a promo actually lowers the price {%- endcomment -%}
{%- assign show_promo = false -%}
{%- if best_price < base_price -%}{% assign show_promo = true %}{%- endif -%}

{%- if show_promo -%}
  <div class="promo-price-block price price--on-sale">
    <div class="price__container">
      <div class="price__sale">
        <span class="price-item price-item--sale price-item--last">
          {% if clean_format %}
            $
            {{-
              best_price
              | money_without_currency
              | replace: '.00', ''
              | replace: '.10', '.1'
              | replace: '.20', '.2'
              | replace: '.30', '.3'
              | replace: '.40', '.4'
              | replace: '.50', '.5'
              | replace: '.60', '.6'
              | replace: '.70', '.7'
              | replace: '.80', '.8'
              | replace: '.90', '.9'
            }}
          {% elsif settings.currency_code_enabled %}
            {{ best_price | money_with_currency }}
          {% else %}
            {{ best_price | money }}
          {% endif %}
        </span>
        <span class="visually-hidden visually-hidden--inline">
          {{ 'products.product.price.regular_price' | t }}
        </span>
        <span>
          <s class="price-item price-item--regular">
            {% if clean_format %}
              $
              {{-
                base_price
                | money_without_currency
                | replace: '.00', ''
                | replace: '.10', '.1'
                | replace: '.20', '.2'
                | replace: '.30', '.3'
                | replace: '.40', '.4'
                | replace: '.50', '.5'
                | replace: '.60', '.6'
                | replace: '.70', '.7'
                | replace: '.80', '.8'
                | replace: '.90', '.9'
              }}
            {% elsif settings.currency_code_enabled %}
              {{ base_price | money_with_currency }}
            {% else %}
              {{ base_price | money }}
            {% endif %}
          </s>
        </span>
        <span class="visually-hidden visually-hidden--inline">
          {{ 'products.product.price.sale_price' | t }}
        </span>
        {%- if product.available -%}
          {%- if template.suffix == 'pre-owned-rolex'
            or section.settings.show_rolex_product_card
            or collection.handle == 'rolex-1'
            or section.type == 'p-o-r-homepage-section'
          -%}
            <div class="promo-badge">
              <ul class="discounts list-unstyled" role="list" aria-label="Discount">
                <li class="discounts__discount">
                  <svg class="icon icon-discount" viewBox="0 0 12 12">
                    <path fill="currentColor" fill-rule="evenodd" d="M7 0h3a2 2 0 0 1 2 2v3a1 1 0 0 1-.3.7l-6 6a1 1 0 0 1-1.4 0l-4-4a1 1 0 0 1 0-1.4l6-6A1 1 0 0 1 7 0m2 2a1 1 0 1 0 2 0 1 1 0 0 0-2 0" clip-rule="evenodd"></path>
                  </svg>
                  {{ best_label }}
                </li>
              </ul>
            </div>
          {% endif %}
        {%- endif -%}
      </div>
    </div>

    {%- unless template.suffix == 'pre-owned-rolex'
      or section.settings.show_rolex_product_card
      or collection.handle == 'rolex-1'
      or section.type == 'p-o-r-homepage-section'
    -%}
     
      {%- if product.available -%}
        <div class="promo-badge">
          <ul class="discounts list-unstyled" role="list" aria-label="Discount">
            <li class="discounts__discount">
              <svg class="icon icon-discount" viewBox="0 0 12 12">
                <path fill="currentColor" fill-rule="evenodd" d="M7 0h3a2 2 0 0 1 2 2v3a1 1 0 0 1-.3.7l-6 6a1 1 0 0 1-1.4 0l-4-4a1 1 0 0 1 0-1.4l6-6A1 1 0 0 1 7 0m2 2a1 1 0 1 0 2 0 1 1 0 0 0-2 0" clip-rule="evenodd"></path>
              </svg>
              {{ best_label }}
            </li>
          </ul>
        </div>
      {%- endif -%}
    {% endunless %}
    {%- comment -%}
      Optional fine print:
      <div class="promo-note">Discount applied in cart. Some offers apply once per order.</div>
    {%- endcomment -%}
  </div>
{%- endif -%}
